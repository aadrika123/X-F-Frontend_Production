import{d as Ie,c as je,p as y,w as ve,S as ye,Q as d,j as t,I as Me}from"./index-P4xldYDK.js";import{d as I,u as Pe,e as Te}from"./router-vn-0iGwJ.js";import{u as _e}from"./formik.esm-ilDmhU_v.js";import{c as Ae,d as we,a as Fe}from"./index.esm-19LW8OGO.js";import{F as Le}from"./FormProvider-Er-x6P3I.js";import{T as Re}from"./TextAreaField-AQXsY0OP.js";import"./index-9INnh4Fj.js";import{r as h}from"./tailwind-umh7vczy.js";import{P as Se}from"./index-PCnKgv-B.js";import{r as Be}from"./resizeImage-IgRojBvG.js";import{O as ke}from"./OverLayLoader-BxKzl8pX.js";import{M as ze}from"./MyPDFViewer-ccWt0K1o.js";import"./reactQuery-VYMV1vFj.js";import"./axios-lPgvryBG.js";import"./reactIcons-lANGEfNm.js";import"./headlessui-pLs_kC1m.js";import"./customInputValidation-8tSUGdUh.js";import"./module-v1C6_CxY.js";/* empty css              */import"./reactPdfViewerCore-t_0I17fT.js";import"./reactPdfViewerDefaultLayout-S9Yj6FAR.js";function ot(){var T,_,A,F,L,R,S,B,k,z,K,O,U,V,q,Y,$,E,W,Q,G,H,J,X,Z,D,ee,te,ae,se,ie,oe,ne,re,ce,de,le;const[f,v]=I.useState(""),b=Pe(),g=Ie({}),[N,M]=I.useState(""),[fe,P]=I.useState(""),{id:u}=Te(),e=je({api:y.staticSafDetail,config:{applicationId:u},value:[u],options:{enabled:!!u}}),C=je({api:(T=ve)==null?void 0:T.workFlowInfo,config:{workflowId:(A=(_=e==null?void 0:e.data)==null?void 0:_.data)==null?void 0:A.workflow_id},value:[(L=(F=e==null?void 0:e.data)==null?void 0:F.data)==null?void 0:L.workflow_id],options:{enabled:!!((S=(R=e==null?void 0:e.data)==null?void 0:R.data)!=null&&S.workflow_id)}}),o=_e({initialValues:{uploadMeasurement:"",comment:""},validationSchema:Ae({uploadMeasurement:((k=(B=e==null?void 0:e.data)==null?void 0:B.data)==null?void 0:k.applied_by)=="TC"||((K=(z=e==null?void 0:e.data)==null?void 0:z.data)==null?void 0:K.applied_by)=="TC Reassesment"?we().notRequired():we().required("Measurement Sheet is required").test("fileSize","Max 10 mb file size",a=>(a==null?void 0:a.size)<=1e7),comment:Fe().label("Comment").min(2).max(500)}),onSubmit:async a=>{ye.fire({title:"Are you sure?",text:"\n       You are going to forward the application to the ".concat(f==="LIPIK"?"Lipik":"Nagar Rachna"),icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(i=>{i.isConfirmed&&be(a)}).catch(i=>{var r,c;console.log(i),d.error((c=(r=i==null?void 0:i.response)==null?void 0:r.data)==null?void 0:c.message)})}}),be=async a=>{var i,r,c,x,l,s,j,w,me,pe,xe,ue,he,ge;if(((r=(i=e==null?void 0:e.data)==null?void 0:i.data)==null?void 0:r.applied_by)=="TC"||((x=(c=e==null?void 0:e.data)==null?void 0:c.data)==null?void 0:x.applied_by)=="TC Reassesment")try{const n=await g.mutateAsync({api:y.safLevelV2,data:{applicationId:u,receiverRoleId:f==="LIPIK"?"6":"7",action:"forward",comment:(a==null?void 0:a.comment)||"OK"}});(l=n==null?void 0:n.data)!=null&&l.status?(d.success((s=n==null?void 0:n.data)==null?void 0:s.message),b("/amc-app/property/saf-verification-list",{replace:!0})):d.error((j=n==null?void 0:n.data)==null?void 0:j.message)}catch(n){d.error((w=n==null?void 0:n.data)==null?void 0:w.message)}else{const n=new FormData;n.append("applicationId",u),n.append("document",a==null?void 0:a.uploadMeasurement);try{const m=await g.mutateAsync({api:y.uploadMeasurementSheetApi,data:n});if((me=m==null?void 0:m.data)!=null&&me.status){const p=await g.mutateAsync({api:y.safLevelV2,data:{applicationId:u,receiverRoleId:f==="LIPIK"?"6":"7",action:"forward",comment:(a==null?void 0:a.comment)||"OK"}});(pe=p==null?void 0:p.data)!=null&&pe.status?(d.success((xe=p==null?void 0:p.data)==null?void 0:xe.message),b("/amc-app/property/saf-verification-list",{replace:!0})):d.error((ue=p==null?void 0:p.data)==null?void 0:ue.message)}else d.error((he=m==null?void 0:m.data)==null?void 0:he.message)}catch(m){d.error((ge=m==null?void 0:m.data)==null?void 0:ge.message)}}},Ne=async()=>{var a;if(((a=o==null?void 0:o.values)==null?void 0:a.comment)=="")return d.error("Comment is required !");ye.fire({title:"Are you sure?",text:"You are going to backward of this application",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(async i=>{var r,c,x,l;if(i.isConfirmed)try{const s=await g.mutateAsync({api:y.safLevel,data:{applicationId:u,receiverRoleId1:"",action:"backward",comment:((r=o==null?void 0:o.values)==null?void 0:r.comment)||"No Comment"}});(c=s==null?void 0:s.data)!=null&&c.status?(d.success((x=s==null?void 0:s.data)==null?void 0:x.message),b("/amc-app/property/saf-verification-list",{replace:!0})):d.error(((l=s==null?void 0:s.data)==null?void 0:l.message)||"Something went wrong, Please try again")}catch(s){d.error(s==null?void 0:s.message),console.log(s)}}).catch(i=>{var r,c;d.error((c=(r=i==null?void 0:i.response)==null?void 0:r.data)==null?void 0:c.message)})},Ce=async a=>{var r,c,x;const i=a.target.files[0];if((i==null?void 0:i.type)==="application/pdf"){const l=new FileReader;l.onload=s=>{M(s.target.result),P(i.name.split(".").pop())},l.readAsDataURL(i),o.setFieldValue("uploadMeasurement",i)}else{const l=await Be((r=a==null?void 0:a.target)==null?void 0:r.files[0]),s=new File([l],(x=(c=a==null?void 0:a.target)==null?void 0:c.files[0])==null?void 0:x.name,{type:"image/*"}),j=new FileReader;j.onload=w=>{M(w.target.result),P(s.name.split(".").pop())},j.readAsDataURL(s),o.setFieldValue("uploadMeasurement",s)}};return e!=null&&e.isLoading?t.jsx(Me,{}):t.jsxs(Se,{title:"Measurement",children:[g.isLoading&&t.jsx(ke,{}),t.jsx(Le,{formik:o,children:t.jsxs("div",{className:"p-4 ",children:[t.jsx(h.Card,{className:"w-full",children:t.jsxs(h.CardBody,{children:[t.jsx("div",{className:"flex justify-between items-center",children:t.jsx("h1",{className:"font-semibold text-sm",children:"Application Details"})}),t.jsx("div",{className:"border-b-2 border-gray-300 w-full py-1"}),t.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[t.jsx("h1",{className:"font-semibold text-xs",children:"Application No : "}),t.jsx("h1",{className:"text-xs",children:(U=(O=e==null?void 0:e.data)==null?void 0:O.data)==null?void 0:U.saf_no}),t.jsx("h1",{className:"font-semibold text-xs",children:"Application Type : "}),t.jsx("h1",{className:"text-xs",children:(q=(V=e==null?void 0:e.data)==null?void 0:V.data)==null?void 0:q.assessment_type}),t.jsx("h1",{className:"font-semibold text-xs",children:"Apply Date : "}),t.jsx("h1",{className:"text-xs",children:($=(Y=e==null?void 0:e.data)==null?void 0:Y.data)==null?void 0:$.application_date}),t.jsx("h1",{className:"font-semibold text-xs",children:"Owner Name : "}),t.jsx("h1",{className:"text-xs",children:(W=(E=e==null?void 0:e.data)==null?void 0:E.data)==null?void 0:W.applicant_name}),t.jsx("h1",{className:"font-semibold text-xs",children:"Mobile No : "}),t.jsx("h1",{className:"text-xs w-40 truncate",children:(J=(H=(G=(Q=e==null?void 0:e.data)==null?void 0:Q.data)==null?void 0:G.owners)==null?void 0:H.map(a=>a==null?void 0:a.mobile_no))==null?void 0:J.join(", ")})]})]})}),t.jsx("div",{className:"my-4 border-b-2"}),t.jsxs(h.Card,{className:"w-full",children:[t.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:t.jsx("h1",{className:"text-xs font-semibold text-gray-100",children:((Z=(X=e==null?void 0:e.data)==null?void 0:X.data)==null?void 0:Z.applied_by)=="TC"||((ee=(D=e==null?void 0:e.data)==null?void 0:D.data)==null?void 0:ee.applied_by)=="TC Reassesment"?"Comment":"Upload Measurement Sheet"})}),N&&(fe==="pdf"?t.jsx(ze,{fileUrl:N}):t.jsx("div",{className:"flex justify-center px-4 py-2",children:t.jsx("img",{src:N,alt:"preview",loading:"lazy"})})),t.jsx(h.CardBody,{children:t.jsxs("div",{className:"grid grid-cols-1 justify-center gap-5",children:[((ae=(te=e==null?void 0:e.data)==null?void 0:te.data)==null?void 0:ae.applied_by)!="TC"&&((ie=(se=e==null?void 0:e.data)==null?void 0:se.data)==null?void 0:ie.applied_by)!="TC Reassesment"&&t.jsxs("div",{children:[t.jsx("div",{className:"mb-1",children:t.jsx("h1",{className:"font-semibold text-xs",children:"Upload Measurement Sheet"})}),t.jsx("input",{type:"file",accept:"application/pdf, image/*",name:"uploadMeasurement",onChange:Ce,className:"border border-gray-300 p-2 w-full rounded-lg"}),t.jsx("small",{className:"text-red-500",children:((oe=o==null?void 0:o.errors)==null?void 0:oe.uploadMeasurement)&&((ne=o==null?void 0:o.touched)==null?void 0:ne.uploadMeasurement)&&((re=o==null?void 0:o.errors)==null?void 0:re.uploadMeasurement)})]}),t.jsx("div",{children:t.jsx(Re,{label:"Comment",name:"comment",formik:o,placeholder:"Comment"})})]})})]}),t.jsx("div",{className:"my-4 border-b-2"}),t.jsx("div",{className:"flex justify-center",children:t.jsxs("div",{className:"justify-center items-center mt-4 gap-3",children:[t.jsx("div",{className:"flex justify-center items-center",children:t.jsx(h.Button,{onClick:Ne,size:"sm",className:"bg-red-500 text-white",children:t.jsx("small",{children:"Back To Back Office"})})}),((le=(de=(ce=C==null?void 0:C.data)==null?void 0:ce.data)==null?void 0:de.permissions)==null?void 0:le.can_forward)&&t.jsxs("div",{className:"flex justify-center items-center gap-2 mt-4",children:[t.jsx(h.Button,{type:"submit",onClick:()=>v("LIPIK"),size:"sm",className:"bg-blue-500 text-white",children:t.jsx("small",{children:"Send To Lipik "})}),t.jsx(h.Button,{type:"submit",size:"sm",onClick:()=>v("SR_LIPIK"),className:"bg-green-500 text-white",children:t.jsx("small",{children:"Send To Nagar Rachna"})})]})]})})]})})]})}export{ot as default};
