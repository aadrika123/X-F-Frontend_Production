import{d as ee,c as Y,p as L,j as e,Q as C,b as fe,e as we,w as _e,S as je,I as be}from"./index-r6pkVfbe.js";import{u as me,d as f,e as pe,f as ve,r as Te}from"./router-5yjtezO8.js";import{P as se}from"./index-XdDZ0AxP.js";import{u as ue,F as Pe}from"./formik.esm-BnzrXcQN.js";import{c as ae,a as u,b as Ie,d as Se}from"./index.esm-uHa2PMRf.js";import{F as Ne}from"./FormProvider-kGPBuDhT.js";import{T as q}from"./TextField-WLFSaEKU.js";import{S as Z}from"./SelectField-D-hcXiLT.js";import"./TranslateField-BH3bQnqu.js";import{r as b}from"./tailwind-6U-kYQAu.js";import"./reactQuery-QTVGT_ni.js";import{T as Ce}from"./TextAreaField-wwGW22Fx.js";import{r as Le}from"./resizeImage-xHSvE3rm.js";import{u as Ae}from"./useErrorFocusFields-mwtEYYKc.js";import{O as De}from"./OverLayLoader-ZQFsfgoF.js";import{u as qe}from"./usePathWisePermission-A3g_L-B3.js";import"./axios-lPgvryBG.js";import"./reactIcons-ElHvrKTF.js";import"./headlessui-iZReL1Rn.js";import"./customInputValidation-jhKsg103.js";import"./module-BKxwfC_F.js";const re=[{label:"Yes",value:"yes"},{label:"No",value:"no"}],Be=[{id:1,label:"Zone A-East",value:"1"},{id:2,label:"Zone B-West",value:"2"},{id:3,label:"Zone C-North",value:"3"},{id:4,label:"Zone D-South",value:"4"}],Re=[{docname:"isPhotoDoc",label:"Photograph"},{docname:"isIdProofDoc",label:"Id Proof"},{docname:"isApplicationFormDoc",label:"Application Form"},{docname:"isSaleDeedDoc",label:"Sale Deed"},{docname:"isMeasurementDoc",label:"Measurement"},{docname:"isLayoutSactionMapDoc",label:"Layout Saction Map"},{docname:"isNaOrderDoc",label:"NA Order"},{docname:"isNamunaDDoc",label:"7/12/Namuna D"},{docname:"isOthersDoc",label:"Others"}];function Oe(l){var d,H,M,R,n,D,F,$;me();const{mutateAsync:v,isLoading:i}=ee({}),T=ee({});ee({});const s=ue({enableReinitialize:!0,validationSchema:ae().shape({name:u().required("Name is required"),mobile:u().required("Mobile is required"),zoneId:u().required("Zone is required"),wardId:u().required().label("Ward"),address:u().required("Address is required"),propertyType:u().required("Property Type is required"),consumerNo:u().when("isConsumer",{is:r=>r==="yes",then:()=>u().required("Consumer No is required")}),licenseNo:u().when("isLicense",{is:r=>r==="yes",then:()=>u().required("License No is required")}),waterHarvestingDate:u().when("isWaterHarvesting",{is:r=>r==="yes",then:()=>u().required("Date is required")})}),initialValues:l==null?void 0:l.data,onSubmit:async(r,{})=>{console.log(r),l==null||l.next({...l==null?void 0:l.data,...r},!1)}}),{values:j}=s,{data:P,isPending:I,isError:B,error:A,isLoading:S}=Y({api:L.getWardByZone,config:{zoneId:j==null?void 0:j.zoneId},value:[j==null?void 0:j.zoneId],options:{enabled:!!(j!=null&&j.zoneId)}}),_=Y({api:L.masterSaf,config:{},options:{enabled:!0}}),p=async()=>{var r,N,y;try{const c=await T.mutateAsync({api:L.consumerVerify,data:{consumerNo:(r=s==null?void 0:s.values)==null?void 0:r.consumerNo}});(N=c==null?void 0:c.data)!=null&&N.status?(l==null||l.setConsumerDetails((y=c==null?void 0:c.data)==null?void 0:y.data),C.success("Consumer Verified")):C.error("Consumer not found")}catch(c){C.error(c.message)}},t=async()=>{var r,N,y;try{const c=await T.mutateAsync({api:L.tradeVerify,data:{licenseNo:(r=s==null?void 0:s.values)==null?void 0:r.licenseNo}});(N=c==null?void 0:c.data)!=null&&N.status?(l==null||l.setLicenseDetails((y=c==null?void 0:c.data)==null?void 0:y.data),C.success("License Verified")):(console.log(c==null?void 0:c.data),C.error("License not found"))}catch(c){C.error(c.message)}},h=Y({api:L.getAptByWard,config:{wardMstrId:j==null?void 0:j.wardId},value:[j==null?void 0:j.wardId],options:{enabled:((d=s.values)==null?void 0:d.propertyType)==3}});return e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex flex-row justify-between mb-3",children:e.jsx("h1",{className:"text-sm font-semibold",children:"Basic Details"})}),e.jsx(b.Card,{children:e.jsx("div",{className:"p-4",children:e.jsx(Ne,{formik:s,children:e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsx("div",{children:e.jsx(q,{disabled:!0,isRequiredLabel:!0,label:"Property Owner Name",name:"name",type:"text",formik:s,placeholder:"Enter property owner name"})}),e.jsx(q,{isRequiredLabel:!0,label:"Mobile",name:"mobile",type:"text",formik:s,placeholder:"Enter your mobile number",onInput:r=>{r.target.value.length>10?r.target.value=r.target.value.slice(0,10):r.target.value=r.target.value.replace(/[^0-9]/g,"")}}),e.jsxs(Z,{disabled:!0,label:"Zone",name:"zoneId",formik:s,isRequiredLabel:!0,children:[e.jsx("option",{value:"",children:"select"}),Be.map(r=>e.jsx("option",{value:r==null?void 0:r.value,children:r==null?void 0:r.label},r==null?void 0:r.id))]}),e.jsxs("div",{children:[e.jsxs(Z,{isRequiredLabel:!0,label:"Ward",formik:s,name:"wardId",disabled:!0,children:[e.jsx("option",{value:"",children:"select"}),(H=P==null?void 0:P.data)==null?void 0:H.map(r=>e.jsx("option",{value:r==null?void 0:r.id,children:r==null?void 0:r.ward_name},r==null?void 0:r.id))]}),e.jsx("small",{className:"text-blue-500",children:S?"Please wait...":""})]}),e.jsxs(Z,{isRequiredLabel:!0,label:"Property Type",name:"propertyType",formik:s,children:[e.jsx("option",{value:"",children:"Select"}),(n=(R=(M=_==null?void 0:_.data)==null?void 0:M.data)==null?void 0:R.property_type)==null?void 0:n.map(r=>e.jsx("option",{value:r==null?void 0:r.id,children:r==null?void 0:r.property_type},r==null?void 0:r.id))]}),((D=s==null?void 0:s.values)==null?void 0:D.propertyType)==3&&e.jsxs(Z,{label:"Apartment",name:"apartmentId",formik:s,children:[e.jsx("option",{value:"",children:"Select"}),($=(F=h==null?void 0:h.data)==null?void 0:F.data)==null?void 0:$.map(r=>e.jsx("option",{value:r==null?void 0:r.id,children:r==null?void 0:r.apartment_name},r==null?void 0:r.id))]}),e.jsx(q,{label:"Area of Plot",name:"plotArea",type:"number",onInput:r=>{r.target.value.length>10?r.target.value=r.target.value.slice(0,10):r.target.value=r.target.value.replace(/[^0-9]/g,"")},formik:s,placeholder:"Enter area of plot"}),e.jsx(q,{isRequiredLabel:!0,label:"Address",name:"address",type:"text",formik:s,placeholder:"Enter your address"}),e.jsx(Z,{label:"Is Water Connection?",name:"isConsumer",formik:s,children:re.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))}),s.values.isConsumer==="yes"&&e.jsx(q,{isRequiredLabel:!0,onBlur:p,label:"Consumer No",name:"consumerNo",type:"text",formik:s,placeholder:"Enter your consumer number"}),e.jsx(Z,{label:"Is Trade License?",name:"isLicense",formik:s,children:re.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))}),s.values.isLicense==="yes"&&e.jsx(q,{isRequiredLabel:!0,label:"License No",onBlur:t,name:"licenseNo",type:"text",formik:s,placeholder:"Enter your license number"}),e.jsx(Z,{label:"Is Water Harvesting?",name:"isWaterHarvesting",formik:s,children:re.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))}),s.values.isWaterHarvesting==="yes"&&e.jsx(q,{isRequiredLabel:!0,label:"Water Harvesting Date",name:"waterHarvestingDate",type:"date",formik:s}),e.jsx("h1",{className:"text-xs font-semibold",children:"Please select the document you have"}),e.jsx("div",{className:"border-t border-gray-200"}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:Re.map(r=>{var N,y,c,O,W;return e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"checkbox",name:r.docname,value:(N=s==null?void 0:s.values)==null?void 0:N[r.docname],checked:((y=s==null?void 0:s.values)==null?void 0:y[r.docname])==="yes",onChange:V=>{s.setFieldValue(r.docname,V.target.checked?"yes":"no")}}),e.jsxs("h1",{className:"text-xs font-semibold",children:[r.label,(r.docname==="isPhotoDoc"||(r==null?void 0:r.docname)=="isIdProofDoc"||(r==null?void 0:r.docname)=="isApplicationFormDoc"||(r==null?void 0:r.docname)=="isSaleDeedDoc")&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"text-red-500 text-[10px]",children:((c=s==null?void 0:s.errors)==null?void 0:c[r.docname])&&((O=s==null?void 0:s.touched)==null?void 0:O[r.docname])&&((W=s==null?void 0:s.errors)==null?void 0:W[r.docname])})})]})]},r.docname)})}),e.jsx("div",{className:"text-center mt-4",children:e.jsx(b.Button,{size:"sm",type:"submit",color:"blue",loading:i,formik:s,fullWidth:!0,label:"Submit",children:"Next"})})]})})})})]})}function We(l){var I,B,A,S,_,p;f.useState(!1),f.useState({});const{data:v,consumerDetails:i,licenseDetails:T,dataFromDb:s}=l,j=()=>{l.next({...v,...v},!1)},P=()=>{l.prev({...v,...v})};return e.jsxs("div",{children:[e.jsx("h1",{className:"text-sm font-semibold text-gray-600",children:"View Details"}),e.jsx("div",{className:"my-2 border-b-2"}),e.jsxs(b.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-sm font-semibold text-gray-100",children:"Basic Details"})}),e.jsx(b.CardBody,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Property No: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(I=s==null?void 0:s.property_no)!=null?I:"-"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Holding No.: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(B=s==null?void 0:s.holding_no)!=null?B:"-"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Zone: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(A=s==null?void 0:s.zone_name)!=null?A:"-"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Ward No: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(S=s==null?void 0:s.ward_no)!=null?S:"-"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Date of Purchase: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.land_occupation_date)||"--"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Ownership Type: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.ownership_type)||"-"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Property Type: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.property_type)||"-"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Holding Type: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.holding_type)||"-"})})]})})]}),(i==null?void 0:i.consumer_no)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-2 border-b-2"}),e.jsxs(b.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-sm font-semibold text-gray-100",children:"Water Connection Details"})}),e.jsx(b.CardBody,{children:e.jsx("div",{className:"grid grid-cols-1 gap-2",children:e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer No"}),e.jsx("p",{className:"text-xs text-gray-800",children:i==null?void 0:i.consumer_no})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer Name"}),e.jsx("p",{className:"text-xs text-gray-800",children:i==null?void 0:i.applicant_name})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Building Type"}),e.jsx("p",{className:"text-xs text-gray-800",children:i==null?void 0:i.building_type})]})]})})})})]})]}),(i==null?void 0:i.consumer_no)&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-2 border-b-2"}),e.jsxs(b.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-sm font-semibold text-gray-100",children:"Water Connection Details"})}),e.jsx(b.CardBody,{children:e.jsx("div",{className:"grid grid-cols-1 gap-2",children:e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer No"}),e.jsx("p",{className:"text-xs text-gray-800",children:i==null?void 0:i.consumer_no})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer Name"}),e.jsx("p",{className:"text-xs text-gray-800",children:i==null?void 0:i.applicant_name})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Building Type"}),e.jsx("p",{className:"text-xs text-gray-800",children:i==null?void 0:i.building_type})]})]})})})})]})]}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs(b.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-sm font-semibold text-gray-100",children:"Property Address & Details"})}),e.jsx(b.CardBody,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Survey No: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.khata_no)||"--"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Plot No.: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.plot_no)||"--"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Mauja Name: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.village_mauja_name)||"--"})}),e.jsx("div",{children:e.jsxs("h1",{className:"text-xs font-semibold",children:["Area Of Plot (in Sq ft) :"," "]})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.area_of_plot)||"--"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Property Address: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.prop_address)||"--"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold",children:"Corresponding Address: "})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs",children:(s==null?void 0:s.corr_address)||"--"})})]})})]}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs(b.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-sm font-semibold text-gray-100",children:"Owner Details"})}),e.jsx(b.CardBody,{children:e.jsx("div",{className:"relative overflow-x-auto  sm:rounded-lg",children:e.jsxs("table",{className:"w-full text-xs text-left  border-slate-400 border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Sno :"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Owner Name"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Owner Name In Marathi"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Gender"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"DOB"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Guardian Name"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Guardian Name In Marathi"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Relation"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Mobile No."}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Aadhar"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Pan"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Email"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Is-Armed-Force"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Is-Specially-Abled?"}),e.jsx("td",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Action"})]})}),e.jsx("tbody",{children:(_=s==null?void 0:s.owners)==null?void 0:_.map((t,h)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:h+1}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.owner_name}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.owner_name_marathi}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:(t==null?void 0:t.gender)||"--"}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:(t==null?void 0:t.dob)||"--"}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:(t==null?void 0:t.guardian_name)||"--"}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.guardian_name_marathi}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.relation_type}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.mobile_no}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.aadhar_no}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.pan_no}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.email}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t!=null&&t.is_armed_force?"Yes":"No"}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t!=null&&t.is_specially_abled?"Yes":"No"}),e.jsx("td",{className:"text-xs p-4 border border-slate-300"})]},h))})]})})})]}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs(b.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-sm font-semibold text-gray-100",children:"Floor Details"})}),e.jsx(b.CardBody,{children:e.jsx("div",{className:"relative overflow-x-auto  sm:rounded-lg",children:e.jsxs("table",{className:"w-full text-xs text-left  border-slate-400 border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Sno :"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Floor Name"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Usage Type"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Occupancy Type"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Built up Area"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Carpet Area"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Construction Type"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"Action"})]})}),e.jsx("tbody",{children:(p=s==null?void 0:s.floors)==null?void 0:p.map((t,h)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:h+1}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.floor_name}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.usage_type}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.occupancy_type}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.builtup_area}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.carpet_area}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:t==null?void 0:t.construction_type}),e.jsx("td",{className:"text-xs p-4 border border-slate-300"})]},h+1))})]})})})]}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs("div",{className:"flex justify-center mt-4 gap-4",children:[e.jsx(b.Button,{color:"blue-gray",onClick:P,className:"px-8",size:"sm",children:"Back"}),e.jsx(b.Button,{color:"blue",onClick:j,className:"px-8",size:"sm",children:"Next"})]})]})}function ze(l){var r,N,y,c,O,W,V,U,J,K,Q,X;fe();const[v,i]=f.useState(""),{AutoFocusErrorField:T}=Ae(),[s,j]=f.useState([]),P=me(),I=ee({}),[B,A]=f.useState(null),{id:S}=pe(),{pathname:_}=ve();qe((N=(r=_==null?void 0:_.split("/"))==null?void 0:r.slice(0,-1))==null?void 0:N.join("/"));const{coords:p,isGeolocationEnabled:t}=we(),h=Y({api:L.staticSafDetail,config:{applicationId:S},value:[S],options:{enabled:!!S}});Y({api:(y=_e)==null?void 0:y.workFlowInfo,config:{workflowId:(O=(c=h==null?void 0:h.data)==null?void 0:c.data)==null?void 0:O.workflow_id},value:[(V=(W=h==null?void 0:h.data)==null?void 0:W.data)==null?void 0:V.workflow_id],options:{enabled:!!((J=(U=h==null?void 0:h.data)==null?void 0:U.data)!=null&&J.workflow_id)}});const d=ue({enableReinitialize:!0,initialValues:{...l==null?void 0:l.data,geoTagged:(Q=(K=l==null?void 0:l.data)==null?void 0:K.geoTagged)==null?void 0:Q.map(a=>({...a})),comment:((X=l==null?void 0:l.data)==null?void 0:X.comment)||""},validationSchema:ae().shape({geoTagged:Ie().of(ae().shape({latitude:u().required("Latitude is required"),longitude:u().required("Longitude is required"),directionType:u().required("Direction is required"),imagePath:Se().required("Image is required")}))}),onSubmit:async a=>{je.fire({title:"Are you sure?",text:"\n          You are going to submit the application for the survey. Please make sure all the details are correct.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(g=>{g.isConfirmed&&H(a)}).catch(g=>{var o,w;console.log(g),C.error((w=(o=g==null?void 0:g.response)==null?void 0:o.data)==null?void 0:w.message)})}}),H=async a=>{var g,o,w;try{const m=await(I==null?void 0:I.mutateAsync({api:L.surveyReassessment,data:{propId:S,propertyType:a==null?void 0:a.propertyType,apartmentId:a==null?void 0:a.apartmentId,propAddress:a==null?void 0:a.address,mobileNo:a==null?void 0:a.mobile,ownerName:a==null?void 0:a.name,ward:a==null?void 0:a.wardId,zone:a==null?void 0:a.zoneId,consumerNo:a==null?void 0:a.consumerNo,licenseNo:a==null?void 0:a.licenseNo,isWaterHarvesting:(a==null?void 0:a.isWaterHarvesting)=="yes",harvestingDate:a==null?void 0:a.waterHarvestingDate,isApplicationFormDoc:(a==null?void 0:a.isApplicationFormDoc)=="yes",isSaleDeedDoc:(a==null?void 0:a.isSaleDeedDoc)=="yes",isLayoutSactionMapDoc:(a==null?void 0:a.isLayoutSactionMapDoc)=="yes",isNaOrderDoc:(a==null?void 0:a.isNaOrderDoc)=="yes",isNamunaDDoc:(a==null?void 0:a.isNamunaDDoc)=="yes",isOthersDoc:(a==null?void 0:a.isOthersDoc)=="yes",isMeasurementDoc:(a==null?void 0:a.isMeasurementDoc)=="yes",isPhotoDoc:(a==null?void 0:a.isPhotoDoc)=="yes",isIdProofDoc:(a==null?void 0:a.isIdProofDoc)=="yes"}}));(g=m==null?void 0:m.data)!=null&&g.status&&await M(a,(w=(o=m==null?void 0:m.data)==null?void 0:o.data)==null?void 0:w.safId)}catch(m){console.log(m)}},M=async(a,g)=>{var w,m,z,E,k;const o=new FormData;o.append("safId",g),a==null||a.geoTagged.forEach((x,G)=>{o.append("latitude[".concat(G,"]"),x==null?void 0:x.latitude),o.append("longitude[".concat(G,"]"),x==null?void 0:x.longitude),o.append("directionType[".concat(G,"]"),x==null?void 0:x.directionType),o.append("imagePath[".concat(G,"]"),x==null?void 0:x.imagePath)});try{const x=await I.mutateAsync({api:L.geoTagging,data:o});(w=x==null?void 0:x.data)!=null&&w.status?(C.success((m=x==null?void 0:x.data)==null?void 0:m.message),P("/amc-app/property/saf-generated-new/".concat(g),{replace:!0})):C.error((z=x==null?void 0:x.data)==null?void 0:z.message)}catch(x){C.error((k=(E=x==null?void 0:x.response)==null?void 0:E.data)==null?void 0:k.message)}},{submitCount:R,isSubmitting:n,errors:D,isValid:F}=d,$=async(a,g,o)=>{var z,E;await((z=window==null?void 0:window.ReactNativeWebView)==null?void 0:z.postMessage(JSON.stringify({Key:"OPEN_CAMERA"})));const w=await Le(a.target.files[0]),m=new File([w],(E=a.target.files[0])==null?void 0:E.name,{type:"image/*"});d.setFieldValue("geoTagged.".concat(g,".latitude"),p==null?void 0:p.latitude),d.setFieldValue("geoTagged.".concat(g,".longitude"),p==null?void 0:p.longitude),d.setFieldValue("geoTagged.".concat(g,".directionType"),o==null?void 0:o.directionType),d.setFieldValue("geoTagged.".concat(g,".imagePath"),m),A(m)};return Te.useEffect(()=>{var a;j(((a=l==null?void 0:l.data)==null?void 0:a.isWaterHarvesting)=="yes"?[{id:1,title:"Front Image",directionType:"Front"},{id:2,title:"Left Image",directionType:"Left"},{id:3,title:"Right Image",directionType:"Right"},{id:4,title:"Rain Water Harvesting Image",directionType:"waterHarvesting",isRainWaterHarvesting:!0}]:[{id:1,title:"Front Image",directionType:"Front"},{id:2,title:"Left Image",directionType:"Left"},{id:3,title:"Right Image",directionType:"Right"}])},[l==null?void 0:l.data]),f.useEffect(()=>{T({submitCount:R,isSubmitting:n,errors:D,isValid:F})},[D,R,n]),t||je.fire({text:"Geolocation is not enabled! Please enable to use this app",icon:"error",confirmButtonText:"Ok"}),v?e.jsx("div",{className:"p-16 flex text-center text-red-500 font-semibold h-screen justify-center items-center",children:"Network Error"}):h!=null&&h.isLoading?e.jsx(be,{}):e.jsxs(e.Fragment,{children:[I.isLoading&&e.jsx(De,{}),e.jsx("div",{children:e.jsxs(Ne,{formik:d,children:[e.jsx(Pe,{name:"geoTagged",children:a=>s.map((g,o)=>{var w,m,z,E,k,x,G,te,ne,le,de,oe,ie,ce,xe,he,ge;return e.jsxs(f.Fragment,{children:[e.jsxs(b.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-base font-semibold text-gray-100",children:g==null?void 0:g.title})}),e.jsxs(b.CardBody,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 items-center",children:[e.jsx("h1",{className:"font-semibold text-sm",children:"Latitude : "}),e.jsx(q,{disabled:!0,type:"text",isDynamic:!0,name:"geoTagged.".concat(o,".latitude"),formik:d}),e.jsxs("h1",{className:"font-semibold text-sm",children:["Longitude :"," "]}),e.jsx(q,{disabled:!0,type:"text",isDynamic:!0,name:"geoTagged.".concat(o,".longitude"),formik:d})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 mt-4",children:[e.jsx("div",{children:((m=(w=d==null?void 0:d.values)==null?void 0:w.geoTagged[o])==null?void 0:m.imagePath)&&e.jsx("img",{className:"w-full h-64",loading:"lazy",src:(E=(z=d==null?void 0:d.values)==null?void 0:z.geoTagged[o])!=null&&E.imagePath?URL.createObjectURL((x=(k=d==null?void 0:d.values)==null?void 0:k.geoTagged[o])==null?void 0:x.imagePath):null,alt:(ne=(te=(G=d==null?void 0:d.values)==null?void 0:G.geoTagged[o])==null?void 0:te.imagePath)==null?void 0:ne.name})}),e.jsxs("div",{children:[e.jsx("input",{type:"file",name:"imagePath",accept:"image/*",onChange:ye=>$(ye,o,g)}),e.jsx("span",{className:"text-sm text-red-500",children:(oe=(de=(le=d==null?void 0:d.errors)==null?void 0:le.geoTagged)==null?void 0:de[o])==null?void 0:oe.imagePath})]}),e.jsx("div",{children:e.jsx("h1",{className:"text-sm text-red-900",children:((ce=(ie=d==null?void 0:d.values)==null?void 0:ie.geoTagged[o])==null?void 0:ce.imagePath)&&Math.round(((ge=(he=(xe=d==null?void 0:d.values)==null?void 0:xe.geoTagged[o])==null?void 0:he.imagePath)==null?void 0:ge.size)/1024/1024*100)/100+"MB"})})]})]})]}),e.jsx("div",{className:"my-4 border-b-2"})]},o)})}),e.jsx(Ce,{name:"comment",label:"Comment",formik:d}),e.jsxs("div",{className:"flex justify-center items-center mt-4 gap-3",children:[e.jsx(b.Button,{type:"button",onClick:()=>{var a;l==null||l.prev({...l==null?void 0:l.data,geoTagged:(a=d==null?void 0:d.values)==null?void 0:a.geoTagged})},size:"sm",className:"bg-blue-500 text-white",children:e.jsx("small",{children:"Back"})}),e.jsx(b.Button,{type:"submit",size:"sm",className:"bg-blue-500 text-white",children:e.jsx("small",{children:"Final Submit"})})]})]})})]})}function ls(){var H,M,R;const{id:l}=pe(),[v,i]=f.useState(0),[T,s]=f.useState({name:"",mobile:"",zoneId:"",wardId:"",address:"",isConsumer:"no",isLicense:"no",consumerNo:"",licenseNo:"",propertyType:"",apartmentId:"",plotArea:"",isWaterHarvesting:"no",waterHarvestingDate:"",comment:"",isApplicationFormDoc:"no",isSaleDeedDoc:"no",isLayoutSactionMapDoc:"no",isNaOrderDoc:"no",isNamunaDDoc:"no",isOthersDoc:"no",isMeasurementDoc:"no",isPhotoDoc:"no",isIdProofDoc:"no",floors:[],geoTagged:[{latitude:"",longitude:"",altitude:"",accuracy:"",imagePath:"",directionType:"",rainWaterHarvesting:""}]}),[j,P]=f.useState({}),[I,B]=f.useState({});f.useState(""),f.useState("");const[A,S]=f.useState({}),_=n=>{console.log(n)},p=(n,D=!1)=>{if(s({...T,...n}),D){_(n);return}i(v+1)},t=n=>{s({...T,...n}),i(v-1)},h=Y({api:L.getPropByHolding,config:{propertyId:l},value:[l],options:{enabled:!!l,onSuccess:n=>{S(n==null?void 0:n.data),s(D=>{var F,$,r,N,y,c,O,W,V,U,J,K,Q,X,a,g;return{...D,name:(F=n==null?void 0:n.data)==null?void 0:F.owner_name,mobile:(r=($=n==null?void 0:n.data)==null?void 0:$.owners)==null?void 0:r.map(o=>o==null?void 0:o.mobile_no).join(", "),zoneId:(N=n==null?void 0:n.data)==null?void 0:N.zone_mstr_id,wardId:(y=n==null?void 0:n.data)==null?void 0:y.ward_mstr_id,propertyType:(c=n==null?void 0:n.data)==null?void 0:c.prop_type_mstr_id,apartmentId:(O=n==null?void 0:n.data)==null?void 0:O.apartment_details_id,plotArea:(W=n==null?void 0:n.data)==null?void 0:W.area_of_plot,address:(V=n==null?void 0:n.data)==null?void 0:V.prop_address,isWaterHarvesting:(U=n==null?void 0:n.data)!=null&&U.is_water_harvesting?"yes":"no",waterHarvestingDate:(J=n==null?void 0:n.data)==null?void 0:J.rwh_date_from,isConsumer:((K=n==null?void 0:n.data)==null?void 0:K.water_conn_no)!=""?"yes":"no",consumerNo:(Q=n==null?void 0:n.data)==null?void 0:Q.water_conn_no,isLicense:(X=n==null?void 0:n.data)!=null&&X.license_no?"yes":"no",licenseNo:((a=n==null?void 0:n.data)==null?void 0:a.license_no)||"",floors:(g=n==null?void 0:n.data)==null?void 0:g.floors}})}}}),d=Y({api:L.checkProperty,config:{type:"Reassesment",propertyId:l},key:"checkPropertyDetails",value:[l],options:{enabled:!!l}});return console.log("dataFromDb",d),h.isLoading?e.jsx(se,{title:"Survey Form Reassessment",children:e.jsx("div",{className:"px-4 py-6 flex-1",children:e.jsx(be,{})})}):(H=d==null?void 0:d.data)!=null&&H.inWorkflow?e.jsx(se,{title:"Survey Form Reassessment",children:e.jsx("div",{className:"px-8 py-6 flex-1",children:e.jsx("div",{className:"text-center mt-5",children:e.jsxs("h1",{className:"text-lg font-semibold text-center mt-60 text-red-800",children:["Your Application is still in workflow.",e.jsxs("p",{className:"text-green-800 text-sm",children:["Please Track your application with",(R=(M=h.data)==null?void 0:M.data)==null?void 0:R.saf_no]})]})})})}):e.jsx(se,{title:"Survey Form Reassessment",children:e.jsx("div",{className:"px-4 py-6 flex-1",children:e.jsx("div",{children:{0:e.jsx(Oe,{next:p,data:T,setData:s,setConsumerDetails:P,setLicenseDetails:B,dataFromDb:A}),1:e.jsx(We,{next:p,prev:t,data:T,setData:s,setConsumerDetails:P,consumerDetails:j,licenseDetails:I,setLicenseDetails:B,dataFromDb:A}),2:e.jsx(ze,{next:p,prev:t,data:T,setData:s,setConsumerDetails:P,consumerDetails:j,setLicenseDetails:B,dataFromDb:A})}[v]})})})}export{ls as default};
