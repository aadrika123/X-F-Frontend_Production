import{e as pe,d as ue,Q as b,S as xe,p as h,c as f,j as e}from"./index-XXmRZ4UX.js";import{P as be}from"./index-N7apAzSk.js";import{u as he,d as je}from"./router-5yjtezO8.js";import{u as Ne}from"./formik.esm-BnzrXcQN.js";import{c as ye,a as u}from"./index.esm-uHa2PMRf.js";import{F as fe}from"./FormProvider-0cpncWrR.js";import{T as c}from"./TextField-vp2Gh44c.js";import{S as te}from"./SelectField-VQs636wt.js";import{T as re}from"./TextAreaField-5VniNc2U.js";import"./index-iFVn5AxS.js";import{r as Ie}from"./resizeImage-duIDCqup.js";import{r as y}from"./tailwind-6U-kYQAu.js";import"./reactQuery-QTVGT_ni.js";import"./axios-lPgvryBG.js";import"./reactIcons-ElHvrKTF.js";import"./headlessui-iZReL1Rn.js";import"./customInputValidation-jhKsg103.js";const we=[{id:1,label:"Zone A-East",value:"1"},{id:2,label:"Zone B-West",value:"2"},{id:3,label:"Zone C-North",value:"3"},{id:4,label:"Zone D-South",value:"4"}];function ge({getPropDetails:n,demandDetails:r,id:s}){var I,w,g,C,z,T,A,V,F,S,_,q,v,B,Z,L,R,E,U,W,M,G,O,H,Y,$,J,K,Q,X,k,P,D,ee;const oe=he(),{coords:p,isGeolocationEnabled:ie,isGeolocationAvailable:Ce}=pe(),se=ue({}),[ce,me]=je.useState(null),a=Ne({enableReinitialize:!0,initialValues:{zoneName:((w=(I=n==null?void 0:n.data)==null?void 0:I.data)==null?void 0:w.zone_name)||"",zoneId:((C=(g=n==null?void 0:n.data)==null?void 0:g.data)==null?void 0:C.zone_mstr_id)||"",wardId:((T=(z=n==null?void 0:n.data)==null?void 0:z.data)==null?void 0:T.ward_mstr_id)||"",wardName:((V=(A=n==null?void 0:n.data)==null?void 0:A.data)==null?void 0:V.ward_no)||"",holdingNo:((S=(F=n==null?void 0:n.data)==null?void 0:F.data)==null?void 0:S.holding_no)||"",propertyNo:((q=(_=n==null?void 0:n.data)==null?void 0:_.data)==null?void 0:q.property_no)||"",name:((B=(v=n==null?void 0:n.data)==null?void 0:v.data)==null?void 0:B.owner_name)||"",propAddress:((L=(Z=n==null?void 0:n.data)==null?void 0:Z.data)==null?void 0:L.prop_address)||"",mobileNo:((U=(E=(R=n==null?void 0:n.data)==null?void 0:R.data)==null?void 0:E.owners[0])==null?void 0:U.mobile_no)||"",arrearDemand:((M=(W=r==null?void 0:r.data)==null?void 0:W.data)==null?void 0:M.arrear)||"",currentDemand:((O=(G=r==null?void 0:r.data)==null?void 0:G.data)==null?void 0:O.currentDemand)||"",interest:((Y=(H=r==null?void 0:r.data)==null?void 0:H.data)==null?void 0:Y.arrearMonthlyPenalty)||"",totalDemand:((J=($=r==null?void 0:r.data)==null?void 0:$.data)==null?void 0:J.payableAmt)||"",changeConsTypeId:"",changeUsagesTypeId:"",latitude:"",longitude:"",document:"",remark:"",citizenComment:""},validationSchema:ye().shape({zoneId:u().required("Zone is required"),wardId:u().required("Ward is required"),latitude:u().required("Latitude is required"),longitude:u().required("Longitude is required"),document:u().required("Document is required"),remark:u().required("Remark is required")}),onSubmit:async(d,{resetForm:N})=>{if(!ie)return b.error("Please enable location service");const t=new FormData;t.append("zoneId",d.zoneId),t.append("wardId",d.wardId),t.append("holdingNo",d.holdingNo||""),t.append("propertyNo",d.propertyNo||""),t.append("name",d.name||""),t.append("propAddress",d.propAddress||""),t.append("mobileNo",d.mobileNo||""),t.append("arrearDemand",d.arrearDemand||""),t.append("currentDemand",d.currentDemand||""),t.append("interest",d.interest||""),t.append("totalDemand",d.totalDemand||""),t.append("changeConsTypeId",d.changeConsTypeId||""),t.append("changeUsagesTypeId",d.changeUsagesTypeId||""),t.append("latitude",d.latitude),t.append("longitude",d.longitude),t.append("document",ce),t.append("remark",d.remark),t.append("citizenComment",d.citizenComment||""),xe.fire({title:"Are you sure?",text:"\n          You are going to submit the application for the visit. Please make sure all the details are correct.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(async m=>{var l,x,ae,ne,de;if(m.isConfirmed)try{const i=await se.mutateAsync({api:h.addVisit,data:t});(l=i==null?void 0:i.data)!=null&&l.status?(b.success((x=i==null?void 0:i.data)==null?void 0:x.message),N(),n.remove(),r.remove(),oe("/amc-app/property/visiting-list",{replace:!0})):b.error((ae=i==null?void 0:i.data)==null?void 0:ae.message)}catch(i){b.error((de=(ne=i==null?void 0:i.response)==null?void 0:ne.data)==null?void 0:de.message)}}).catch(m=>{var l,x;console.log(m),b.error((x=(l=m==null?void 0:m.response)==null?void 0:l.data)==null?void 0:x.message)})}}),{values:o}=a,{data:j,isPending:ze,isError:Te,error:Ae,isLoading:Ve}=f({api:h.getWardByZone,config:{zoneId:o==null?void 0:o.zoneId},value:[o==null?void 0:o.zoneId],options:{enabled:!!(o!=null&&o.zoneId)}}),le=async d=>{var m,l;await((m=window==null?void 0:window.ReactNativeWebView)==null?void 0:m.postMessage(JSON.stringify({Key:"OPEN_CAMERA"})));const N=await Ie(d.target.files[0]),t=new File([N],(l=d.target.files[0])==null?void 0:l.name,{type:"image/*"});a.setFieldValue("latitude",p==null?void 0:p.latitude),a.setFieldValue("longitude",p==null?void 0:p.longitude),a.setFieldValue("document",t),me(t)};return e.jsx(y.Card,{children:e.jsx(y.CardBody,{color:"blue",children:e.jsxs(fe,{formik:a,children:[e.jsx("div",{className:"p-2",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs(te,{name:"zoneId",label:"Zone Name",formik:a,disabled:s,children:[e.jsx("option",{value:"",children:"Select Zone"}),we.map(d=>e.jsx("option",{value:d.value,children:d.label},d.id))]}),e.jsxs(te,{name:"wardId",label:"Ward Name",formik:a,disabled:s,children:[e.jsx("option",{value:"",children:"Select Ward"}),(K=j==null?void 0:j.data)==null?void 0:K.map(d=>e.jsx("option",{value:d.id,children:d.ward_name},d.id))]}),e.jsx(c,{name:"holdingNo",label:"Holding No",formik:a,disabled:s}),e.jsx(c,{name:"propertyNo",label:"Property No",formik:a,disabled:s}),e.jsx(c,{name:"name",label:"Name",formik:a,disabled:s}),e.jsx(c,{name:"propAddress",label:"Address",formik:a,disabled:s}),e.jsx(c,{name:"mobileNo",label:"Mobile No",formik:a,inputValidation:["mobile","number"]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(c,{name:"arrearDemand",label:"Arrear Demand",formik:a,inputValidation:["floatNumber"],disabled:s}),e.jsx(c,{name:"currentDemand",label:"Current Demand",inputValidation:["floatNumber"],formik:a,disabled:s}),e.jsx(c,{name:"interest",label:"Interest",formik:a,inputValidation:["floatNumber"],disabled:s}),e.jsx(c,{name:"totalDemand",label:"Total Demand",formik:a,inputValidation:["floatNumber"],disabled:s}),e.jsx(c,{name:"changeConsTypeId",label:"Change in Construction Type?",placeholder:"Construction Type",formik:a}),e.jsx(c,{name:"changeUsagesTypeId",label:"Change in Usages Type?",placeholder:"Usages Type",formik:a}),e.jsxs("div",{children:[e.jsx(c,{type:"file",label:"Visit Document",capture:"environment",name:"document",id:"document",onChange:d=>{le(d)}}),((Q=a==null?void 0:a.errors)==null?void 0:Q.document)&&e.jsx("span",{className:"text-red-500 text-xs",children:(X=a==null?void 0:a.errors)==null?void 0:X.document}),!((k=a==null?void 0:a.values)!=null&&k.latitude)&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-red-500 text-xs",children:(P=a==null?void 0:a.errors)==null?void 0:P.latitude}),e.jsx("span",{className:"text-red-500 text-xs",children:(D=a==null?void 0:a.errors)==null?void 0:D.longitude})]}),((ee=a==null?void 0:a.values)==null?void 0:ee.document)&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",children:"Latitude: "+(o==null?void 0:o.latitude)}),e.jsx("span",{className:"text-xs",children:" Longitude: "+(o==null?void 0:o.longitude)})]})]}),e.jsx("div",{className:"mt-6",children:e.jsx(re,{name:"remark",label:"Remark",formik:a})}),e.jsx(re,{name:"citizenComment",label:"Citizen Comment",formik:a})]})]})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(y.Button,{size:"sm",type:"submit",className:"btn btn-primary",children:"Submit"})})]})})})}function $e(){const n=new URLSearchParams(window.location.search),r=f({api:h.getPropByHolding,config:{propertyId:n.get("id")},options:{enabled:!!n.get("id")}}),s=f({api:h.getDemandDetails,config:{propId:n.get("id")},options:{enabled:!!n.get("id")}});return e.jsx(be,{title:"Visiting",children:e.jsx("div",{className:"p-2",children:e.jsx(ge,{getPropDetails:r,demandDetails:s,id:n.get("id")})})})}export{$e as default};
