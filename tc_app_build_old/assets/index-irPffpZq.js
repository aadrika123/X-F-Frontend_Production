import{b as Be,d as Ie,e as Le,c as he,p as w,w as Ce,S as N,Q as g,j as e,I as Ae}from"./index-kwyYuGuR.js";import{d as x,u as _e,e as $e,f as Re,r as Se}from"./router-5yjtezO8.js";import{c as xe,b as Ee,a as v,d as qe}from"./index.esm-uHa2PMRf.js";import{r as p}from"./tailwind-6U-kYQAu.js";import{u as Oe,F as Ge}from"./formik.esm-BnzrXcQN.js";import{F as ze}from"./FormProvider-E8aVPPYG.js";import{T as je}from"./TextField-Xxe-cRKK.js";import{T as Ve}from"./TextAreaField-qxkYCnYB.js";import"./index-iFVn5AxS.js";import{P as Me}from"./index-tU9B2LIK.js";import{r as We}from"./resizeImage-2eNOczEw.js";import{u as He}from"./useErrorFocusFields-mwtEYYKc.js";import{O as Ye}from"./OverLayLoader-69Ia_cBz.js";import{u as Ue}from"./usePathWisePermission-4SAnYKn2.js";import"./reactQuery-QTVGT_ni.js";import"./axios-lPgvryBG.js";import"./reactIcons-ElHvrKTF.js";import"./headlessui-iZReL1Rn.js";import"./customInputValidation-jhKsg103.js";import"./module-9-PvGTXA.js";function pt(){var C,A,_,$,R,S,E,q,O,G,z,V,M,W,H,Y,U,J,K,Q,k,X,Z,D,ee,te,ae,se;Be();const[ye,P]=x.useState(""),{AutoFocusErrorField:fe}=He(),[j,be]=x.useState([]),y=_e(),f=Ie({}),[Je,Te]=x.useState(null),{id:m}=$e(),{pathname:b}=Re();Ue((A=(C=b==null?void 0:b.split("/"))==null?void 0:C.slice(0,-1))==null?void 0:A.join("/"));const{coords:h,isGeolocationEnabled:we}=Le(),t=he({api:w.staticSafDetail,config:{applicationId:m},value:[m],options:{enabled:!!m,onSuccess:n=>{var s,i;(s=n==null?void 0:n.data)!=null&&s.status?(P(!1),(i=n==null?void 0:n.data)!=null&&i.is_geo_tagged&&y("/amc-app/property/measurement-sheet/".concat(m),{replace:!0})):P(!0)}}}),T=he({api:(_=Ce)==null?void 0:_.workFlowInfo,config:{workflowId:(R=($=t==null?void 0:t.data)==null?void 0:$.data)==null?void 0:R.workflow_id},value:[(E=(S=t==null?void 0:t.data)==null?void 0:S.data)==null?void 0:E.workflow_id],options:{enabled:!!((O=(q=t==null?void 0:t.data)==null?void 0:q.data)!=null&&O.workflow_id)}}),a=Oe({enableReinitialize:!0,initialValues:{geoTagged:j==null?void 0:j.map(n=>({latitude:"",longitude:"",altitude:"",accuracy:"",imagePath:"",directionType:"",rainWaterHarvesting:""})),comment:""},validationSchema:xe().shape({geoTagged:Ee().of(xe().shape({latitude:v().required("Latitude is required"),longitude:v().required("Longitude is required"),directionType:v().required("Direction is required"),imagePath:qe().required("Image is required")}))}),onSubmit:async n=>{N.fire({title:"Are you sure?",text:"\n        You are going to submit the Geo Tagging. Once submitted, you can't edit the Geo Tagging?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(s=>{s.isConfirmed&&Ne(n)}).catch(s=>{var i,d;console.log(s),g.error((d=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:d.message)})}}),Ne=async n=>{var i,d,c,l,r;const s=new FormData;s.append("safId",m),n==null||n.geoTagged.forEach((o,u)=>{s.append("latitude[".concat(u,"]"),o==null?void 0:o.latitude),s.append("longitude[".concat(u,"]"),o==null?void 0:o.longitude),s.append("directionType[".concat(u,"]"),o==null?void 0:o.directionType),s.append("imagePath[".concat(u,"]"),o==null?void 0:o.imagePath)});try{const o=await f.mutateAsync({api:w.geoTagging,data:s});(i=o==null?void 0:o.data)!=null&&i.status?(g.success((d=o==null?void 0:o.data)==null?void 0:d.message),y("/amc-app/property/measurement-sheet/".concat(m),{replace:!0})):g.error((c=o==null?void 0:o.data)==null?void 0:c.message)}catch(o){g.error((r=(l=o==null?void 0:o.response)==null?void 0:l.data)==null?void 0:r.message)}},{submitCount:F,isSubmitting:B,errors:I,isValid:ve}=a,L=async()=>{var n;if(((n=a==null?void 0:a.values)==null?void 0:n.comment)=="")return g.error("Comment is required !");N.fire({title:"Are you sure?",text:"You are going to backward of this application",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(async s=>{var i,d,c,l;if(s.isConfirmed)try{const r=await f.mutateAsync({api:w.safLevel,data:{applicationId:m,receiverRoleId1:"",action:"backward",comment:((i=a==null?void 0:a.values)==null?void 0:i.comment)||"No Comment"}});(d=r==null?void 0:r.data)!=null&&d.status?(g.success((c=r==null?void 0:r.data)==null?void 0:c.message),y("/amc-app/property/saf-verification-list",{replace:!0})):g.error(((l=r==null?void 0:r.data)==null?void 0:l.message)||"Something went wrong, Please try again")}catch(r){g.error(r==null?void 0:r.message),console.log(r)}}).catch(s=>{var i,d;g.error((d=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:d.message)})},Pe=async(n,s,i)=>{var l,r;await((l=window==null?void 0:window.ReactNativeWebView)==null?void 0:l.postMessage(JSON.stringify({Key:"OPEN_CAMERA"})));const d=await We(n.target.files[0]),c=new File([d],(r=n.target.files[0])==null?void 0:r.name,{type:"image/*"});a.setFieldValue("geoTagged.".concat(s,".latitude"),h==null?void 0:h.latitude),a.setFieldValue("geoTagged.".concat(s,".longitude"),h==null?void 0:h.longitude),a.setFieldValue("geoTagged.".concat(s,".directionType"),i==null?void 0:i.directionType),a.setFieldValue("geoTagged.".concat(s,".imagePath"),c),Te(c)};return Se.useEffect(()=>{var n,s,i;(n=t==null?void 0:t.data)!=null&&n.data&&be((i=(s=t==null?void 0:t.data)==null?void 0:s.data)!=null&&i.is_water_harvesting?[{id:1,title:"Front Image",directionType:"Front"},{id:2,title:"Left Image",directionType:"Left"},{id:3,title:"Right Image",directionType:"Right"},{id:4,title:"Rain Water Harvesting Image",directionType:"waterHarvesting",isRainWaterHarvesting:!0}]:[{id:1,title:"Front Image",directionType:"Front"},{id:2,title:"Left Image",directionType:"Left"},{id:3,title:"Right Image",directionType:"Right"}])},[(z=(G=t==null?void 0:t.data)==null?void 0:G.data)==null?void 0:z.saf_no]),x.useEffect(()=>{fe({submitCount:F,isSubmitting:B,errors:I,isValid:ve})},[I,F,B]),we||N.fire({text:"Geolocation is not enabled! Please enable to use this app",icon:"error",confirmButtonText:"Ok"}),ye?e.jsx("div",{className:"p-16 flex text-center text-red-500 font-semibold h-screen justify-center items-center",children:"Network Error"}):t!=null&&t.isLoading?e.jsx(Ae,{}):e.jsxs(Me,{title:"Geo Tagging",children:[f.isLoading&&e.jsx(Ye,{}),e.jsxs("div",{className:"p-4 ",children:[e.jsx(p.Card,{className:"w-full",children:e.jsxs(p.CardBody,{children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h1",{className:"font-semibold text-sm",children:"Geo Tagging"})}),e.jsx("div",{className:"border-b-2 border-gray-300 w-full py-1"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[e.jsx("h1",{className:"font-semibold text-xs",children:"Application No : "}),e.jsx("h1",{className:"text-xs",children:(M=(V=t==null?void 0:t.data)==null?void 0:V.data)==null?void 0:M.saf_no}),e.jsx("h1",{className:"font-semibold text-xs",children:"Application Type : "}),e.jsx("h1",{className:"text-xs",children:(H=(W=t==null?void 0:t.data)==null?void 0:W.data)==null?void 0:H.assessment_type}),e.jsx("h1",{className:"font-semibold text-xs",children:"Apply Date : "}),e.jsx("h1",{className:"text-xs",children:(U=(Y=t==null?void 0:t.data)==null?void 0:Y.data)==null?void 0:U.application_date}),e.jsx("h1",{className:"font-semibold text-xs",children:"Owner Name : "}),e.jsx("h1",{className:"text-xs",children:(K=(J=t==null?void 0:t.data)==null?void 0:J.data)==null?void 0:K.applicant_name}),e.jsx("h1",{className:"font-semibold text-xs",children:"Mobile No : "}),e.jsx("h1",{className:"text-xs w-40 truncate",children:(Z=(X=(k=(Q=t==null?void 0:t.data)==null?void 0:Q.data)==null?void 0:k.owners)==null?void 0:X.map(n=>n==null?void 0:n.mobile_no))==null?void 0:Z.join(", ")})]})]})}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs(ze,{formik:a,children:[e.jsx(Ge,{name:"geoTagged",children:n=>j.map((s,i)=>{var d,c,l,r,o,u,ie,oe,ne,re,de,ce,le,ge,me,ue,pe;return e.jsxs(x.Fragment,{children:[e.jsxs(p.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-sm font-semibold text-gray-100",children:s==null?void 0:s.title})}),e.jsxs(p.CardBody,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 items-center",children:[e.jsx("h1",{className:"font-semibold text-sm",children:"Latitude : "}),e.jsx(je,{disabled:!0,type:"text",isDynamic:!0,name:"geoTagged.".concat(i,".latitude"),formik:a}),e.jsxs("h1",{className:"font-semibold text-sm",children:["Longitude :"," "]}),e.jsx(je,{disabled:!0,type:"text",isDynamic:!0,name:"geoTagged.".concat(i,".longitude"),formik:a})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 mt-4",children:[e.jsx("div",{children:((c=(d=a==null?void 0:a.values)==null?void 0:d.geoTagged[i])==null?void 0:c.imagePath)&&e.jsx("img",{className:"w-full h-64",loading:"lazy",src:(r=(l=a==null?void 0:a.values)==null?void 0:l.geoTagged[i])!=null&&r.imagePath?URL.createObjectURL((u=(o=a==null?void 0:a.values)==null?void 0:o.geoTagged[i])==null?void 0:u.imagePath):null,alt:(ne=(oe=(ie=a==null?void 0:a.values)==null?void 0:ie.geoTagged[i])==null?void 0:oe.imagePath)==null?void 0:ne.name})}),e.jsxs("div",{children:[e.jsx("input",{type:"file",name:"imagePath",accept:"image/*",onChange:Fe=>Pe(Fe,i,s)}),e.jsx("span",{className:"text-sm text-red-500",children:(ce=(de=(re=a==null?void 0:a.errors)==null?void 0:re.geoTagged)==null?void 0:de[i])==null?void 0:ce.imagePath})]}),e.jsx("div",{children:e.jsx("h1",{className:"text-sm text-red-900",children:((ge=(le=a==null?void 0:a.values)==null?void 0:le.geoTagged[i])==null?void 0:ge.imagePath)&&Math.round(((pe=(ue=(me=a==null?void 0:a.values)==null?void 0:me.geoTagged[i])==null?void 0:ue.imagePath)==null?void 0:pe.size)/1024/1024*100)/100+"MB"})})]})]})]}),e.jsx("div",{className:"my-4 border-b-2"})]},i)})}),e.jsx(Ve,{name:"comment",label:"Comment",formik:a}),e.jsxs("div",{className:"flex justify-center items-center mt-4 gap-3",children:[((ee=(D=t==null?void 0:t.data)==null?void 0:D.data)==null?void 0:ee.assessment_type)=="New Assessment1"?e.jsx(p.Button,{onClick:L,size:"sm",className:"bg-red-500 text-white",children:e.jsx("small",{children:"Back To Lipik"})}):e.jsx(p.Button,{onClick:L,size:"sm",className:"bg-red-500 text-white",children:e.jsx("small",{children:"Back To Back Office"})}),((se=(ae=(te=T==null?void 0:T.data)==null?void 0:te.data)==null?void 0:ae.permissions)==null?void 0:se.can_forward)&&e.jsx(p.Button,{type:"submit",size:"sm",className:"bg-blue-500 text-white",children:e.jsx("small",{children:"Save & Next"})})]})]})]})]})}export{pt as default};
