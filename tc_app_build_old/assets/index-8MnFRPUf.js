import{e as pe,d as xe,Q as x,S as de,p as h,c as f,j as e}from"./index-WOneArS1.js";import{P as he}from"./index-Yzt4p7RF.js";import{u as be,d as je}from"./router-5yjtezO8.js";import{u as Ne}from"./formik.esm-BnzrXcQN.js";import{c as ye,a as p}from"./index.esm-uHa2PMRf.js";import{F as fe}from"./FormProvider-tYY_NSo-.js";import{T as s}from"./TextField-tvzB3N7x.js";import{S as oe}from"./SelectField-rb2Pwzy0.js";import{T as ie}from"./TextAreaField-xQZguQFu.js";import"./index-iFVn5AxS.js";import{r as ge}from"./resizeImage-2RAQVh4b.js";import{r as y}from"./tailwind-6U-kYQAu.js";import"./reactQuery-QTVGT_ni.js";import"./axios-lPgvryBG.js";import"./reactIcons-ElHvrKTF.js";import"./headlessui-iZReL1Rn.js";import"./customInputValidation-jhKsg103.js";const we=[{id:1,label:"Zone A-East",value:"1"},{id:2,label:"Zone B-West",value:"2"},{id:3,label:"Zone C-North",value:"3"},{id:4,label:"Zone D-South",value:"4"}];function Ie({getPropDetails:n,demandDetails:d}){var w,I,C,z,T,A,V,v,S,F,_,q,B,L,Z,R,E,U,W,M,O,G,H,Y,$,J,K,Q,X,k,P,D,ee,ae;const b=be(),{coords:u,isGeolocationEnabled:g,isGeolocationAvailable:se}=pe(),ce=xe({}),[me,le]=je.useState(null),a=Ne({enableReinitialize:!0,initialValues:{zoneName:((I=(w=n==null?void 0:n.data)==null?void 0:w.data)==null?void 0:I.zone_name)||"",zoneId:((z=(C=n==null?void 0:n.data)==null?void 0:C.data)==null?void 0:z.zone_mstr_id)||"",wardId:((A=(T=n==null?void 0:n.data)==null?void 0:T.data)==null?void 0:A.ward_mstr_id)||"",wardName:((v=(V=n==null?void 0:n.data)==null?void 0:V.data)==null?void 0:v.ward_no)||"",holdingNo:((F=(S=n==null?void 0:n.data)==null?void 0:S.data)==null?void 0:F.holding_no)||"",propertyNo:((q=(_=n==null?void 0:n.data)==null?void 0:_.data)==null?void 0:q.property_no)||"",name:((L=(B=n==null?void 0:n.data)==null?void 0:B.data)==null?void 0:L.owner_name)||"",propAddress:((R=(Z=n==null?void 0:n.data)==null?void 0:Z.data)==null?void 0:R.prop_address)||"",mobileNo:((W=(U=(E=n==null?void 0:n.data)==null?void 0:E.data)==null?void 0:U.owners[0])==null?void 0:W.mobile_no)||"",arrearDemand:((O=(M=d==null?void 0:d.data)==null?void 0:M.data)==null?void 0:O.arrear)||"",currentDemand:((H=(G=d==null?void 0:d.data)==null?void 0:G.data)==null?void 0:H.currentDemand)||"",interest:(($=(Y=d==null?void 0:d.data)==null?void 0:Y.data)==null?void 0:$.arrearMonthlyPenalty)||"",totalDemand:((K=(J=d==null?void 0:d.data)==null?void 0:J.data)==null?void 0:K.payableAmt)||"",changeConsTypeId:"",changeUsagesTypeId:"",latitude:"",longitude:"",document:"",remark:"",citizenComment:""},validationSchema:ye().shape({zoneId:p().required("Zone is required"),wardId:p().required("Ward is required"),latitude:p().required("Latitude is required"),longitude:p().required("Longitude is required"),document:p().required("Document is required"),remark:p().required("Remark is required")}),onSubmit:async(t,{resetForm:N})=>{if(!g)return x.error("Please enable location service");const r=new FormData;r.append("zoneId",t.zoneId),r.append("wardId",t.wardId),r.append("holdingNo",t.holdingNo||""),r.append("propertyNo",t.propertyNo||""),r.append("name",t.name||""),r.append("propAddress",t.propAddress||""),r.append("mobileNo",t.mobileNo||""),r.append("arrearDemand",t.arrearDemand||""),r.append("currentDemand",t.currentDemand||""),r.append("interest",t.interest||""),r.append("totalDemand",t.totalDemand||""),r.append("changeConsTypeId",t.changeConsTypeId||""),r.append("changeUsagesTypeId",t.changeUsagesTypeId||""),r.append("latitude",t.latitude),r.append("longitude",t.longitude),r.append("document",me),r.append("remark",t.remark),r.append("citizenComment",t.citizenComment||""),de.fire({title:"Are you sure?",text:"\n          You are going to submit the application for the visit. Please make sure all the details are correct.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(async c=>{var m,l,ne,te,re;if(c.isConfirmed)try{const i=await ce.mutateAsync({api:h.addVisit,data:r});(m=i==null?void 0:i.data)!=null&&m.status?(x.success((l=i==null?void 0:i.data)==null?void 0:l.message),N(),n.remove(),d.remove(),b("/amc-app/property/visiting-list",{replace:!0})):x.error((ne=i==null?void 0:i.data)==null?void 0:ne.message)}catch(i){x.error((re=(te=i==null?void 0:i.response)==null?void 0:te.data)==null?void 0:re.message)}}).catch(c=>{var m,l;console.log(c),x.error((l=(m=c==null?void 0:c.response)==null?void 0:m.data)==null?void 0:l.message)})}}),{values:o}=a,{data:j,isPending:Ce,isError:ze,error:Te,isLoading:Ae}=f({api:h.getWardByZone,config:{zoneId:o==null?void 0:o.zoneId},value:[o==null?void 0:o.zoneId],options:{enabled:!!(o!=null&&o.zoneId)}}),ue=async t=>{var c,m,l;if(!((c=t.target)!=null&&c.files[0]))return;await((m=window==null?void 0:window.ReactNativeWebView)==null?void 0:m.postMessage(JSON.stringify({Key:"OPEN_CAMERA"})));const N=await ge(t.target.files[0]),r=new File([N],(l=t.target.files[0])==null?void 0:l.name,{type:"image/*"});a.setFieldValue("latitude",u==null?void 0:u.latitude),a.setFieldValue("longitude",u==null?void 0:u.longitude),a.setFieldValue("document",r),le(r)};return e.jsx(y.Card,{children:e.jsx(y.CardBody,{color:"blue",children:e.jsxs(fe,{formik:a,children:[e.jsx("div",{className:"p-2",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs(oe,{name:"zoneId",label:"Zone Name",formik:a,children:[e.jsx("option",{value:"",children:"Select Zone"}),we.map(t=>e.jsx("option",{value:t.value,children:t.label},t.id))]}),e.jsxs(oe,{name:"wardId",label:"Ward Name",formik:a,children:[e.jsx("option",{value:"",children:"Select Ward"}),(Q=j==null?void 0:j.data)==null?void 0:Q.map(t=>e.jsx("option",{value:t.id,children:t.ward_name},t.id))]}),e.jsx(s,{name:"holdingNo",label:"Holding No",formik:a}),e.jsx(s,{name:"propertyNo",label:"Property No",formik:a}),e.jsx(s,{name:"name",label:"Name",formik:a}),e.jsx(s,{name:"propAddress",label:"Address",formik:a}),e.jsx(s,{name:"mobileNo",label:"Mobile No",formik:a,inputValidation:["mobile","number"]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx(s,{name:"arrearDemand",label:"Arrear Demand",formik:a,inputValidation:["floatNumber"]}),e.jsx(s,{name:"currentDemand",label:"Current Demand",inputValidation:["floatNumber"],formik:a}),e.jsx(s,{name:"interest",label:"Interest",formik:a,inputValidation:["floatNumber"]}),e.jsx(s,{name:"totalDemand",label:"Total Demand",formik:a,inputValidation:["floatNumber"]}),e.jsx(s,{name:"changeConsTypeId",label:"Change in Construction Type?",placeholder:"Construction Type",formik:a}),e.jsx(s,{name:"changeUsagesTypeId",label:"Change in Usages Type?",placeholder:"Usages Type",formik:a}),e.jsxs("div",{children:[e.jsx(s,{type:"file",label:"Visit Document",capture:"environment",name:"document",accept:"image/*",id:"document",onChange:t=>{if(!g||!se){t.target.value=null,de.fire({title:"Location Service",text:"Please enable location service",icon:"warning",confirmButtonText:"Ok",reverseButtons:!0});return}ue(t)}}),((X=a==null?void 0:a.errors)==null?void 0:X.document)&&e.jsx("span",{className:"text-red-500 text-xs",children:(k=a==null?void 0:a.errors)==null?void 0:k.document}),!((P=a==null?void 0:a.values)!=null&&P.latitude)&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-red-500 text-xs",children:(D=a==null?void 0:a.errors)==null?void 0:D.latitude}),e.jsx("span",{className:"text-red-500 text-xs",children:(ee=a==null?void 0:a.errors)==null?void 0:ee.longitude})]}),((ae=a==null?void 0:a.values)==null?void 0:ae.document)&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-xs",children:"Latitude: "+(o==null?void 0:o.latitude)}),e.jsx("span",{className:"text-xs",children:" Longitude: "+(o==null?void 0:o.longitude)})]})]}),e.jsx("div",{className:"mt-6",children:e.jsx(ie,{name:"remark",label:"Remark",formik:a})}),e.jsx(ie,{name:"citizenComment",label:"Citizen Comment",formik:a})]})]})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(y.Button,{size:"sm",type:"submit",className:"btn btn-primary",children:"Submit"})})]})})})}function Ye(){const n=new URLSearchParams(window.location.search),d=f({api:h.getPropByHolding,config:{propertyId:n.get("id")},options:{enabled:!!n.get("id")}}),b=f({api:h.getDemandDetails,config:{propId:n.get("id")},options:{enabled:!!n.get("id")}});return e.jsx(he,{title:"Visiting",children:e.jsx("div",{className:"p-2",children:e.jsx(Ie,{getPropDetails:d,demandDetails:b})})})}export{Ye as default};
