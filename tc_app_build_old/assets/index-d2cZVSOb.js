import{a as fe,h as be,n as Ne,m as xe,w as f,Q as b,j as e,r as d}from"./index-hiQLm8TA.js";import{u as pe}from"./formik.esm-e4egwEos.js";import{c as ye,a as h,f as he}from"./index.esm-eo5j1FLJ.js";import{F as ue}from"./FormProvider-l751_MOh.js";import{T as N}from"./TextField-TuCHzpng.js";import"./index-AiuV23kC.js";import{P as ge}from"./index-kqmfRL9d.js";import{r as we}from"./resizeImage-o1a1N6AQ.js";function Me(){var y,u,g,w,C,v,T,P,A,F,R,_,M,B,U,I,S,E,L,O,q,D,z,$,G,Y,k,V,Q,W,H,J,K,X,Z,ee,se,ae,te,de,le,re,ne,ie,ce;const p=fe(),j=be({}),{id:l}=Ne(),s=xe({api:f.waterGetDetails,config:{applicationId:l},value:[l],options:{enabled:!!l}}),t=xe({api:f.waterListDemand,config:{ConsumerId:l},value:[l],options:{enabled:!!l}}),i=pe({enableReinitialize:!0,initialValues:{consumerId:l,demandUpto:new Date().toISOString().split("T")[0]||"",finalRading:"",document:"",connectionType:(g=(u=(y=t==null?void 0:t.data)==null?void 0:y.data)==null?void 0:u.meterDetails)==null?void 0:g.connection_type},validationSchema:ye().shape({demandUpto:h().required("Demand Upto is required"),connectionType:h().optional(),finalRading:h().when("connectionType",{is:a=>a==1,then:()=>h().required("Final Meter Reading is required")}),document:he().when("connectionType",{is:a=>a==1,then:()=>he().required("Document is required")})}),onSubmit:async(a,{resetForm:c})=>{var x,m,o,me,oe;console.log(a);try{const r=new FormData;r.append("consumerId",a==null?void 0:a.consumerId),r.append("demandUpto",a==null?void 0:a.demandUpto),r.append("finalRading",a==null?void 0:a.finalRading),r.append("document",a==null?void 0:a.document);const n=await j.mutateAsync({api:f.generateDemandWater,data:r});(x=n==null?void 0:n.data)!=null&&x.status?(b.success((m=n==null?void 0:n.data)==null?void 0:m.message),t.refetch()):b.error((o=n==null?void 0:n.data)==null?void 0:o.message)}catch(r){b.error((oe=(me=r==null?void 0:r.response)==null?void 0:me.data)==null?void 0:oe.message)}c()}}),je=async a=>{var m,o;const c=await we(a.target.files[0]),x=new File([c],(o=(m=a==null?void 0:a.target)==null?void 0:m.files[0])==null?void 0:o.name,{type:"image/*"});i.setFieldValue("document",x)};return e.jsx(ge,{title:"Consumer Details",children:e.jsxs("div",{className:"p-4",children:[e.jsx(d.Card,{children:e.jsxs(d.CardBody,{children:[e.jsx("div",{className:"flex flex-row justify-between mb-3",children:e.jsx("h1",{className:"text-base font-semibold",children:"# Basic Details"})}),e.jsx("div",{className:"my-3 border-b-2"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Applicant name:"}),e.jsx("h1",{className:"text-sm",children:(C=(w=s==null?void 0:s.data)==null?void 0:w.data)==null?void 0:C.applicant_name})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Property No:"}),e.jsx("h1",{className:"text-sm",children:(T=(v=s==null?void 0:s.data)==null?void 0:v.data)==null?void 0:T.folio_no})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Consumer No:"}),e.jsx("h1",{className:"text-sm",children:(A=(P=s==null?void 0:s.data)==null?void 0:P.data)==null?void 0:A.consumer_no})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Reading Date:"}),e.jsx("h1",{className:"text-sm",children:((R=(F=s==null?void 0:s.data)==null?void 0:F.data)==null?void 0:R.reading_date)||"--"})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Address:"}),e.jsx("h1",{className:"text-sm w-36 truncate",children:((M=(_=s==null?void 0:s.data)==null?void 0:_.data)==null?void 0:M.address)||"--"})]})]})]})}),e.jsxs(d.Card,{className:"w-full mt-5",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-base font-semibold text-gray-100",children:"# Meter/Fixed Connection Details"})}),e.jsx(d.CardBody,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Connection Type:"}),e.jsx("h1",{className:"text-sm",children:((I=(U=(B=t==null?void 0:t.data)==null?void 0:B.data)==null?void 0:U.meterDetails)==null?void 0:I.ConnectionTypeName)||"--"})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Meter No:"}),e.jsx("h1",{className:"text-sm",children:(L=(E=(S=s==null?void 0:s.data)==null?void 0:S.data)==null?void 0:E.meterDetails)==null?void 0:L.meter_no})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Last Meter Reading:"}),e.jsx("h1",{className:"text-sm",children:(q=(O=s==null?void 0:s.data)==null?void 0:O.data)==null?void 0:q.finalReading})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Reading Date:"}),e.jsx("h1",{className:"text-sm",children:((z=(D=s==null?void 0:s.data)==null?void 0:D.data)==null?void 0:z.readingdate)||"--"})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Connection Date:"}),e.jsx("h1",{className:"text-sm",children:((Y=(G=($=s==null?void 0:s.data)==null?void 0:$.data)==null?void 0:G.meterDetails)==null?void 0:Y.connection_date)||"--"})]})]})})]}),e.jsxs(d.Card,{className:"mt-4 w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-base font-semibold text-gray-100",children:"Demand List"})}),e.jsx(d.CardBody,{children:e.jsx("div",{className:"relative overflow-x-auto  sm:rounded-lg",children:e.jsxs("table",{className:"w-full text-sm text-left  border-slate-400 border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"# Sno."}),e.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"DEMAND FROM"}),e.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"DEMAND UPTO"}),e.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"DEMAND AMOUNT"}),e.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"PENALTY"}),e.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"CONNECTION TYPE"}),e.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"PAYABLE AMOUNT"})]})}),e.jsx("tbody",{children:(Q=(V=(k=t==null?void 0:t.data)==null?void 0:k.data)==null?void 0:V.consumerDemands)==null?void 0:Q.map((a,c)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm p-4 border border-slate-300",children:c+1}),e.jsx("td",{className:"text-sm p-4 border border-slate-300",children:a.demand_from}),e.jsx("td",{className:"text-sm p-4 border border-slate-300",children:a.demand_upto}),e.jsx("td",{className:"text-sm p-4 border border-slate-300",children:a.balance_amount}),e.jsx("td",{className:"text-sm p-4 border border-slate-300",children:a.penalty}),e.jsx("td",{className:"text-sm p-4 border border-slate-300",children:a.connection_type}),e.jsx("td",{className:"text-sm p-4 border border-slate-300",children:a.amount})]},c))})]})})})]}),e.jsx(ue,{formik:i,children:e.jsxs(d.Card,{className:"mt-4 w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-base font-semibold text-gray-100",children:"Generate Demand"})}),e.jsx(d.CardBody,{children:e.jsxs("div",{className:"my-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[((J=(H=(W=t==null?void 0:t.data)==null?void 0:W.data)==null?void 0:H.meterDetails)==null?void 0:J.connection_type)==1&&e.jsxs(e.Fragment,{children:[e.jsx(N,{formik:i,name:"finalRading",type:"number",placeholder:"Final Meter Reading"}),e.jsxs("div",{children:[e.jsx(N,{accept:"image/*",name:"document",type:"file",onChange:a=>je(a)}),e.jsx("small",{className:"text-red-500 -mt-6",children:(K=i==null?void 0:i.errors)==null?void 0:K.document})]})]}),e.jsx(N,{disabled:!0,name:"demandUpto",type:"text",formik:i})]}),e.jsx("div",{className:"flex flex-row justify-center mt-2 gap-5",children:e.jsx(d.Button,{type:"submit",color:"blue",size:"sm",loading:j.isLoading,disabled:j.isLoading,children:e.jsx("small",{children:"Generate Demand"})})})]})})]})}),e.jsxs(d.Card,{className:"w-full mt-4",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-base font-semibold text-gray-100",children:"Payment Details"})}),e.jsx(d.CardBody,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Total Dues:"}),e.jsxs("h1",{className:"text-sm",children:["â‚¹"," ",(Z=(X=t==null?void 0:t.data)==null?void 0:X.data)==null?void 0:Z.totalSumDemand]})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Due From:"}),e.jsx("h1",{className:"text-sm",children:(se=(ee=s==null?void 0:s.data)==null?void 0:ee.data)==null?void 0:se.demand_from})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Due Upto:"}),e.jsx("h1",{className:"text-sm",children:(te=(ae=s==null?void 0:s.data)==null?void 0:ae.data)==null?void 0:te.demand_upto})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Total Due Demand:"}),e.jsx("h1",{className:"text-sm",children:((le=(de=s==null?void 0:s.data)==null?void 0:de.data)==null?void 0:le.cycle)||"--"})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Total Payable Amount:"}),e.jsxs("h1",{className:"text-sm ",children:["â‚¹ ",((ne=(re=t==null?void 0:t.data)==null?void 0:re.data)==null?void 0:ne.totalSumDemand)||"0"]})]}),e.jsx("div",{className:"my-3 border-b-2"}),e.jsxs("div",{className:"flex flex-row justify-center gap-5",children:[((ce=(ie=t==null?void 0:t.data)==null?void 0:ie.data)==null?void 0:ce.totalSumDemand)>0&&e.jsx(d.Button,{color:"blue",size:"sm",onClick:()=>p("/amc-app/water/water-payment/".concat(l)),children:e.jsx("small",{children:"Pay Demand"})}),e.jsx(d.Button,{color:"red",size:"sm",onClick:()=>p("/amc-app/water/demand-receipt/".concat(l)),children:e.jsx("small",{children:"Print Demand"})})]})]})})]})]})})}export{Me as default};
