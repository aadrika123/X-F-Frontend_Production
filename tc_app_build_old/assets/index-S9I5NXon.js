import{u as ue,b as me,g as pe,a as he,p as k,S as ee,Q as x,j as e,f as xe}from"./index-TVKchaO_.js";import{R as p,u as je,h as ye,f as fe,r as be,e as j}from"./react-HXRlOr-l.js";import{c as te,e as Te,a as f,f as Ne}from"./index.esm-yBrOrWJe.js";import{u as ve,F as we}from"./formik.esm-BYe_KACy.js";import{F as Pe}from"./FormProvider-VQsTVwN5.js";import{T as ae}from"./TextField-pss9rZ3n.js";import"./index-mWJwE1Yp.js";import{P as Fe}from"./index-NthHsoqN.js";import{r as Le}from"./resizeImage-8bp6sw-e.js";import{u as $e}from"./useErrorFocusFields-o-KJnuHP.js";import{O as Ie}from"./OverLayLoader-QvWTNKX1.js";import{u as Re}from"./usePathWisePermission-NKSe41Dl.js";import"./module-_E3xZESp.js";function Ue(){var F,L,$,I,R,A,E,S,C,_,q,B,G,O,V,M;ue();const[se,b]=p.useState(""),{AutoFocusErrorField:ie}=$e(),[h,oe]=p.useState([]),T=je(),N=me({}),[Ae,re]=p.useState(null),{id:u}=ye(),{pathname:y}=fe();Re((L=(F=y==null?void 0:y.split("/"))==null?void 0:F.slice(0,-1))==null?void 0:L.join("/"));const{coords:m,isGeolocationEnabled:ne}=pe(),i=he({api:k.staticSafDetail,config:{applicationId:u},value:[u],options:{enabled:!!u,onSuccess:r=>{var a,o;(a=r==null?void 0:r.data)!=null&&a.status?(b(!1),(o=r==null?void 0:r.data)!=null&&o.is_geo_tagged&&T("/amc-app/property/measurement-sheet/".concat(u),{replace:!0})):b(!0)}}}),t=ve({enableReinitialize:!0,initialValues:{geoTagged:h==null?void 0:h.map(r=>({latitude:"",longitude:"",altitude:"",accuracy:"",imagePath:"",directionType:"",rainWaterHarvesting:""}))},validationSchema:te().shape({geoTagged:Te().of(te().shape({latitude:f().required("Latitude is required"),longitude:f().required("Longitude is required"),directionType:f().required("Direction is required"),imagePath:Ne().required("Image is required")}))}),onSubmit:async r=>{ee.fire({title:"Are you sure?",text:"\n        You are going to submit the Geo Tagging. Once submitted, you can't edit the Geo Tagging?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(a=>{a.isConfirmed&&de(r)}).catch(a=>{var o,n;console.log(a),x.error((n=(o=a==null?void 0:a.response)==null?void 0:o.data)==null?void 0:n.message)})}}),de=async r=>{var o,n,d,l,c;const a=new FormData;a.append("safId",u),r==null||r.geoTagged.forEach((s,g)=>{a.append("latitude[".concat(g,"]"),s==null?void 0:s.latitude),a.append("longitude[".concat(g,"]"),s==null?void 0:s.longitude),a.append("directionType[".concat(g,"]"),s==null?void 0:s.directionType),a.append("imagePath[".concat(g,"]"),s==null?void 0:s.imagePath)});try{const s=await N.mutateAsync({api:k.geoTagging,data:a});(o=s==null?void 0:s.data)!=null&&o.status?(x.success((n=s==null?void 0:s.data)==null?void 0:n.message),T("/amc-app/property/measurement-sheet/".concat(u),{replace:!0})):x.error((d=s==null?void 0:s.data)==null?void 0:d.message)}catch(s){x.error((c=(l=s==null?void 0:s.response)==null?void 0:l.data)==null?void 0:c.message)}},{submitCount:v,isSubmitting:w,errors:P,isValid:le}=t,ce=async(r,a,o)=>{var l,c;await((l=window==null?void 0:window.ReactNativeWebView)==null?void 0:l.postMessage(JSON.stringify({Key:"OPEN_CAMERA"})));const n=await Le(r.target.files[0]),d=new File([n],(c=r.target.files[0])==null?void 0:c.name,{type:"image/*"});t.setFieldValue("geoTagged.".concat(a,".latitude"),m==null?void 0:m.latitude),t.setFieldValue("geoTagged.".concat(a,".longitude"),m==null?void 0:m.longitude),t.setFieldValue("geoTagged.".concat(a,".directionType"),o==null?void 0:o.directionType),t.setFieldValue("geoTagged.".concat(a,".imagePath"),d),re(d)};return be.useEffect(()=>{var r,a,o;(r=i==null?void 0:i.data)!=null&&r.data&&oe((o=(a=i==null?void 0:i.data)==null?void 0:a.data)!=null&&o.is_water_harvesting?[{id:1,title:"Front Image",directionType:"Front"},{id:2,title:"Left Image",directionType:"Left"},{id:3,title:"Right Image",directionType:"Right"},{id:4,title:"Rain Water Harvesting Image",directionType:"waterHarvesting",isRainWaterHarvesting:!0}]:[{id:1,title:"Front Image",directionType:"Front"},{id:2,title:"Left Image",directionType:"Left"},{id:3,title:"Right Image",directionType:"Right"}])},[(I=($=i==null?void 0:i.data)==null?void 0:$.data)==null?void 0:I.saf_no]),p.useEffect(()=>{ie({submitCount:v,isSubmitting:w,errors:P,isValid:le})},[P,v,w]),ne||ee.fire({text:"Geolocation is not enabled! Please enable to use this app",icon:"error",confirmButtonText:"Ok"}),se?e.jsx("div",{className:"p-16 flex text-center text-red-500 font-semibold h-screen justify-center items-center",children:"Network Error"}):i!=null&&i.isLoading?e.jsx(xe,{}):e.jsxs(Fe,{title:"Geo Tagging",children:[N.isLoading&&e.jsx(Ie,{}),e.jsxs("div",{className:"p-4 ",children:[e.jsx(j.Card,{className:"w-full",children:e.jsxs(j.CardBody,{children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h1",{className:"font-semibold",children:"Geo Tagging"})}),e.jsx("div",{className:"border-b-2 border-gray-300 w-full py-1"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[e.jsx("h1",{className:"font-semibold text-sm",children:"Application No : "}),e.jsx("h1",{className:"text-sm",children:(A=(R=i==null?void 0:i.data)==null?void 0:R.data)==null?void 0:A.saf_no}),e.jsx("h1",{className:"font-semibold text-sm",children:"Application Type : "}),e.jsx("h1",{className:"text-sm",children:(S=(E=i==null?void 0:i.data)==null?void 0:E.data)==null?void 0:S.assessment_type}),e.jsx("h1",{className:"font-semibold text-sm",children:"Apply Date : "}),e.jsx("h1",{className:"text-sm",children:(_=(C=i==null?void 0:i.data)==null?void 0:C.data)==null?void 0:_.application_date}),e.jsx("h1",{className:"font-semibold text-sm",children:"Owner Name : "}),e.jsx("h1",{className:"text-sm",children:(B=(q=i==null?void 0:i.data)==null?void 0:q.data)==null?void 0:B.applicant_name}),e.jsx("h1",{className:"font-semibold text-sm",children:"Mobile No : "}),e.jsx("h1",{className:"text-sm w-40 truncate",children:(M=(V=(O=(G=i==null?void 0:i.data)==null?void 0:G.data)==null?void 0:O.owners)==null?void 0:V.map(r=>r==null?void 0:r.mobile_no))==null?void 0:M.join(", ")})]})]})}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs(Pe,{formik:t,children:[e.jsx(we,{name:"geoTagged",children:r=>h.map((a,o)=>{var n,d,l,c,s,g,W,H,z,U,Y,J,K,Q,X,Z,D;return e.jsxs(p.Fragment,{children:[e.jsxs(j.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-base font-semibold text-gray-100",children:a==null?void 0:a.title})}),e.jsxs(j.CardBody,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 items-center",children:[e.jsx("h1",{className:"font-semibold text-sm",children:"Latitude : "}),e.jsx(ae,{disabled:!0,type:"text",isDynamic:!0,name:"geoTagged.".concat(o,".latitude"),formik:t}),e.jsxs("h1",{className:"font-semibold text-sm",children:["Longitude :"," "]}),e.jsx(ae,{disabled:!0,type:"text",isDynamic:!0,name:"geoTagged.".concat(o,".longitude"),formik:t})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 mt-4",children:[e.jsx("div",{children:((d=(n=t==null?void 0:t.values)==null?void 0:n.geoTagged[o])==null?void 0:d.imagePath)&&e.jsx("img",{className:"w-full h-64",src:(c=(l=t==null?void 0:t.values)==null?void 0:l.geoTagged[o])!=null&&c.imagePath?URL.createObjectURL((g=(s=t==null?void 0:t.values)==null?void 0:s.geoTagged[o])==null?void 0:g.imagePath):null,alt:(z=(H=(W=t==null?void 0:t.values)==null?void 0:W.geoTagged[o])==null?void 0:H.imagePath)==null?void 0:z.name})}),e.jsxs("div",{children:[e.jsx("input",{type:"file",name:"imagePath",accept:"image/*",onChange:ge=>ce(ge,o,a)}),e.jsx("span",{className:"text-sm text-red-500",children:(J=(Y=(U=t==null?void 0:t.errors)==null?void 0:U.geoTagged)==null?void 0:Y[o])==null?void 0:J.imagePath})]}),e.jsx("div",{children:e.jsx("h1",{className:"text-sm text-red-900",children:((Q=(K=t==null?void 0:t.values)==null?void 0:K.geoTagged[o])==null?void 0:Q.imagePath)&&Math.round(((D=(Z=(X=t==null?void 0:t.values)==null?void 0:X.geoTagged[o])==null?void 0:Z.imagePath)==null?void 0:D.size)/1024/1024*100)/100+"MB"})})]})]})]}),e.jsx("div",{className:"my-4 border-b-2"})]},o)})}),e.jsx("div",{className:"flex justify-center items-center mt-4",children:e.jsx("button",{type:"submit",className:"bg-blue-600 px-4 py-2 rounded-lg text-white text-sm font-semibold hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-300 ease-in-out",children:"Save & Next"})})]})]})]})}export{Ue as default};
