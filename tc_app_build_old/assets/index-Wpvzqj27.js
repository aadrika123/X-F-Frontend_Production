import{d as Ke,c as I,p as j,w as Oe,S as Pe,Q as p,j as e,I as qe}from"./index-WOneArS1.js";import{d as w,u as Ye,e as $e}from"./router-5yjtezO8.js";import{u as Ge}from"./formik.esm-BnzrXcQN.js";import{c as We,d as _e,a as Qe}from"./index.esm-uHa2PMRf.js";import{F as He}from"./FormProvider-tYY_NSo-.js";import{T as Je}from"./TextAreaField-xQZguQFu.js";import"./index-iFVn5AxS.js";import{r as y}from"./tailwind-6U-kYQAu.js";import{P as Xe}from"./index-Yzt4p7RF.js";import{r as Se}from"./resizeImage-2RAQVh4b.js";import{O as Ze}from"./OverLayLoader-9RMtcuZj.js";import{M as Le}from"./MyPDFViewer-4Nid4MWI.js";import"./reactQuery-QTVGT_ni.js";import"./axios-lPgvryBG.js";import"./reactIcons-ElHvrKTF.js";import"./headlessui-iZReL1Rn.js";import"./customInputValidation-jhKsg103.js";import"./module-BfMCOiBc.js";/* empty css              */import"./reactPdfViewerCore-_DhfwgKt.js";import"./reactPdfViewerDefaultLayout-2IVdmRVg.js";function wt(){var B,U,E,z,V,K,O,q,Y,$,G,W,Q,H,J,X,Z,k,D,ee,te,ae,se,ne,re,ie,oe,de,ce,le,me,pe,xe,ue,ge,he,ye,je,be,we,fe,Ne,Ae,Re;const[f,T]=w.useState(""),N=Ye(),b=Ke({}),[A,M]=w.useState(""),[P,_]=w.useState(""),[R,S]=w.useState(""),[ke,L]=w.useState(""),{id:u}=$e(),t=I({api:j.staticSafDetail,config:{applicationId:u},value:[u],options:{enabled:!!u}}),C=I({api:j.staticSafDetailForVerification,config:{applicationId:u},value:[u],options:{enabled:!!u}}),v=I({api:(B=Oe)==null?void 0:B.workFlowInfo,config:{workflowId:(E=(U=t==null?void 0:t.data)==null?void 0:U.data)==null?void 0:E.workflow_id},value:[(V=(z=t==null?void 0:t.data)==null?void 0:z.data)==null?void 0:V.workflow_id],options:{enabled:!!((O=(K=t==null?void 0:t.data)==null?void 0:K.data)!=null&&O.workflow_id)}}),F=()=>{var n,i,o;return(o=(i=(n=C==null?void 0:C.data)==null?void 0:n.data)==null?void 0:i.lastTcFloorVerificationData)==null?void 0:o.reduce((m,d)=>m+(d==null?void 0:d.rent_amount),0)};console.log(F());const s=Ge({initialValues:{uploadMeasurement:"",comment:"",rentDocCode:"RENT AGREEMENT",rentAgreementDocument:null,rentDocCategory:"Rent Agreement"},validationSchema:We({uploadMeasurement:((Y=(q=t==null?void 0:t.data)==null?void 0:q.data)==null?void 0:Y.applied_by)=="TC"||((G=($=t==null?void 0:t.data)==null?void 0:$.data)==null?void 0:G.applied_by)=="TC Reassesment"?_e().notRequired():_e().required("Measurement Sheet is required").test("fileSize","Max 10 mb file size",a=>(a==null?void 0:a.size)<=1e7),comment:Qe().label("Comment").min(2).max(500)}),onSubmit:async a=>{Pe.fire({title:"Are you sure?",text:"\n       You are going to forward the application to the ".concat(f==="LIPIK"?"Lipik":"Nagar Rachna"),icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(n=>{n.isConfirmed&&Be(a)}).catch(n=>{var i,o;console.log(n),p.error((o=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:o.message)})}}),Be=async a=>{var n,i,o,m,d,r,x,c,Ce,ve,Fe,Ie,Te,Me;if(await Ve(),((i=(n=t==null?void 0:t.data)==null?void 0:n.data)==null?void 0:i.applied_by)=="TC"||((m=(o=t==null?void 0:t.data)==null?void 0:o.data)==null?void 0:m.applied_by)=="TC Reassesment")try{const l=await b.mutateAsync({api:j.safLevelV2,data:{applicationId:u,receiverRoleId:f==="LIPIK"?"6":"7",action:"forward",comment:(a==null?void 0:a.comment)||"OK"}});(d=l==null?void 0:l.data)!=null&&d.status?(p.success((r=l==null?void 0:l.data)==null?void 0:r.message),N("/amc-app/property/saf-verification-list",{replace:!0})):p.error((x=l==null?void 0:l.data)==null?void 0:x.message)}catch(l){p.error((c=l==null?void 0:l.data)==null?void 0:c.message)}else{const l=new FormData;l.append("applicationId",u),l.append("document",a==null?void 0:a.uploadMeasurement);try{const g=await b.mutateAsync({api:j.uploadMeasurementSheetApi,data:l});if((Ce=g==null?void 0:g.data)!=null&&Ce.status){const h=await b.mutateAsync({api:j.safLevelV2,data:{applicationId:u,receiverRoleId:f==="LIPIK"?"6":"7",action:"forward",comment:(a==null?void 0:a.comment)||"OK"}});(ve=h==null?void 0:h.data)!=null&&ve.status?(p.success((Fe=h==null?void 0:h.data)==null?void 0:Fe.message),N("/amc-app/property/saf-verification-list",{replace:!0})):p.error((Ie=h==null?void 0:h.data)==null?void 0:Ie.message)}else p.error((Te=g==null?void 0:g.data)==null?void 0:Te.message)}catch(g){p.error((Me=g==null?void 0:g.data)==null?void 0:Me.message)}}},Ue=async()=>{var a;if(((a=s==null?void 0:s.values)==null?void 0:a.comment)=="")return p.error("Comment is required !");Pe.fire({title:"Are you sure?",text:"You are going to backward of this application",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(async n=>{var i,o,m,d;if(n.isConfirmed)try{const r=await b.mutateAsync({api:j.safLevel,data:{applicationId:u,receiverRoleId1:"",action:"backward",comment:((i=s==null?void 0:s.values)==null?void 0:i.comment)||"No Comment"}});(o=r==null?void 0:r.data)!=null&&o.status?(p.success((m=r==null?void 0:r.data)==null?void 0:m.message),N("/amc-app/property/saf-verification-list",{replace:!0})):p.error(((d=r==null?void 0:r.data)==null?void 0:d.message)||"Something went wrong, Please try again")}catch(r){p.error(r==null?void 0:r.message),console.log(r)}}).catch(n=>{var i,o;p.error((o=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:o.message)})},Ee=async a=>{var i,o,m;const n=a.target.files[0];if((n==null?void 0:n.type)==="application/pdf"){const d=new FileReader;d.onload=r=>{M(r.target.result),_(n.name.split(".").pop())},d.readAsDataURL(n),s.setFieldValue("uploadMeasurement",n)}else{const d=await Se((i=a==null?void 0:a.target)==null?void 0:i.files[0]),r=new File([d],(m=(o=a==null?void 0:a.target)==null?void 0:o.files[0])==null?void 0:m.name,{type:"image/*"}),x=new FileReader;x.onload=c=>{M(c.target.result),_(r.name.split(".").pop())},x.readAsDataURL(r),s.setFieldValue("uploadMeasurement",r)}},ze=async a=>{var i,o,m;const n=a.target.files[0];if((n==null?void 0:n.type)==="application/pdf"){const d=new FileReader;d.onload=r=>{S(r.target.result),L(n.name.split(".").pop())},d.readAsDataURL(n),s.setFieldValue("rentAgreementDocument",n)}else{const d=await Se((i=a==null?void 0:a.target)==null?void 0:i.files[0]),r=new File([d],(m=(o=a==null?void 0:a.target)==null?void 0:o.files[0])==null?void 0:m.name,{type:"image/*"}),x=new FileReader;x.onload=c=>{S(c.target.result),L(r.name.split(".").pop())},x.readAsDataURL(r),s.setFieldValue("rentAgreementDocument",r)}},Ve=async a=>{var n,i,o,m,d,r;if(F()>0&&((n=s==null?void 0:s.values)!=null&&n.rentAgreementDocument)){const x=new FormData;x.append("applicationId",u),x.append("docCode","RENT AGREEMENT"),x.append("docCategory","Rent Agreement"),x.append("document",(i=s==null?void 0:s.values)==null?void 0:i.rentAgreementDocument);try{const c=await b.mutateAsync({api:j.documentUpload,data:x});(o=c==null?void 0:c.data)!=null&&o.status?p.success((m=c==null?void 0:c.data)==null?void 0:m.message):p.error((d=c==null?void 0:c.data)==null?void 0:d.message)}catch(c){p.error((r=c==null?void 0:c.data)==null?void 0:r.message)}}};return t!=null&&t.isLoading?e.jsx(qe,{}):e.jsxs(Xe,{title:"Measurement",children:[b.isLoading&&e.jsx(Ze,{}),e.jsx(He,{formik:s,children:e.jsxs("div",{className:"p-4 ",children:[e.jsx(y.Card,{className:"w-full",children:e.jsxs(y.CardBody,{children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h1",{className:"font-semibold text-sm",children:"Application Details"})}),e.jsx("div",{className:"border-b-2 border-gray-300 w-full py-1"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[e.jsx("h1",{className:"font-semibold text-xs",children:"Application No : "}),e.jsx("h1",{className:"text-xs",children:(Q=(W=t==null?void 0:t.data)==null?void 0:W.data)==null?void 0:Q.saf_no}),e.jsx("h1",{className:"font-semibold text-xs",children:"Application Type : "}),e.jsx("h1",{className:"text-xs",children:(J=(H=t==null?void 0:t.data)==null?void 0:H.data)==null?void 0:J.assessment_type}),e.jsx("h1",{className:"font-semibold text-xs",children:"Apply Date : "}),e.jsx("h1",{className:"text-xs",children:(Z=(X=t==null?void 0:t.data)==null?void 0:X.data)==null?void 0:Z.application_date}),e.jsx("h1",{className:"font-semibold text-xs",children:"Owner Name : "}),e.jsx("h1",{className:"text-xs",children:(D=(k=t==null?void 0:t.data)==null?void 0:k.data)==null?void 0:D.applicant_name}),e.jsx("h1",{className:"font-semibold text-xs",children:"Mobile No : "}),e.jsx("h1",{className:"text-xs w-40 truncate",children:(se=(ae=(te=(ee=t==null?void 0:t.data)==null?void 0:ee.data)==null?void 0:te.owners)==null?void 0:ae.map(a=>a==null?void 0:a.mobile_no))==null?void 0:se.join(", ")})]})]})}),F()>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs(y.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-xs font-semibold text-gray-100",children:"Rent Agreement"})}),R&&(P==="pdf"?e.jsx(Le,{fileUrl:R}):e.jsx("div",{className:"flex justify-center px-4 py-2",children:e.jsx("img",{src:R,alt:"preview",loading:"lazy"})})),e.jsx(y.CardBody,{children:e.jsx("div",{className:"grid grid-cols-1 justify-center gap-5",children:((re=(ne=t==null?void 0:t.data)==null?void 0:ne.data)==null?void 0:re.applied_by)!="TC"&&((oe=(ie=t==null?void 0:t.data)==null?void 0:ie.data)==null?void 0:oe.applied_by)!="TC Reassesment"&&e.jsxs("div",{children:[e.jsx("div",{className:"mb-1",children:e.jsx("h1",{className:"font-semibold text-xs",children:"Upload Rent Agreement"})}),e.jsx("input",{type:"file",accept:"application/pdf, image/*",name:"rentAgreementDocument",onChange:ze,className:"border border-gray-300 p-2 w-full rounded-lg"}),e.jsx("small",{className:"text-red-500",children:((de=s==null?void 0:s.errors)==null?void 0:de.rentAgreementDocument)&&((ce=s==null?void 0:s.touched)==null?void 0:ce.rentAgreementDocument)&&((le=s==null?void 0:s.errors)==null?void 0:le.rentAgreementDocument)})]})})})]}),e.jsx("div",{className:"my-4 border-b-2"})]}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs(y.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-xs font-semibold text-gray-100",children:((pe=(me=t==null?void 0:t.data)==null?void 0:me.data)==null?void 0:pe.applied_by)=="TC"||((ue=(xe=t==null?void 0:t.data)==null?void 0:xe.data)==null?void 0:ue.applied_by)=="TC Reassesment"?"Comment":"Upload Measurement Sheet"})}),A&&(P==="pdf"?e.jsx(Le,{fileUrl:A}):e.jsx("div",{className:"flex justify-center px-4 py-2",children:e.jsx("img",{src:A,alt:"preview",loading:"lazy"})})),e.jsx(y.CardBody,{children:e.jsxs("div",{className:"grid grid-cols-1 justify-center gap-5",children:[((he=(ge=t==null?void 0:t.data)==null?void 0:ge.data)==null?void 0:he.applied_by)!="TC"&&((je=(ye=t==null?void 0:t.data)==null?void 0:ye.data)==null?void 0:je.applied_by)!="TC Reassesment"&&e.jsxs("div",{children:[e.jsx("div",{className:"mb-1",children:e.jsx("h1",{className:"font-semibold text-xs",children:"Upload Measurement Sheet"})}),e.jsx("input",{type:"file",accept:"application/pdf, image/*",name:"uploadMeasurement",onChange:Ee,className:"border border-gray-300 p-2 w-full rounded-lg"}),e.jsx("small",{className:"text-red-500",children:((be=s==null?void 0:s.errors)==null?void 0:be.uploadMeasurement)&&((we=s==null?void 0:s.touched)==null?void 0:we.uploadMeasurement)&&((fe=s==null?void 0:s.errors)==null?void 0:fe.uploadMeasurement)})]}),e.jsx("div",{children:e.jsx(Je,{label:"Comment",name:"comment",formik:s,placeholder:"Comment"})})]})})]}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"justify-center items-center mt-4 gap-3",children:[e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(y.Button,{onClick:Ue,size:"sm",className:"bg-red-500 text-white",children:e.jsx("small",{children:"Back To Back Office"})})}),((Re=(Ae=(Ne=v==null?void 0:v.data)==null?void 0:Ne.data)==null?void 0:Ae.permissions)==null?void 0:Re.can_forward)&&e.jsxs("div",{className:"flex justify-center items-center gap-2 mt-4",children:[e.jsx(y.Button,{type:"submit",onClick:()=>T("LIPIK"),size:"sm",className:"bg-blue-500 text-white",children:e.jsx("small",{children:"Send To Lipik "})}),e.jsx(y.Button,{type:"submit",size:"sm",onClick:()=>T("SR_LIPIK"),className:"bg-green-500 text-white",children:e.jsx("small",{children:"Send To Nagar Rachna"})})]})]})})]})})]})}export{wt as default};
