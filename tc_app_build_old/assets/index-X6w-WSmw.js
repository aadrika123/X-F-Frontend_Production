import{R as p,a as se,e as ie,i as de,o as re,b as le,p as x,Q as J,c as oe,j as e,r as u}from"./index-26-p7w-4.js";import{c as K,e as ne,a as j,f as ce}from"./index.esm-n36fjmXy.js";import{u as ge,F as me}from"./formik.esm-gFKTrVOh.js";import{F as pe}from"./FormProvider-GwJgoio4.js";import{T as Q}from"./TextField-zZnWSXtK.js";import{T as ue}from"./TextAreaField-0DEITOsD.js";import"./index-Z8Y5rR5v.js";import{P as he}from"./index-rgo8Sp6i.js";import{r as xe}from"./resizeImage-A2iU0jd7.js";import{u as je}from"./useErrorFocusFields-q-HWbRGN.js";import{O as ye}from"./OverLayLoader-59B1eoh1.js";import"./module-_r_IM6SB.js";function Ee(){var v,f,F,w,P,I,L,R,$,A,E,C;const{AutoFocusErrorField:X}=je(),[y,Y]=p.useState([]),Z=se(),h=ie({}),[be,D]=p.useState(null),{id:m}=de(),{coords:g,isGeolocationEnabled:k}=re(),t=le({api:x.staticSafDetail,config:{applicationId:m},value:[m],options:{enabled:!!m}}),a=ge({enableReinitialize:!0,initialValues:{comment:"",geoTagged:y.map(l=>({latitude:"",longitude:"",altitude:"",accuracy:"",imagePath:"",directionType:"",rainWaterHarvesting:""}))},validationSchema:K().shape({geoTagged:ne().of(K().shape({latitude:j().required("Latitude is required"),longitude:j().required("Longitude is required"),directionType:j().required("Direction is required"),imagePath:ce().required("Image is required")}))}),onSubmit:async l=>{var s,c,o,n;const i=new FormData;i.append("safId",m),l.geoTagged.forEach((d,r)=>{i.append("latitude[".concat(r,"]"),d.latitude),i.append("longitude[".concat(r,"]"),d.longitude),i.append("directionType[".concat(r,"]"),d.directionType),i.append("imagePath[".concat(r,"]"),d.imagePath)});try{const d=await h.mutateAsync({api:x.geoTagging,data:i});if((s=d==null?void 0:d.data)!=null&&s.status){const r=await h.mutateAsync({api:x.safLevel,data:{applicationId:m,receiverRoleId1:"",action:"forward",comment:l.comment}});J.success((c=r==null?void 0:r.data)==null?void 0:c.message),Z("/amc-app/property/saf-verification-list",{replace:!0})}}catch(d){J.error((n=(o=d==null?void 0:d.response)==null?void 0:o.data)==null?void 0:n.message)}}}),{submitCount:b,isSubmitting:T,errors:N,isValid:ee}=a,ae=async(l,i,s)=>{var n;await((n=window==null?void 0:window.ReactNativeWebView)==null?void 0:n.postMessage(JSON.stringify({Key:"OPEN_CAMERA"})));const c=await xe(l.target.files[0]),o=new File([c],l.target.files[0].name,{type:"image/*"});console.log(Math.round(o.size/1024/1024*100)/100+"MB"),a.setFieldValue("geoTagged.".concat(i,".latitude"),g==null?void 0:g.latitude),a.setFieldValue("geoTagged.".concat(i,".longitude"),g==null?void 0:g.longitude),a.setFieldValue("geoTagged.".concat(i,".directionType"),s==null?void 0:s.directionType),a.setFieldValue("geoTagged.".concat(i,".imagePath"),o),D(o)};return oe.useEffect(()=>{var l,i,s;(l=t==null?void 0:t.data)!=null&&l.data&&Y((s=(i=t==null?void 0:t.data)==null?void 0:i.data)!=null&&s.is_water_harvesting?[{id:1,title:"Front Image",directionType:"Front"},{id:2,title:"Left Image",directionType:"Left"},{id:3,title:"Right Image",directionType:"Right"},{id:4,title:"Rain Water Harvesting Image",directionType:"waterHarvesting",isRainWaterHarvesting:!0}]:[{id:1,title:"Front Image",directionType:"Front"},{id:2,title:"Left Image",directionType:"Left"},{id:3,title:"Right Image",directionType:"Right"}])},[(f=(v=t==null?void 0:t.data)==null?void 0:v.data)==null?void 0:f.saf_no]),p.useEffect(()=>{X({submitCount:b,isSubmitting:T,errors:N,isValid:ee})},[N,b,T]),k||alert("Geolocation is not enabled! Please enable to use this app"),e.jsxs(he,{title:"Geo Tagging",children:[h.isLoading&&e.jsx(ye,{}),e.jsxs("div",{className:"p-4 ",children:[e.jsx(u.Card,{className:"w-full",children:e.jsxs(u.CardBody,{children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h1",{className:"font-semibold",children:"Geo Tagging"})}),e.jsx("div",{className:"border-b-2 border-gray-300 w-full py-1"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[e.jsx("h1",{className:"font-semibold text-sm",children:"Application No : "}),e.jsx("h1",{className:"text-sm",children:(w=(F=t==null?void 0:t.data)==null?void 0:F.data)==null?void 0:w.saf_no}),e.jsx("h1",{className:"font-semibold text-sm",children:"Application Type : "}),e.jsx("h1",{className:"text-sm",children:(I=(P=t==null?void 0:t.data)==null?void 0:P.data)==null?void 0:I.assessment_type}),e.jsx("h1",{className:"font-semibold text-sm",children:"Apply Date : "}),e.jsx("h1",{className:"text-sm",children:(R=(L=t==null?void 0:t.data)==null?void 0:L.data)==null?void 0:R.application_date}),e.jsx("h1",{className:"font-semibold text-sm",children:"Owner Name : "}),e.jsx("h1",{className:"text-sm",children:(A=($=t==null?void 0:t.data)==null?void 0:$.data)==null?void 0:A.applicant_name}),e.jsx("h1",{className:"font-semibold text-sm",children:"Mobile No : "}),e.jsx("h1",{className:"text-sm",children:(C=(E=t==null?void 0:t.data)==null?void 0:E.data)==null?void 0:C.mobile_no})]})]})}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs(pe,{formik:a,children:[e.jsx(me,{name:"geoTagged",children:l=>y.map((i,s)=>{var c,o,n,d,r,_,q,G,M,S,V,O,z,B,H,W,U;return e.jsxs(p.Fragment,{children:[e.jsxs(u.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-base font-semibold text-gray-100",children:i==null?void 0:i.title})}),e.jsxs(u.CardBody,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 items-center",children:[e.jsx("h1",{className:"font-semibold text-sm",children:"Latitude : "}),e.jsx(Q,{disabled:!0,type:"text",isDynamic:!0,name:"geoTagged.".concat(s,".latitude"),formik:a}),e.jsxs("h1",{className:"font-semibold text-sm",children:["Longitude :"," "]}),e.jsx(Q,{disabled:!0,type:"text",isDynamic:!0,name:"geoTagged.".concat(s,".longitude"),formik:a})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 mt-4",children:[e.jsx("div",{children:((o=(c=a==null?void 0:a.values)==null?void 0:c.geoTagged[s])==null?void 0:o.imagePath)&&e.jsx("img",{className:"w-full h-64",src:(d=(n=a==null?void 0:a.values)==null?void 0:n.geoTagged[s])!=null&&d.imagePath?URL.createObjectURL((_=(r=a==null?void 0:a.values)==null?void 0:r.geoTagged[s])==null?void 0:_.imagePath):null,alt:(M=(G=(q=a==null?void 0:a.values)==null?void 0:q.geoTagged[s])==null?void 0:G.imagePath)==null?void 0:M.name})}),e.jsxs("div",{children:[e.jsx("input",{type:"file",name:"imagePath",accept:"image/*",onChange:te=>ae(te,s,i)}),e.jsx("span",{className:"text-sm text-red-500",children:(O=(V=(S=a==null?void 0:a.errors)==null?void 0:S.geoTagged)==null?void 0:V[s])==null?void 0:O.imagePath})]}),e.jsx("div",{children:e.jsx("h1",{className:"text-sm text-red-900",children:((B=(z=a==null?void 0:a.values)==null?void 0:z.geoTagged[s])==null?void 0:B.imagePath)&&Math.round(((U=(W=(H=a==null?void 0:a.values)==null?void 0:H.geoTagged[s])==null?void 0:W.imagePath)==null?void 0:U.size)/1024/1024*100)/100+"MB"})})]})]})]}),e.jsx("div",{className:"my-4 border-b-2"})]},s)})}),e.jsx("div",{className:"grid grid-cols-1 gap-3 mt-4",children:e.jsx(ue,{name:"comment",formik:a,label:"Comment: "})}),e.jsx("div",{className:"flex justify-center items-center mt-4",children:e.jsx("button",{type:"submit",className:"bg-blue-600 px-4 py-2 rounded-lg text-white",children:"Forward"})})]})]})]})}export{Ee as default};
