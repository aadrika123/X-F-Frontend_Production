import{d as Je,c as F,p as w,w as Ve,S as ke,Q as x,j as e,I as Xe}from"./index-dL_EjbSt.js";import{d as b,u as Ze,e as De}from"./router-5yjtezO8.js";import{u as et}from"./formik.esm-BnzrXcQN.js";import{c as tt,d as Oe,a as at}from"./index.esm-uHa2PMRf.js";import{F as st}from"./FormProvider-YtxP4ZK3.js";import{T as nt}from"./TextAreaField-j9M21TbX.js";import"./index-iFVn5AxS.js";import{r as g}from"./tailwind-6U-kYQAu.js";import{P as rt}from"./index-vQju75AN.js";import{r as qe}from"./resizeImage-kO3M-hU0.js";import{O as it}from"./OverLayLoader-KS6KwRK7.js";import{M as Ye}from"./MyPDFViewer-PRql9kwq.js";import"./reactQuery-QTVGT_ni.js";import"./axios-lPgvryBG.js";import"./reactIcons-ElHvrKTF.js";import"./headlessui-iZReL1Rn.js";import"./customInputValidation-jhKsg103.js";import"./module-fKnwz8NQ.js";/* empty css              */import"./reactPdfViewerCore-_DhfwgKt.js";import"./reactPdfViewerDefaultLayout-2IVdmRVg.js";function St(){var z,E,K,k,O,q,Y,$,G,W,Q,H,J,V,X,Z,D,ee,te,ae,se,ne,re,ie,de,oe,ce,le,me,pe,xe,ue,ge,he,ye,je,we,Ne,be,Ae,fe,Re,Ce,ve,Te,Fe,Se,_e,Ie,Me,Be;const[A,f]=b.useState(""),R=Ze(),N=Je({}),[C,S]=b.useState(""),[_,I]=b.useState(""),[v,M]=b.useState(""),[dt,B]=b.useState(""),{id:h}=De(),t=F({api:w.staticSafDetail,config:{applicationId:h},value:[h],options:{enabled:!!h}}),l=F({api:w.staticSafDetailForVerification,config:{applicationId:h},value:[h],options:{enabled:!!h}}),T=F({api:(z=Ve)==null?void 0:z.workFlowInfo,config:{workflowId:(K=(E=t==null?void 0:t.data)==null?void 0:E.data)==null?void 0:K.workflow_id},value:[(O=(k=t==null?void 0:t.data)==null?void 0:k.data)==null?void 0:O.workflow_id],options:{enabled:!!((Y=(q=t==null?void 0:t.data)==null?void 0:q.data)!=null&&Y.workflow_id)}}),P=()=>{var s,i,d;return(d=(i=(s=l==null?void 0:l.data)==null?void 0:s.data)==null?void 0:i.lastTcFloorVerificationData)==null?void 0:d.reduce((p,o)=>p+(o==null?void 0:o.rent_amount),0)},n=et({initialValues:{uploadMeasurement:"",comment:"",rentDocCode:"RENT AGREEMENT",rentAgreementDocument:null,rentDocCategory:"Rent Agreement"},validationSchema:tt({uploadMeasurement:((G=($=t==null?void 0:t.data)==null?void 0:$.data)==null?void 0:G.applied_by)=="TC"||((Q=(W=t==null?void 0:t.data)==null?void 0:W.data)==null?void 0:Q.applied_by)=="TC Reassesment"?Oe().notRequired():Oe().required("Measurement Sheet is required").test("fileSize","Max 10 mb file size",a=>(a==null?void 0:a.size)<=1e7),comment:at().label("Comment").min(2).max(500)}),onSubmit:async a=>{ke.fire({title:"Are you sure?",text:"\n       You are going to forward the application to the ".concat($e()),icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(s=>{s.isConfirmed&&Ge(a)}).catch(s=>{var i,d;console.log(s),x.error((d=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:d.message)})}}),L=()=>{var a,s;return((s=(a=l==null?void 0:l.data)==null?void 0:a.data)==null?void 0:s.assessment_type)=="New Assessment"?A=="ATS"?"9":"7":A=="LIPIK"?"6":"7"},$e=()=>{var a,s;return((s=(a=l==null?void 0:l.data)==null?void 0:a.data)==null?void 0:s.assessment_type)=="New Assessment"?A=="ATS"?"ATS":"Nagar Rachna":A=="LIPIK"?"Lipik":"Nagar Rachna"},Ge=async a=>{var s,i,d,p,o,r,u,c,Pe,Le,Ue,ze,Ee,Ke;if(await He(),((i=(s=t==null?void 0:t.data)==null?void 0:s.data)==null?void 0:i.applied_by)=="TC"||((p=(d=t==null?void 0:t.data)==null?void 0:d.data)==null?void 0:p.applied_by)=="TC Reassesment")try{const m=await N.mutateAsync({api:w.safLevelV2,data:{applicationId:h,receiverRoleId:L(),action:"forward",comment:(a==null?void 0:a.comment)||"OK"}});(o=m==null?void 0:m.data)!=null&&o.status?(x.success((r=m==null?void 0:m.data)==null?void 0:r.message),R("/amc-app/property/saf-verification-list",{replace:!0})):x.error((u=m==null?void 0:m.data)==null?void 0:u.message)}catch(m){x.error((c=m==null?void 0:m.data)==null?void 0:c.message)}else{const m=new FormData;m.append("applicationId",h),m.append("document",a==null?void 0:a.uploadMeasurement);try{const y=await N.mutateAsync({api:w.uploadMeasurementSheetApi,data:m});if((Pe=y==null?void 0:y.data)!=null&&Pe.status){const j=await N.mutateAsync({api:w.safLevelV2,data:{applicationId:h,receiverRoleId:L(),action:"forward",comment:(a==null?void 0:a.comment)||"OK"}});(Le=j==null?void 0:j.data)!=null&&Le.status?(x.success((Ue=j==null?void 0:j.data)==null?void 0:Ue.message),R("/amc-app/property/saf-verification-list",{replace:!0})):x.error((ze=j==null?void 0:j.data)==null?void 0:ze.message)}else x.error((Ee=y==null?void 0:y.data)==null?void 0:Ee.message)}catch(y){x.error((Ke=y==null?void 0:y.data)==null?void 0:Ke.message)}}},U=async()=>{var a;if(((a=n==null?void 0:n.values)==null?void 0:a.comment)=="")return x.error("Comment is required !");ke.fire({title:"Are you sure?",text:"You are going to backward of this application",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(async s=>{var i,d,p,o;if(s.isConfirmed)try{const r=await N.mutateAsync({api:w.safLevel,data:{applicationId:h,receiverRoleId1:"",action:"backward",comment:((i=n==null?void 0:n.values)==null?void 0:i.comment)||"No Comment"}});(d=r==null?void 0:r.data)!=null&&d.status?(x.success((p=r==null?void 0:r.data)==null?void 0:p.message),R("/amc-app/property/saf-verification-list",{replace:!0})):x.error(((o=r==null?void 0:r.data)==null?void 0:o.message)||"Something went wrong, Please try again")}catch(r){x.error(r==null?void 0:r.message),console.log(r)}}).catch(s=>{var i,d;x.error((d=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:d.message)})},We=async a=>{var i,d,p;const s=a.target.files[0];if((s==null?void 0:s.type)==="application/pdf"){const o=new FileReader;o.onload=r=>{S(r.target.result),I(s.name.split(".").pop())},o.readAsDataURL(s),n.setFieldValue("uploadMeasurement",s)}else{const o=await qe((i=a==null?void 0:a.target)==null?void 0:i.files[0]),r=new File([o],(p=(d=a==null?void 0:a.target)==null?void 0:d.files[0])==null?void 0:p.name,{type:"image/*"}),u=new FileReader;u.onload=c=>{S(c.target.result),I(r.name.split(".").pop())},u.readAsDataURL(r),n.setFieldValue("uploadMeasurement",r)}},Qe=async a=>{var i,d,p;const s=a.target.files[0];if((s==null?void 0:s.type)==="application/pdf"){const o=new FileReader;o.onload=r=>{M(r.target.result),B(s.name.split(".").pop())},o.readAsDataURL(s),n.setFieldValue("rentAgreementDocument",s)}else{const o=await qe((i=a==null?void 0:a.target)==null?void 0:i.files[0]),r=new File([o],(p=(d=a==null?void 0:a.target)==null?void 0:d.files[0])==null?void 0:p.name,{type:"image/*"}),u=new FileReader;u.onload=c=>{M(c.target.result),B(r.name.split(".").pop())},u.readAsDataURL(r),n.setFieldValue("rentAgreementDocument",r)}},He=async a=>{var s,i,d,p,o,r;if(P()>0&&((s=n==null?void 0:n.values)!=null&&s.rentAgreementDocument)){const u=new FormData;u.append("applicationId",h),u.append("docCode","RENT AGREEMENT"),u.append("docCategory","Rent Agreement"),u.append("document",(i=n==null?void 0:n.values)==null?void 0:i.rentAgreementDocument);try{const c=await N.mutateAsync({api:w.documentUpload,data:u});(d=c==null?void 0:c.data)!=null&&d.status?x.success((p=c==null?void 0:c.data)==null?void 0:p.message):x.error((o=c==null?void 0:c.data)==null?void 0:o.message)}catch(c){x.error((r=c==null?void 0:c.data)==null?void 0:r.message)}}};return t!=null&&t.isLoading?e.jsx(Xe,{}):e.jsxs(rt,{title:"Measurement",children:[N.isLoading&&e.jsx(it,{}),e.jsx(st,{formik:n,children:e.jsxs("div",{className:"p-4 ",children:[e.jsx(g.Card,{className:"w-full",children:e.jsxs(g.CardBody,{children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h1",{className:"font-semibold text-sm",children:"Application Details"})}),e.jsx("div",{className:"border-b-2 border-gray-300 w-full py-1"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[e.jsx("h1",{className:"font-semibold text-xs",children:"Application No : "}),e.jsx("h1",{className:"text-xs",children:(J=(H=t==null?void 0:t.data)==null?void 0:H.data)==null?void 0:J.saf_no}),e.jsx("h1",{className:"font-semibold text-xs",children:"Application Type : "}),e.jsx("h1",{className:"text-xs",children:(X=(V=t==null?void 0:t.data)==null?void 0:V.data)==null?void 0:X.assessment_type}),e.jsx("h1",{className:"font-semibold text-xs",children:"Apply Date : "}),e.jsx("h1",{className:"text-xs",children:(D=(Z=t==null?void 0:t.data)==null?void 0:Z.data)==null?void 0:D.application_date}),e.jsx("h1",{className:"font-semibold text-xs",children:"Owner Name : "}),e.jsx("h1",{className:"text-xs",children:(te=(ee=t==null?void 0:t.data)==null?void 0:ee.data)==null?void 0:te.applicant_name}),e.jsx("h1",{className:"font-semibold text-xs",children:"Mobile No : "}),e.jsx("h1",{className:"text-xs w-40 truncate",children:(re=(ne=(se=(ae=t==null?void 0:t.data)==null?void 0:ae.data)==null?void 0:se.owners)==null?void 0:ne.map(a=>a==null?void 0:a.mobile_no))==null?void 0:re.join(", ")})]})]})}),P()>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs(g.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-xs font-semibold text-gray-100",children:"Rent Agreement"})}),v&&(_==="pdf"?e.jsx(Ye,{fileUrl:v}):e.jsx("div",{className:"flex justify-center px-4 py-2",children:e.jsx("img",{src:v,alt:"preview",loading:"lazy"})})),e.jsx(g.CardBody,{children:e.jsx("div",{className:"grid grid-cols-1 justify-center gap-5",children:((de=(ie=t==null?void 0:t.data)==null?void 0:ie.data)==null?void 0:de.applied_by)!="TC"&&((ce=(oe=t==null?void 0:t.data)==null?void 0:oe.data)==null?void 0:ce.applied_by)!="TC Reassesment"&&e.jsxs("div",{children:[e.jsx("div",{className:"mb-1",children:e.jsx("h1",{className:"font-semibold text-xs",children:"Upload Rent Agreement"})}),e.jsx("input",{type:"file",accept:"application/pdf, image/*",name:"rentAgreementDocument",onChange:Qe,className:"border border-gray-300 p-2 w-full rounded-lg"}),e.jsx("small",{className:"text-red-500",children:((le=n==null?void 0:n.errors)==null?void 0:le.rentAgreementDocument)&&((me=n==null?void 0:n.touched)==null?void 0:me.rentAgreementDocument)&&((pe=n==null?void 0:n.errors)==null?void 0:pe.rentAgreementDocument)})]})})})]}),e.jsx("div",{className:"my-4 border-b-2"})]}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs(g.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-xs font-semibold text-gray-100",children:((ue=(xe=t==null?void 0:t.data)==null?void 0:xe.data)==null?void 0:ue.applied_by)=="TC"||((he=(ge=t==null?void 0:t.data)==null?void 0:ge.data)==null?void 0:he.applied_by)=="TC Reassesment"?"Comment":"Upload Measurement Sheet"})}),C&&(_==="pdf"?e.jsx(Ye,{fileUrl:C}):e.jsx("div",{className:"flex justify-center px-4 py-2",children:e.jsx("img",{src:C,alt:"preview",loading:"lazy"})})),e.jsx(g.CardBody,{children:e.jsxs("div",{className:"grid grid-cols-1 justify-center gap-5",children:[((je=(ye=t==null?void 0:t.data)==null?void 0:ye.data)==null?void 0:je.applied_by)!="TC"&&((Ne=(we=t==null?void 0:t.data)==null?void 0:we.data)==null?void 0:Ne.applied_by)!="TC Reassesment"&&e.jsxs("div",{children:[e.jsx("div",{className:"mb-1",children:e.jsx("h1",{className:"font-semibold text-xs",children:"Upload Measurement Sheet"})}),e.jsx("input",{type:"file",accept:"application/pdf, image/*",name:"uploadMeasurement",onChange:We,className:"border border-gray-300 p-2 w-full rounded-lg"}),e.jsx("small",{className:"text-red-500",children:((be=n==null?void 0:n.errors)==null?void 0:be.uploadMeasurement)&&((Ae=n==null?void 0:n.touched)==null?void 0:Ae.uploadMeasurement)&&((fe=n==null?void 0:n.errors)==null?void 0:fe.uploadMeasurement)})]}),e.jsx("div",{children:e.jsx(nt,{label:"Comment",name:"comment",formik:n,placeholder:"Comment"})})]})})]}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"justify-center items-center mt-4 gap-3",children:[((Ce=(Re=l==null?void 0:l.data)==null?void 0:Re.data)==null?void 0:Ce.assessment_type)=="New Assessment"?e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(g.Button,{onClick:U,size:"sm",className:"bg-red-500 text-white",children:e.jsx("small",{children:"Back To Lipik"})})}):e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(g.Button,{onClick:U,size:"sm",className:"bg-red-500 text-white",children:e.jsx("small",{children:"Back To Back Office"})})}),((Fe=(Te=(ve=T==null?void 0:T.data)==null?void 0:ve.data)==null?void 0:Te.permissions)==null?void 0:Fe.can_forward)&&(((_e=(Se=l==null?void 0:l.data)==null?void 0:Se.data)==null?void 0:_e.assessment_type)=="New Assessment"?e.jsxs("div",{className:"flex justify-center items-center gap-2 mt-4",children:[((Be=(Me=(Ie=l==null?void 0:l.data)==null?void 0:Ie.data)==null?void 0:Me.lastTcVerificationData)==null?void 0:Be.prop_type_id)=="4"&&e.jsx(g.Button,{type:"submit",onClick:()=>f("ATS"),size:"sm",className:"bg-blue-500 text-white",children:e.jsx("small",{children:"Send To ATS"})}),e.jsx(g.Button,{type:"submit",size:"sm",onClick:()=>f("SR_LIPIK"),className:"bg-green-500 text-white",children:e.jsx("small",{children:"Send To Nagar Rachna"})})]}):e.jsxs("div",{className:"flex justify-center items-center gap-2 mt-4",children:[e.jsx(g.Button,{type:"submit",onClick:()=>f("LIPIK"),size:"sm",className:"bg-blue-500 text-white",children:e.jsx("small",{children:"Send To Lipik"})}),e.jsx(g.Button,{type:"submit",size:"sm",onClick:()=>f("SR_LIPIK"),className:"bg-green-500 text-white",children:e.jsx("small",{children:"Send To Nagar Rachna"})})]}))]})})]})})]})}export{St as default};
