import{J as N,R as O,l as s,m as P,y as L,W as V,z as W,B as d,D as j,q as v,j as t,k as l,X as p}from"./index-69a925d9.js";const z={overlay:{background:"#e6e6fc"},content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",backgroundColor:"transparent",border:"none",height:"600px"}};function A(a){N.setAppElement("#root");const[w,h]=O.useState(!1),[M,R]=s.useState(),[k,c]=s.useState(!0),[f,u]=s.useState(!1),[F,x]=s.useState(!1),[i,T]=s.useState([]),[g,D]=s.useState(!0);P();const{notify:b}=s.useContext(L),{api_saveConnectionMeter:C,api_meterupdates:S,header:y}=V();console.log("data status",g);const I=e=>{let n=new FormData;n.append("connectionType",e==null?void 0:e.connectionType),n.append("consumerId",a==null?void 0:a.id),n.append("connectionDate",e==null?void 0:e.connectionDate),n.append("oldMeterFinalReading",e==null?void 0:e.oldMeterReading),n.append("meterNo",e==null?void 0:e.meterNo),n.append("newMeterInitialReading",e==null?void 0:e.meterReading),n.append("document",M),v.post(C,n,y).then(r=>{r.data.status?(console.log("Meter Update Successfully",r),b(r.data.message,"success"),a.refetch(),m()):(console.log("Failed to save Meter Data",r),b(r.data.message,"error"),u(r.data.message))}).catch(r=>{console.log("Exception while saving merer",r),u("Error : Something Went Wrong "+r.message),b(res.message,"error")})};W({meterImage:d().when("connectionType",{is:e=>e!="3",then:d().required("Field is required")}),meterNo:d().when("connectionType",{is:e=>e!="3",then:d().required("Field is required")}),meterReading:d().when("connectionType",{is:e=>e!="4",then:d().required("Field is required")}),connectionDate:d().required("Select Connection Date"),connectionType:d().required("Select Connection Type")});const o=j({enableReinitialize:!0,initialValues:{meterNo:"",meterReading:"",oldMeterReading:"",connectionDate:"",connectionType:""},onSubmit:(e,{resetForm:n})=>{I(e)}}),E=e=>{let n=e.target.name,r=e.target.value;u(!1),n=="connectionType"&&x(!1),n=="connectionType"&&r=="1"&&c(!1),n=="connectionType"&&r=="2"&&c(!1),n=="connectionType"&&r=="3"&&c(!0),n=="connectionType"&&r=="4"&&c(!1),n=="connectionType"&&r=="4"&&x(!0),n=="connectionType"&&r==""&&c(!0),n=="meterReading"&&o.setFieldValue("meterReading",p(r,o.values.meterReading,20)),n=="oldMeterReading"&&o.setFieldValue("oldMeterReading",p(r,o.values.oldMeterReading,20)),n=="meterNo"&&o.setFieldValue("meterNo",p(r,o.values.meterReading,20)),n=="meterImage"&&R(e.target.files[0])};s.useEffect(()=>{a.openMeterModal>0&&h(!0)},[a.openMeterModal]);function q(){}function m(){h(!1)}return s.useEffect(()=>{v.post(S,{consumerId:a==null?void 0:a.id},y).then(e=>{console.log("api_meterupdates",e),T(e.data.data.displayData),D(e.data.data.status)}).catch(e=>{console.log("Error while fetching api_meterupdates",e)})},[]),t("div",{className:"",children:t(N,{isOpen:w,onAfterOpen:q,onRequestClose:m,style:z,contentLabel:"Example Modal",shouldCloseOnOverlayClick:!1,children:t("div",{children:t("div",{className:"relative w-full h-full max-w-3xl md:h-auto border-indigo-600 shadow-indigo-200 shadow-sm rounded",children:l("div",{className:"relative bg-white rounded-lg shadow ",children:[l("div",{className:"flex items-start justify-between p-4 border-b rounded-t dark:border-gray-600",children:[t("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Update Connection Details"}),l("button",{onClick:m,className:"text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-600 dark:hover:text-white","data-modal-hide":"defaultModal",children:[t("svg",{"aria-hidden":"true",className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:t("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})}),t("span",{className:"sr-only",children:"Close modal"})]})]}),t("div",{className:"py-6 bg-white rounded-lg shadow-xl p-4",children:l("form",{onSubmit:o.handleSubmit,onChange:E,className:"p-4 relative",children:[l("div",{className:"flex pl-4 ",children:[t("div",{className:"flex-1",children:l("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[l("label",{className:"form-label inline-block mb-1 text-gray-900 text-sm font-semibold",children:["Connection Type"," ",t("small",{className:" mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),l("select",{...o.getFieldProps("connectionType"),type:"text",className:"form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",onChange:e=>o.setFieldValue("connectionType",e.target.value),name:"connectionType",required:!0,children:[t("option",{value:"",children:"Select"}),status?i&&i.length>0?i==null?void 0:i.map(e=>t("option",{value:e.id,children:e.name},e.id)):t("option",{value:"",disabled:!0,children:"No options available"}):i==null?void 0:i.map(e=>t("option",{value:e.id,children:e.name},e.id))]}),t("span",{className:"text-red-600 absolute text-xs",children:o.touched.connectionType&&o.errors.connectionType?o.errors.connectionType:null})]})}),t("div",{className:"flex-1",children:l("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[l("label",{className:"form-label inline-block mb-1 text-gray-900 text-sm font-semibold",children:["Connection Date"," ",t("small",{className:" mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),t("input",{...o.getFieldProps("connectionDate"),type:"date",className:"form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer"}),t("span",{className:"text-red-600 absolute text-xs",children:o.touched.connectionDate&&o.errors.connectionDate?o.errors.connectionDate:null})]})})]}),l("div",{className:"flex pl-4 ",children:[t("div",{className:"flex-1",children:l("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[l("label",{className:"form-label inline-block mb-1 text-gray-900 text-sm font-semibold",children:["New Meter's Initial Reading"," ",t("small",{className:" mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),t("input",{...o.getFieldProps("meterReading"),disabled:F,type:"text",className:"disabled:bg-gray-200 disabled:cursor-not-allowed form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",placeholder:"Enter Meter Reading"}),t("span",{className:"text-red-600 absolute text-xs",children:o.touched.meterReading&&o.errors.meterReading?o.errors.meterReading:null})]})}),t("div",{className:"flex-1",children:l("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[l("label",{className:"form-label inline-block mb-1 text-gray-900 text-sm font-semibold",children:["Old Meter Final Reading"," ",t("small",{className:" mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),t("input",{...o.getFieldProps("oldMeterReading"),type:"text",disabled:!g,className:`form-control block w-full px-3 py-1.5 text-base font-normal text-gray-500 bg-gray-100 bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 ${g?"focus:text-gray-700 focus:bg-white focus:border-blue-600":"cursor-not-allowed"} focus:outline-none placeholder-gray-300 shadow-md`,placeholder:"Enter Meter Reading"})]})})]}),!k&&l("div",{className:"flex space-x-5 pl-4 ",children:[t("div",{className:"flex-1",children:l("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[l("label",{className:"form-label inline-block mb-1 text-gray-900 text-sm font-semibold",children:["Meter Document"," ",t("small",{className:" mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),t("input",{...o.getFieldProps("meterImage"),name:"meterImage",type:"file",className:"form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",placeholder:"Enter Meter Reading"}),t("span",{className:"text-red-600 absolute text-xs",children:o.touched.meterImage&&o.errors.meterImage?o.errors.meterImage:null})]})}),t("div",{className:"flex-1",children:l("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[l("label",{className:"form-label inline-block mb-1 text-gray-900 text-sm font-semibold",children:["Meter Number.",t("small",{className:" mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),t("input",{...o.getFieldProps("meterNo"),type:"text",className:"form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer"}),t("span",{className:"text-red-600 absolute text-xs",children:o.touched.meterNo&&o.errors.meterNo?o.errors.meterNo:null})]})})]}),t("div",{className:" text-center text-red-600 font-semibold",children:f&&f}),l("div",{className:"flex flex-row-reverse items-center p-6 border-t border-gray-200 rounded-b pl-8",children:[t("button",{type:"submit",className:"mx-2 text-white disabled:bg-gray-500 disabled:scale-100 bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800",children:"Submit"}),t("button",{onClick:m,className:"mx-2 text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 rounded-lg border border-red-200 text-sm font-medium px-5 py-2.5 focus:z-10 ",children:"Cancel"})]})]})})]})})})})})}export{A as W};
