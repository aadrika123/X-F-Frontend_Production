import{x as le,l as d,y as de,v as oe,m as ce,I as ie,W as me,z as xe,V as he,B as O,D as ge,q as N,k as r,o as p,j as t,E as be,M as A,h as i,X as fe}from"./index-7a21658f.js";import{W as Ne}from"./WaterTopButtons-5e1b5bfd.js";function Me(pe){var Y,I,R,U,E,k,C,T,V,$,q,G,j,B,z;const{t:n}=le(),[D,m]=d.useState(!1),[e,X]=d.useState(),[s,M]=d.useState(),[S,H]=d.useState(),[J,K]=d.useState(0),[h,y]=d.useState(),[w,g]=d.useState(!1),[P,ye]=d.useState(!1),[_,u]=d.useState(!1);d.useState(!1),d.useState(!1);const{notify:v}=d.useContext(de),[ue,b]=d.useState(!1),{id:x}=oe(),L=ce();ie(`${n("tranWaterApplicationSearchPage.waterConsumerDemandDetailsLabel.label")}`);const{api_waterApprovedApplicationDetails:Q,api_calculateMeterFixedReading:Z,api_waterListDemand:F,api_waterGenerateDemand:ee,header:f}=me(),te=a=>{if(console.log("Function called",a),(e==null?void 0:e.connectionId)==3&&a.demandUpto=="")return u("Please select demand up date");if((e==null?void 0:e.connectionId)==1&&(a.demandUpto==""||a.meterReading==""||a.meterImage==""))return u("Field(s) Require");let o=new FormData;o.append("consumerId",x),o.append("demandUpto",a.demandUpto),o.append("finalRading",a.meterReading||(h==null?void 0:h.finalMeterReading)),o.append("document",S),console.log("Final Payload of Meter Reading",o),N.post(ee,o,f).then(c=>{c.data.status?(K(ne=>ne+1),b(!1),console.log("Demand Generate Date Saved",c),v("Demand Generated","success")):(b(!1),v("Error in Demand Generated","error"),console.log("Error Demand Generate",c),g(c.data.message))}).catch(c=>{b(!1),v("Something went wrong!","error"),console.log("Exception While going to generate Demand",c.response.data),g(c.response.data)})};xe().shape({meterReading:he().required("Enter Meter Reading").min(((Y=s==null?void 0:s.meterDetails)==null?void 0:Y.final_meter_reading)+1||0+1e-6,`Reading must be greater previous ${((I=s==null?void 0:s.meterDetails)==null?void 0:I.final_meter_reading)||1e-6}`),meterImage:O().required("Select Image"),demandUpto:O().required("Select Upto Data")});const l=ge({enableReinitialize:!0,initialValues:{demandUpto:"",meterReading:"",meterImage:""},onSubmit:(a,{resetForm:o})=>{te(a),b(!0),o()}}),ae=a=>{let o=a.target.name,c=a.target.value;console.log("formik.values.meterReading",c),g(!1),u(""),o=="meterReading"&&l.setFieldValue("meterReading",fe(c,l.values.meterReading,20)),o=="meterImage"&&H(a.target.files[0]),console.log("docPath",S)};console.log("formik.values.demandUpto",l.values.demandUpto);const W=d.useMemo(()=>()=>{if((e==null?void 0:e.connectionId)!=4)return null;N.post(Z,{consumerId:x,uptoData:l.values.demandUpto},f).then(a=>{a.data.status?(m(!1),y(a.data.data),console.log("this",a)):(g(a.data.message),y(!1))}).catch(a=>{y(!1),m(!1),console.log("Error while while calculate",a)})},[l.values.demandUpto]);d.useEffect(()=>{W()},[W]);const re=()=>{m(!0),N.post(Q,{applicationId:x},f).then(function(a){console.log("water Approved Application Details",a.data.data),X(a.data.data),m(!1)}).catch(function(a){console.log("Error : water Approved Application Details",a),m(!1)})},se=()=>{N.post(F,{ConsumerId:x},f).then(a=>{a.data.status?(console.log("Fetched Water Demand List",a.data.data),m(!1),M(a.data.data)):(M(!1),m(!1))}).catch(a=>{console.log("Exception while fetching Water Demand",a)})};return d.useEffect(()=>{se(),re()},[x,J]),console.log("applicationFullData?.connectionId",e,e==null?void 0:e.connectionId,typeof(e==null?void 0:e.connectionId)),r(p,{children:[D&&t(be,{}),t(Ne,{active:"demand",consumerNo:e==null?void 0:e.consumer_no}),t("div",{className:"grid grid-cols-1 md:grid-cols-12 lg:grid-cols-12 gap-2 container mx-auto w-full",children:t("div",{className:"col-span-12 rounded-lg p-4",children:r("div",{className:"p-4",children:[r("div",{className:"",children:[r("h1",{className:"px-1 font-semibold font-serif  text-gray-500",children:[t(A,{className:"inline"}),n("tranWaterApplicationSearchPage.basicDetailsLabel.label")]}),t("div",{className:"py-6 mt-2 bg-white border rounded-lg shadow-xl p-4",children:r("div",{className:"flex space-x-5 pl-4 ",children:[r("div",{className:"flex-1",children:[t("div",{className:"font-semibold text-sm",children:e!=null&&e.ulb_name?e==null?void 0:e.ulb_name:"N/A"}),t("div",{className:"text-gray-500 text-xs",children:n("tranWaterApplicationSearchPage.ulbNameLabel.label")})]}),r("div",{className:"flex-1",children:[t("div",{className:"font-bold text-sm",children:e!=null&&e.folio_no?e==null?void 0:e.folio_no:"N/A"}),t("div",{className:"text-gray-500 text-xs",children:"Folio No"})]}),r("div",{className:"flex-1",children:[t("div",{className:"font-bold text-sm",children:e!=null&&e.consumer_no?e==null?void 0:e.consumer_no:"N/A"}),t("div",{className:"text-gray-500 text-xs",children:n("tranWaterApplicationSearchPage.consumerNoLabel.label")})]}),r("div",{className:"flex-1",children:[t("div",{className:"font-bold text-sm",children:e!=null&&e.category?e==null?void 0:e.category:"N/A"}),t("div",{className:"text-gray-500 text-xs",children:"Category"})]}),r("div",{className:"flex-1",children:[t("div",{className:"font-semibold text-md",children:e!=null&&e.reading_date?e==null?void 0:e.reading_date:"N/A"}),t("div",{className:"text-gray-500 text-xs",children:"Reading Date"})]}),r("div",{className:"flex-1",children:[t("div",{className:"font-semibold text-md",children:e!=null&&e.meter_no?e==null?void 0:e.meter_no:"N/A"}),t("div",{className:"text-gray-500 text-xs",children:"Meter No"})]}),r("div",{className:"flex-1",children:[t("div",{className:"font-semibold text-md",children:e!=null&&e.applicant_name?e==null?void 0:e.applicant_name:"N/A"}),t("div",{className:"text-gray-500 text-xs",children:"Applicant Name"})]})]})})]}),s&&((R=s==null?void 0:s.consumerDemands)==null?void 0:R.length)!=0?r("div",{children:[r("div",{className:"flex flex-wrap w-full space-x-0 my-5",children:[r("div",{className:"grow",children:[r("span",{className:"text-sm",children:[" ",n("tranWaterApplicationSearchPage.totalDuesLabel.label"),":"]})," ",r("span",{className:"font-semibold text-gray-700 text-lg",children:["₹ ",s==null?void 0:s.totalSumDemand]})]}),r("div",{className:"grow",children:[r("span",{className:"text-sm",children:[" ",n("tranWaterApplicationSearchPage.dueFromLabel.label"),":"]})," ",r("span",{className:"font-semibold text-gray-700 text-lg",children:[i((U=s==null?void 0:s.consumerDemands[0])==null?void 0:U.demand_from,"YYYY-MM-DD").format("MMM-yy")," "]})]}),r("div",{className:"grow",children:[r("span",{className:"text-sm",children:[" ",n("tranWaterApplicationSearchPage.dueUptoLabel.label"),":"]})," ",r("span",{className:"font-semibold text-gray-700 text-lg",children:[i((k=(E=s==null?void 0:s.consumerDemands)==null?void 0:E.at(-1))==null?void 0:k.demand_upto,"YYYY-MM-DD").format("MMM-yy")," "]})]}),r("div",{className:"grow",children:[t("span",{className:"text-sm",children:" Total Due Demand:"})," ",t("span",{className:"font-semibold text-gray-700 text-lg",children:(C=s==null?void 0:s.consumerDemands)==null?void 0:C.length})]})]}),((T=s==null?void 0:s.consumerDemands)==null?void 0:T.length)!=0&&r("div",{className:"mt-6 mx-3 flex space-x-8",children:[r("div",{className:"float-left flex space-x-8",children:[t("p",{className:"text-gray-600 text-xl font-semibold",children:n("tranWaterApplicationSearchPage.totalPayableAmountLabel.label")}),r("p",{className:"text-black text-2xl font-semibold",children:["₹ ",s==null?void 0:s.totalSumDemand]})]}),r("div",{className:"float-right ",children:[t("button",{onClick:()=>L(`//water-demand-payment/${x}`),className:"bg-indigo-700 hover:bg-indigo-600 px-4 py-2 rounded shadow-2xl text-white text-sm",children:n("tranWaterApplicationSearchPage.payDemandLabel.label")}),t("button",{onClick:()=>L(`//waterdemndbill/${x}`),className:"bg-indigo-700 hover:bg-indigo-600 px-4 py-2 rounded shadow-2xl text-white text-sm ml-4 ",children:"View Bill"})]})]}),t("br",{}),r("div",{className:"mt-5",children:[r("h1",{className:"px-1 font-semibold font-serif text-gray-500",children:[t(A,{className:"inline"})," ",n("tranWaterApplicationSearchPage.demandDetailsLabel.label")]}),r("table",{className:"min-w-full leading-normal mt-2 bg-white rounded-lg shadow-xl p-4",children:[t("thead",{className:"font-bold text-left text-sm border text-gray-800 bg-white",children:r("tr",{children:[t("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:"#"}),t("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:n("tranWaterApplicationSearchPage.demandFromLabel.label")}),t("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:n("tranWaterApplicationSearchPage.demandUptoLabel.label")}),t("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:n("tranWaterApplicationSearchPage.demandAmountLabel.label")}),t("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:n("tranWaterApplicationSearchPage.penaltyLabel.label")}),t("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:n("tranWaterApplicationSearchPage.connectionTypeLabel.label")}),t("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:n("tranWaterApplicationSearchPage.payableAmountLabel.label")})]})}),t("tbody",{className:"text-sm",children:t(p,{children:(V=s==null?void 0:s.consumerDemands)==null?void 0:V.map((a,o)=>r("tr",{className:"bg-white shadow-xl border-b border-gray-200",children:[t("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:o+1}),t("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:a!=null&&a.demand_from?i(a==null?void 0:a.demand_from,"YYYY-MM-DD").format("DD-MMM-yy"):"N/A"}),t("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:a!=null&&a.demand_upto?i(a==null?void 0:a.demand_upto,"YYYY-MM-DD").format("DD-MMM-yy"):"N/A"}),t("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:a!=null&&a.balance_amount?a==null?void 0:a.balance_amount:"N/A"}),t("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:a!=null&&a.penalty?a==null?void 0:a.penalty:"N/A"}),t("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:a!=null&&a.connection_type?a==null?void 0:a.connection_type:"N/A"}),t("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:a!=null&&a.amount?"₹ "+(a==null?void 0:a.amount):"N/A"})]}))})})]})]})]}):t("div",{className:"w-full mt-20 text-center",children:t("span",{className:"text-xl text-red-500 border border-red-500 font-semibold px-4 py-2",children:n("tranWaterApplicationSearchPage.demandNotFoundLabel.label")})}),r("div",{className:"mt-5",children:[r("h1",{className:"px-1 font-semibold font-serif  text-gray-500",children:[t(A,{className:"inline"})," ",n("tranWaterApplicationSearchPage.meterFixedConnectionDetailsLabel.label")]}),r("div",{className:"py-6 mt-2 border bg-white rounded-lg shadow-xl p-4",children:[r("div",{className:"flex space-x-5 pl-4 ",children:[r("div",{className:"flex-1",children:[t("div",{className:"font-bold text-sm",children:(($=e==null?void 0:e.meterDetails)==null?void 0:$.connectionName)||"N/A"}),t("div",{className:"text-gray-500 text-xs",children:"Connection Name"})]}),(e==null?void 0:e.connectionId)!=3&&r(p,{children:[r("div",{className:"flex-1",children:[t("div",{className:"font-bold text-sm",children:((q=e==null?void 0:e.meterDetails)==null?void 0:q.meter_no)||"N/A"}),t("div",{className:"text-gray-500 text-xs",children:n("tranWaterApplicationSearchPage.meterNoLabel.label")})]}),r("div",{className:"flex-1",children:[t("div",{className:"font-bold text-sm",children:((G=e==null?void 0:e.meterDetails)==null?void 0:G.final_meter_reading)!==""?(j=e==null?void 0:e.meterDetails)==null?void 0:j.final_meter_reading:(B=e==null?void 0:e.meterDetails)==null?void 0:B.ref_initial_reading}),t("div",{className:"text-gray-500 text-xs",children:n("tranWaterApplicationSearchPage.lastMeterReadingLabel.label")})]})]}),r("div",{className:"flex-1",children:[r("div",{className:"font-semibold text-md",children:[((z=e==null?void 0:e.meterDetails)==null?void 0:z.connection_date)||"N/A"," "]}),r("div",{className:"text-gray-500 text-xs",children:[" ",n("tranWaterApplicationSearchPage.connectionDateLabel.label")]})]})]}),(e==null?void 0:e.connectionId)==4&&t("div",{className:"py-6 mt-2",children:r("div",{className:"flex space-x-5 pl-4 ",children:[r("div",{className:"flex-1",children:[r("div",{className:"font-semibold text-md",children:[i(e==null?void 0:e.demandFrom,"YYYY-MM-DD").format("DD-MMM-yy")+":"+i(e==null?void 0:e.demandUpto,"YYYY-MM-DD").format("DD-MMM-yy")," "]}),t("div",{className:"text-gray-500 text-xs",children:n("tranWaterApplicationSearchPage.periodLabel.label")})]}),r("div",{className:"flex-1",children:[r("div",{className:"font-semibold text-md",children:[e==null?void 0:e.lastConsumedUnit," "]}),t("div",{className:"text-gray-500 text-xs",children:n("tranWaterApplicationSearchPage.lastConsumedUnitLabel.label")})]}),r("div",{className:"flex-1",children:[r("div",{className:"font-semibold text-md",children:[e==null?void 0:e.avgReading," "]}),t("div",{className:"text-gray-500 text-xs",children:n("tranWaterApplicationSearchPage.avgReadingPerDateLabel.label")})]}),r("div",{className:"flex-1",children:[r("div",{className:"font-semibold text-md",children:[(h==null?void 0:h.diffInDays)||"N/A"," ",r("span",{className:"text-xs",children:["(",i(e==null?void 0:e.demandUpto,"YYYY-MM-DD").format("DD-MMM-yy")," : ",i(l.values.demandUpto,"YYYY-MM-DD").format("DD-MMM-yy"),")"]})," "]}),t("div",{className:"text-gray-500 text-xs",children:n("tranWaterApplicationSearchPage.dayDifferenceLabel.label")})]})]})})]}),t("div",{className:"py-6 mt-2 bg-white rounded-lg shadow-xl p-4",children:r("form",{onSubmit:l.handleSubmit,onChange:ae,className:"p-4 relative",children:[r("div",{className:"flex space-x-5 pl-4 ",children:[(e==null?void 0:e.connectionId)!=3&&r(p,{children:[t("div",{className:"flex-1",children:r("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[r("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold",children:[n("tranWaterApplicationSearchPage.uploadMeterImageLabel.label")," ",t("small",{className:" mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),t("input",{...l.getFieldProps("meterImage"),type:"file",className:"form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",placeholder:"Enter Meter Reading"}),t("span",{className:"text-red-600 absolute text-xs",children:l.touched.meterImage&&l.errors.meterImage?l.errors.meterImage:null})]})}),t("div",{className:"flex-1",children:r("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[r("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold",children:[" ",n("tranWaterApplicationSearchPage.finalMeterReadingLabel.label"),t("small",{className:" mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),t("input",{...l.getFieldProps("meterReading"),disabled:(e==null?void 0:e.connectionId)==4,value:l.values.meterReading,onChange:l.handleChange,type:"text",className:"form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 disabled:bg-gray-100 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",placeholder:"Enter Meter Reading"}),t("span",{className:"text-red-600 absolute text-xs",children:l.touched.meterReading&&l.errors.meterReading?l.errors.meterReading:null})]})})]}),t("div",{className:"flex-1",children:r("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[r("label",{className:"form-label inline-block mb-1 text-gray-900 text-sm font-semibold",children:[" ",n("tranWaterApplicationSearchPage.demandUptoDateLabel.label"),t("small",{className:" mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),t("input",{...l.getFieldProps("demandUpto"),type:"date",className:"form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700  focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer bg-gray-200",value:new Date().toISOString().split("T")[0],readOnly:!0}),t("span",{className:"text-red-600 absolute text-xs",children:l.touched.demandUpto&&l.errors.demandUpto?l.errors.demandUpto:null})]})})]}),t("p",{className:"text-red-500 text-center font-semibold  ",children:w&&"Error : "+w}),r("p",{className:"text-red-500 text-center font-semibold  ",children:[_&&_,P&&P]}),t("div",{className:"flex justify-end mr-5",children:t("button",{type:"submit",className:"bg-indigo-700 px-3 py-2 text-white rounded",children:n("tranWaterApplicationSearchPage.generateDemandLabel.label")})})]})})]}),t("div",{className:"mt-6",children:" "})]})})}),t("div",{className:"w-full h-60"})]})}export{Me as default};
