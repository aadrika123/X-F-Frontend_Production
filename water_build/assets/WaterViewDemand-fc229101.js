import{x as ae,l as d,y as te,v as re,m as ne,I as le,W as se,z as de,V as oe,X as ce,D as ie,q as p,k as r,o as g,j as a,E as me,M,h as x,Y as xe}from"./index-f00892d3.js";import{W as ge}from"./WaterTopButtons-d9ca008a.js";function Ne(he){var W,_,Y,R,I,U,k,E,C,D,T,$;const{t:l}=ae(),[V,c]=d.useState(!1),[e,j]=d.useState(),[n,S]=d.useState(),[A,q]=d.useState(),[G,O]=d.useState(0),[f,u]=d.useState(),[P,h]=d.useState(!1);d.useState(!1);const[be,N]=d.useState(!1);d.useState(!1),d.useState(!1);const{notify:y}=d.useContext(te),[pe,B]=d.useState(!1),{id:m}=re(),v=ne();le(`${l("tranWaterApplicationSearchPage.waterConsumerDemandDetailsLabel.label")}`);const{api_waterApprovedApplicationDetails:z,api_calculateMeterFixedReading:X,api_waterListDemand:H,api_waterGenerateDemand:J,header:b}=se(),K=t=>{if(console.log("Function called",t),(e==null?void 0:e.connectionId)==3&&t.demandUpto=="")return N("Please select demand up date");if((e==null?void 0:e.connectionId)==1&&(t.demandUpto==""||t.meterReading==""||t.meterImage==""))return N("Field(s) Require");let o=new FormData;o.append("consumerId",m),o.append("demandUpto",t.demandUpto),o.append("finalRading",t.meterReading),o.append("document",A),console.log("Final Payload of Meter Reading",o),c(!0),p.post(J,o,b).then(i=>{i.data.status?(O(ee=>ee+1),c(!1),console.log("Demand Generate Date Saved",i),y("Demand Generated","success")):(c(!1),y("Error in Demand Generated","error"),console.log("Error Demand Generate",i),h(i.data.message))}).catch(i=>{c(!1),y("Something went wrong!","error"),console.log("Exception While going to generate Demand",i.response.data),h(i.response.data)})};let w=de().shape({});(e==null?void 0:e.connection_type)!==3&&(w=w.shape({meterReading:oe().required("Enter Meter Reading").min(((W=n==null?void 0:n.meterDetails)==null?void 0:W.final_meter_reading)+1||1e-6,`Reading must be greater than or equal to ${((_=n==null?void 0:n.meterDetails)==null?void 0:_.final_meter_reading)||1e-6}`),meterImage:ce().required("Upload Meter Image")}));const s=ie({enableReinitialize:!0,initialValues:{demandUpto:"",meterReading:"",meterImage:""},onSubmit:(t,{resetForm:o})=>{K(t),B(!0),o()},validationSchema:w}),Q=t=>{let o=t.target.name,i=t.target.value;console.log("formik.values.meterReading",i),h(!1),N(""),o=="meterReading"&&s.setFieldValue("meterReading",xe(i,s.values.meterReading,20)),o=="meterImage"&&q(t.target.files[0]),console.log("docPath",A)};console.log("formik.values.demandUpto",s.values.demandUpto);const L=d.useMemo(()=>()=>{if((e==null?void 0:e.connectionId)!=4)return null;p.post(X,{consumerId:m,uptoData:s.values.demandUpto},b).then(t=>{t.data.status?(c(!1),u(t.data.data),console.log("this",t)):(h(t.data.message),u(!1))}).catch(t=>{u(!1),c(!1),console.log("Error while while calculate",t)})},[s.values.demandUpto]);d.useEffect(()=>{L()},[L]);const Z=()=>{c(!0),p.post(z,{applicationId:m},b).then(function(t){console.log("water Approved Application Details",t.data.data),j(t.data.data),c(!1)}).catch(function(t){console.log("Error : water Approved Application Details",t),c(!1)})},F=()=>{p.post(H,{ConsumerId:m},b).then(t=>{t.data.status?(console.log("Fetched Water Demand List",t.data.data),c(!1),S(t.data.data)):(S(!1),c(!1))}).catch(t=>{console.log("Exception while fetching Water Demand",t)})};return d.useEffect(()=>{F(),Z()},[m,G]),console.log("applicationFullData?.connectionId",e,e==null?void 0:e.connectionId,typeof(e==null?void 0:e.connectionId)),r(g,{children:[V&&a(me,{}),a(ge,{active:"demand",consumerNo:e==null?void 0:e.consumer_no}),a("div",{className:"grid grid-cols-1 md:grid-cols-12 lg:grid-cols-12 gap-2 container mx-auto w-full",children:a("div",{className:"col-span-12 rounded-lg p-4",children:r("div",{className:"p-4",children:[r("div",{className:"",children:[r("h1",{className:"px-1 font-semibold font-serif  text-gray-500",children:[a(M,{className:"inline"}),l("tranWaterApplicationSearchPage.basicDetailsLabel.label")]}),a("div",{className:"py-6 mt-2 bg-white border rounded-lg shadow-xl p-4",children:r("div",{className:"flex space-x-5 pl-4 ",children:[r("div",{className:"flex-1",children:[a("div",{className:"font-bold text-sm",children:e!=null&&e.folio_no?e==null?void 0:e.folio_no:"N/A"}),a("div",{className:"text-gray-500 text-xs",children:"Folio No"})]}),r("div",{className:"flex-1",children:[a("div",{className:"font-bold text-sm",children:e!=null&&e.consumer_no?e==null?void 0:e.consumer_no:"N/A"}),a("div",{className:"text-gray-500 text-xs",children:l("tranWaterApplicationSearchPage.consumerNoLabel.label")})]}),r("div",{className:"flex-1",children:[a("div",{className:"font-semibold text-md",children:e!=null&&e.reading_date?e==null?void 0:e.reading_date:"N/A"}),a("div",{className:"text-gray-500 text-xs",children:"Reading Date"})]})]})})]}),n&&((Y=n==null?void 0:n.consumerDemands)==null?void 0:Y.length)!=0?r("div",{children:[r("div",{className:"flex flex-wrap w-full space-x-0 my-5",children:[r("div",{className:"grow",children:[r("span",{className:"text-sm",children:[" ",l("tranWaterApplicationSearchPage.totalDuesLabel.label"),":"]})," ",r("span",{className:"font-semibold text-gray-700 text-lg",children:["₹ ",n==null?void 0:n.totalSumDemand]})]}),r("div",{className:"grow",children:[r("span",{className:"text-sm",children:[" ",l("tranWaterApplicationSearchPage.dueFromLabel.label"),":"]})," ",r("span",{className:"font-semibold text-gray-700 text-lg",children:[x((R=n==null?void 0:n.consumerDemands[0])==null?void 0:R.demand_from,"YYYY-MM-DD").format("MMM-yy")," "]})]}),r("div",{className:"grow",children:[r("span",{className:"text-sm",children:[" ",l("tranWaterApplicationSearchPage.dueUptoLabel.label"),":"]})," ",r("span",{className:"font-semibold text-gray-700 text-lg",children:[x((U=(I=n==null?void 0:n.consumerDemands)==null?void 0:I.at(-1))==null?void 0:U.demand_upto,"YYYY-MM-DD").format("MMM-yy")," "]})]}),r("div",{className:"grow",children:[a("span",{className:"text-sm",children:" Total Due Demand:"})," ",a("span",{className:"font-semibold text-gray-700 text-lg",children:(k=n==null?void 0:n.consumerDemands)==null?void 0:k.length})]})]}),((E=n==null?void 0:n.consumerDemands)==null?void 0:E.length)!=0&&r("div",{className:"mt-6 mx-3 flex space-x-8",children:[r("div",{className:"float-left flex space-x-8",children:[a("p",{className:"text-gray-600 text-xl font-semibold",children:l("tranWaterApplicationSearchPage.totalPayableAmountLabel.label")}),r("p",{className:"text-black text-2xl font-semibold",children:["₹ ",n==null?void 0:n.totalSumDemand]})]}),r("div",{className:"float-right space-x-3 ",children:[a("button",{onClick:()=>v(`//water-demand-payment/${m}`),className:"bg-indigo-700 hover:bg-indigo-600 px-4 py-2 rounded shadow-2xl text-white text-sm",children:l("tranWaterApplicationSearchPage.payDemandLabel.label")}),a("button",{onClick:()=>v(`//partpayment/${m}`),className:"bg-indigo-700 hover:bg-indigo-600 px-4 py-2 rounded shadow-2xl text-white text-sm",children:"Part Payment"}),a("button",{onClick:()=>v(`//waterdemndbill/${m}`),className:"bg-indigo-700 hover:bg-indigo-600 px-4 py-2 rounded shadow-2xl text-white text-sm ml-4 ",children:"View Bill"})]})]}),a("br",{}),r("div",{className:"mt-5",children:[r("h1",{className:"px-1 font-semibold font-serif text-gray-500",children:[a(M,{className:"inline"})," ",l("tranWaterApplicationSearchPage.demandDetailsLabel.label")]}),r("table",{className:"min-w-full leading-normal mt-2 bg-white rounded-lg shadow-xl p-4",children:[a("thead",{className:"font-bold text-left text-sm border text-gray-800 bg-white",children:r("tr",{children:[a("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:"#"}),a("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:l("tranWaterApplicationSearchPage.demandFromLabel.label")}),a("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:l("tranWaterApplicationSearchPage.demandUptoLabel.label")}),a("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:l("tranWaterApplicationSearchPage.demandAmountLabel.label")}),a("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:l("tranWaterApplicationSearchPage.penaltyLabel.label")}),a("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:l("tranWaterApplicationSearchPage.connectionTypeLabel.label")}),a("th",{className:"px-2 py-3 border-b border-gray-200  text-xs uppercase text-left",children:l("tranWaterApplicationSearchPage.payableAmountLabel.label")})]})}),a("tbody",{className:"text-sm",children:a(g,{children:(C=n==null?void 0:n.consumerDemands)==null?void 0:C.map((t,o)=>r("tr",{className:"bg-white shadow-xl border-b border-gray-200",children:[a("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:o+1}),a("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:t!=null&&t.demand_from?x(t==null?void 0:t.demand_from,"YYYY-MM-DD").format("DD-MMM-yy"):"N/A"}),a("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:t!=null&&t.demand_upto?x(t==null?void 0:t.demand_upto,"YYYY-MM-DD").format("DD-MMM-yy"):"N/A"}),a("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:t!=null&&t.balance_amount?t==null?void 0:t.balance_amount:"N/A"}),a("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:t!=null&&t.penalty?t==null?void 0:t.penalty:"N/A"}),a("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:t!=null&&t.connection_type?t==null?void 0:t.connection_type:"N/A"}),a("td",{className:"px-2 py-2 text-left text-gray-500 text-xs",children:t!=null&&t.due_balance_amount?"₹ "+(t==null?void 0:t.due_balance_amount):"N/A"})]}))})})]})]})]}):a("div",{className:"w-full mt-20 text-center",children:a("span",{className:"text-xl text-red-500 border border-red-500 font-semibold px-4 py-2",children:l("tranWaterApplicationSearchPage.demandNotFoundLabel.label")})}),r("div",{className:"mt-5",children:[r("h1",{className:"px-1 font-semibold font-serif  text-gray-500",children:[a(M,{className:"inline"})," ",l("tranWaterApplicationSearchPage.meterFixedConnectionDetailsLabel.label")]}),r("div",{className:"py-6 mt-2 border bg-white rounded-lg shadow-xl p-4",children:[r("div",{className:"flex space-x-5 pl-4 ",children:[r("div",{className:"flex-1",children:[a("div",{className:"font-bold text-sm",children:((D=e==null?void 0:e.meterDetails)==null?void 0:D.connectionName)||"N/A"}),a("div",{className:"text-gray-500 text-xs",children:"Connection Type"})]}),(e==null?void 0:e.connectionId)!=3&&r(g,{children:[r("div",{className:"flex-1",children:[a("div",{className:"font-bold text-sm",children:((T=e==null?void 0:e.meterDetails)==null?void 0:T.meter_no)||"N/A"}),a("div",{className:"text-gray-500 text-xs",children:l("tranWaterApplicationSearchPage.meterNoLabel.label")})]}),r("div",{className:"flex-1",children:[a("div",{className:"font-bold text-sm",children:e!=null&&e.finalReading?e==null?void 0:e.finalReading:"N/A"}),a("div",{className:"text-gray-500 text-xs",children:l("tranWaterApplicationSearchPage.lastMeterReadingLabel.label")})]})]}),r("div",{className:"flex-1",children:[r("div",{className:"font-semibold text-md",children:[(($=e==null?void 0:e.meterDetails)==null?void 0:$.connection_date)||"N/A"," "]}),r("div",{className:"text-gray-500 text-xs",children:[" ",l("tranWaterApplicationSearchPage.connectionDateLabel.label")]})]})]}),(e==null?void 0:e.connectionId)==4&&a("div",{className:"py-6 mt-2",children:r("div",{className:"flex space-x-5 pl-4 ",children:[r("div",{className:"flex-1",children:[r("div",{className:"font-semibold text-md",children:[x(e==null?void 0:e.demandFrom,"YYYY-MM-DD").format("DD-MMM-yy")+":"+x(e==null?void 0:e.demandUpto,"YYYY-MM-DD").format("DD-MMM-yy")," "]}),a("div",{className:"text-gray-500 text-xs",children:l("tranWaterApplicationSearchPage.periodLabel.label")})]}),r("div",{className:"flex-1",children:[r("div",{className:"font-semibold text-md",children:[e==null?void 0:e.lastConsumedUnit," "]}),a("div",{className:"text-gray-500 text-xs",children:l("tranWaterApplicationSearchPage.lastConsumedUnitLabel.label")})]}),r("div",{className:"flex-1",children:[r("div",{className:"font-semibold text-md",children:[e==null?void 0:e.avgReading," "]}),a("div",{className:"text-gray-500 text-xs",children:l("tranWaterApplicationSearchPage.avgReadingPerDateLabel.label")})]}),r("div",{className:"flex-1",children:[r("div",{className:"font-semibold text-md",children:[(f==null?void 0:f.diffInDays)||"N/A"," ",r("span",{className:"text-xs",children:["(",x(e==null?void 0:e.demandUpto,"YYYY-MM-DD").format("DD-MMM-yy")," : ",x(s.values.demandUpto,"YYYY-MM-DD").format("DD-MMM-yy"),")"]})," "]}),a("div",{className:"text-gray-500 text-xs",children:l("tranWaterApplicationSearchPage.dayDifferenceLabel.label")})]})]})})]}),a("div",{className:"py-6 mt-2 bg-white rounded-lg shadow-xl p-4",children:r("form",{onSubmit:s.handleSubmit,onChange:Q,className:"p-4 relative",children:[r("div",{className:"flex space-x-5 pl-4 ",children:[(e==null?void 0:e.connection_type)==3?"":a(g,{children:a("div",{className:"flex-1",children:r("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[r("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold",children:[l("tranWaterApplicationSearchPage.uploadMeterImageLabel.label")," ",a("small",{className:" mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),a("input",{...s.getFieldProps("meterImage"),type:"file",className:"form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",placeholder:"Enter Meter Reading"}),a("span",{className:"text-red-600 absolute text-xs",children:s.touched.meterImage&&s.errors.meterImage?s.errors.meterImage:null})]})})}),(e==null?void 0:e.connection_type)!==3&&a("div",{className:"flex-1",children:r("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[r("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold",children:[" ",l("tranWaterApplicationSearchPage.finalMeterReadingLabel.label"),a("small",{className:" mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),a("input",{...s.getFieldProps("meterReading"),value:s.values.meterReading,onChange:s.handleChange,type:"text",className:"form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 disabled:bg-gray-100 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",placeholder:"Enter Meter Reading"}),a("span",{className:"text-red-600 absolute text-xs",children:s.touched.meterReading&&s.errors.meterReading?s.errors.meterReading:null})]})}),(e==null?void 0:e.connection_type)!==3?a("div",{className:"flex-1",children:r("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[r("label",{className:"form-label inline-block mb-1 text-gray-900 text-sm font-semibold",children:[" ",l("tranWaterApplicationSearchPage.demandUptoDateLabel.label"),a("small",{className:" mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),a("input",{...s.getFieldProps("demandUpto"),type:"date",className:"form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700  focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer bg-gray-200",value:new Date().toISOString().split("T")[0],readOnly:!0}),a("span",{className:"text-red-600 absolute text-xs",children:s.touched.demandUpto&&s.errors.demandUpto?s.errors.demandUpto:null})]})}):r(g,{children:[" ",r("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[r("label",{className:"form-label inline-block mb-1 text-gray-900 text-sm font-semibold",children:[" ",l("tranWaterApplicationSearchPage.demandUptoDateLabel.label"),a("small",{className:" mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),a("input",{...s.getFieldProps("demandUpto"),type:"date",className:"form-control block w-full px-11 py-1.5 text-base font-normal text-gray-700  bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700  focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer bg-gray-200",value:new Date().toISOString().split("T")[0],readOnly:!0}),a("span",{className:"text-red-600 absolute text-xs",children:s.touched.demandUpto&&s.errors.demandUpto?s.errors.demandUpto:null})]})]})]}),a("p",{className:"text-red-500 text-center font-semibold  ",children:P&&""+P}),(e==null?void 0:e.connection_type)==1?a("div",{className:"flex justify-end mr-5",children:a("button",{type:"submit",className:"bg-indigo-700 px-3 py-2 text-white rounded",children:l("tranWaterApplicationSearchPage.generateDemandLabel.label")})}):r("div",{children:[" ",a("div",{className:"flex justify-end mr-5",children:a("button",{type:"submit",className:"bg-indigo-700 px-3 py-2 text-white rounded",children:l("tranWaterApplicationSearchPage.generateDemandLabel.label")})})," "]})]})})]}),a("div",{className:"mt-6",children:" "})]})})}),a("div",{className:"w-full h-60"})]})}export{Ne as default};
