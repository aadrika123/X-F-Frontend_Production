import{j as e,d as Ke,b as B,p as f,w as Qe,S as De,Q as x,I as Ze}from"./index-tJbU7ayB.js";import{d as S,u as Ge,e as Je,r as Xe}from"./router-vSHQYlWC.js";import{r as o}from"./tailwind-nPCoKmcy.js";import{u as es}from"./formik.esm-feHG9Gj_.js";import{c as ss,a as Ee,f as $e}from"./index.esm-YegZWto1.js";import{F as ts}from"./FormProvider-fBqmJEVl.js";import{T as as}from"./TextField-QPeamiX3.js";import{R as rs}from"./RadioButton-cjSvOHAE.js";import{T as is}from"./TextAreaField-sy2rrLiR.js";import"./TranslateField-wCz68bV9.js";import{P as ns}from"./index-6o85-u81.js";import{O as ls}from"./OverLayLoader-SI2Aj-ji.js";import{M as A}from"./MyPDFViewer-yeFrHXDb.js";import"./reactQuery-xwoMMF6K.js";import"./axios-lPgvryBG.js";import"./reactIcons-jqXmw8S_.js";import"./headlessui-kWR29u24.js";import"./customInputValidation-jhKsg103.js";import"./module-iLAV8VkL.js";/* empty css              */import"./reactPdfViewerCore-YaXm6yh6.js";import"./reactPdfViewerDefaultLayout-8EeuxrVy.js";function Ye({open:h,setOpen:C,url:y,ext:b,title:N}){const p=()=>C(!h);return e.jsxs(e.Fragment,{children:[h&&e.jsx("div",{onClick:p,className:"bg-gray-900/50 dark:bg-gray-900/80 fixed inset-0 z-40"}),e.jsx("div",{id:"authentication-modal",tabIndex:-1,"aria-hidden":"true",className:"".concat(h?"flex":"hidden"," overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full"),children:e.jsx("div",{className:"relative p-4 w-full max-w-md max-h-full ",children:e.jsxs("div",{className:"relative bg-white rounded-lg shadow dark:bg-gray-700 h-[500px]",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 md:p-5 border-b rounded-t dark:border-gray-600",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 dark:text-white",children:N}),e.jsxs("button",{onClick:p,type:"button",className:"end-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white","data-modal-hide":"authentication-modal",children:[e.jsx("svg",{className:"w-3 h-3","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 14 14",children:e.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"})}),e.jsx("span",{className:"sr-only",children:"Close modal"})]})]}),b==="pdf"?e.jsx(A,{fileUrl:y}):e.jsx("img",{src:y,alt:"Naksha",className:"w-full h-full",loading:"lazy"}),e.jsx("div",{className:"p-4 md:p-5",children:e.jsx("div",{className:"flex items-center justify-end mt-4 gap-5",children:e.jsx(o.Button,{type:"button",size:"sm",variant:"text",color:"red",onClick:p,className:"mr-1 bg-gray-300",children:e.jsx("span",{children:"Close"})})})})]})})})]})}const cs=[{label:"Yes",value:"yes"},{label:"No",value:"no"}];function Fs(){var M,F,O,V,z,q,T,L,R,D,E,$,Y,U,W,H,K,Q,Z,G,J,X,ee,se,te,ae,re,ie,ne,le,ce,oe,de,xe,me,he,ue,pe,je,ge,fe,ye,Ne,ve,be,we,_e,ke,Be,Se,Ae,Ce,Pe,Ie,Me,Fe,Oe,Ve,ze,qe;const h=Ke({}),[C,y]=S.useState(""),[b,N]=S.useState(!1),[p,P]=S.useState(!1),{id:d}=Ge(),w=Je(),_=B({api:f.staticSafDetail,config:{applicationId:d},value:[d],options:{enabled:!!d}}),{data:s,refetch:os,error:ds,isLoading:Ue}=B({api:f.getUploadDocNaksha,config:{applicationId:d},value:[d],options:{enabled:!!d}}),k=B({api:(M=Qe)==null?void 0:M.workFlowInfo,config:{workflowId:(F=s==null?void 0:s.data)==null?void 0:F.workflow_id},value:[(O=s==null?void 0:s.data)==null?void 0:O.workflow_id],options:{enabled:!!((V=s==null?void 0:s.data)!=null&&V.workflow_id)}}),t=es({enableReinitialize:!0,initialValues:{areaOfPlot:"",isNaksha:(z=s==null?void 0:s.data)!=null&&z.naksha?"":"no",comment:"",message:""},validationSchema:ss({isNaksha:Ee().required("Required"),comment:Ee().required("Required").max(500,"Max 500 characters"),areaOfPlot:$e().when("isNaksha",{is:"yes",then:()=>$e().required("Required")})}),onSubmit:async r=>{De.fire({title:"Are you sure?",text:"You are going to verify naksha of this property ",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(a=>{a.isConfirmed&&We(r)}).catch(a=>{var i,n;x.error((n=(i=a==null?void 0:a.response)==null?void 0:i.data)==null?void 0:n.message)})}}),We=async r=>{var i,n,u,g,l,Te,Le,Re;const a={applicationId:d,IsDouble:r.isNaksha==="no",areaOfPlot:r.areaOfPlot};try{const c=await h.mutateAsync({api:f.nakshaVerify,data:a});if((i=c==null?void 0:c.data)!=null&&i.status){console.log((n=c==null?void 0:c.data)==null?void 0:n.message),y((u=c==null?void 0:c.data)==null?void 0:u.message);const m=await h.mutateAsync({api:f.safLevel,data:{applicationId:d,action:"forward",comment:"Ok"}});(g=m==null?void 0:m.data)!=null&&g.status?(w("/amc-app/property/saf-verification-list",{replace:!0}),x.success((l=m==null?void 0:m.data)==null?void 0:l.message)):x.error((Te=m==null?void 0:m.data)==null?void 0:Te.message)}else x.error((Le=c==null?void 0:c.data)==null?void 0:Le.message)}catch(c){x.error(((Re=c==null?void 0:c.data)==null?void 0:Re.message)||"Something went wrong !")}},He=async()=>{var r;if(((r=t==null?void 0:t.values)==null?void 0:r.comment)=="")return x.error("Comment is required !");De.fire({title:"Are you sure?",text:"You are going to back this application to Agency Engineer",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(async a=>{var i,n,u,g;if(a.isConfirmed)try{const l=await h.mutateAsync({api:f.safLevel,data:{applicationId:d,receiverRoleId1:"",action:"backward",comment:((i=t==null?void 0:t.values)==null?void 0:i.comment)||"No Comment"}});(n=l==null?void 0:l.data)!=null&&n.status?(x.success((u=l==null?void 0:l.data)==null?void 0:u.message),w("/amc-app/property/saf-verification-list",{replace:!0})):x.error(((g=l==null?void 0:l.data)==null?void 0:g.message)||"Something went wrong, Please try again")}catch(l){x.error(l==null?void 0:l.message),console.log(l)}}).catch(a=>{var i,n;x.error((n=(i=a==null?void 0:a.response)==null?void 0:i.data)==null?void 0:n.message)})};Xe.useEffect(()=>{var r;((r=t==null?void 0:t.values)==null?void 0:r.isNaksha)=="no"&&(t.setFieldValue("areaOfPlot",""),t.setFieldValue("message",""))},[(q=t==null?void 0:t.values)==null?void 0:q.isNaksha]);const j=()=>{var a,i,n;return(n=(i=(a=_==null?void 0:_.data)==null?void 0:a.data)==null?void 0:i.documents)==null?void 0:n.find(u=>u.doc_code==="Measurement form")},v=(L=(T=j())==null?void 0:T.doc_path)==null?void 0:L.split(".").pop(),I=()=>{var r,a,i,n;return((r=s==null?void 0:s.data)==null?void 0:r.assessment_type)=="Reassessment"||((a=s==null?void 0:s.data)==null?void 0:a.assessment_type)=="Mutation"?(i=s==null?void 0:s.data)==null?void 0:i.new_builtup_area:(n=s==null?void 0:s.data)==null?void 0:n.builtup_area};return Ue?e.jsx(Ze,{}):e.jsxs(e.Fragment,{children:[h.isLoading&&e.jsx(ls,{}),e.jsxs(ns,{title:"Naksha Verification",children:[e.jsx(Ye,{open:b,setOpen:N,url:(D=(R=s==null?void 0:s.data)==null?void 0:R.naksha)==null?void 0:D.doc_path,ext:($=(E=s==null?void 0:s.data)==null?void 0:E.naksha)==null?void 0:$.ext,title:"Sanction Plan"}),e.jsx(Ye,{open:p,setOpen:P,url:((U=(Y=s==null?void 0:s.data)==null?void 0:Y.measurement_sheet)==null?void 0:U.doc_path)||((W=j())==null?void 0:W.doc_path),ext:((K=(H=s==null?void 0:s.data)==null?void 0:H.measurement_sheet)==null?void 0:K.ext)||v,title:"Measurement Sheet"}),e.jsxs("div",{className:"p-4",children:[e.jsxs(o.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-xs font-semibold text-gray-100",children:"Basic Details"})}),e.jsx(o.CardBody,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 items-center",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold text-gray-900",children:"Application No :"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs  text-gray-900",children:(Q=s==null?void 0:s.data)==null?void 0:Q.saf_no})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold text-gray-900",children:"Owner Name :"})}),e.jsx("div",{className:"text-xs  text-gray-900",children:(Z=s==null?void 0:s.data)==null?void 0:Z.applicant_name}),e.jsx("div",{children:e.jsxs("h1",{className:"text-xs font-semibold text-gray-900",children:["Buildup Area (",e.jsx("small",{children:"In Sqft"}),") :"]})}),e.jsx("div",{className:"text-xs  text-gray-900",children:(G=s==null?void 0:s.data)==null?void 0:G.builtup_area}),((J=s==null?void 0:s.data)==null?void 0:J.assessment_type)=="Reassessment"||((X=s==null?void 0:s.data)==null?void 0:X.assessment_type)=="Mutation"?e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsxs("h1",{className:"text-xs font-semibold text-gray-900",children:["New Buildup Area (",e.jsx("small",{children:"In Sqft"}),") :"]})}),e.jsx("div",{className:"text-xs  text-gray-900",children:(ee=s==null?void 0:s.data)==null?void 0:ee.new_builtup_area})]}):null,e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold text-gray-900",children:"Zone :"})}),e.jsx("div",{className:"text-xs  text-gray-900",children:e.jsx("h1",{className:"text-xs  text-gray-900",children:(se=s==null?void 0:s.data)==null?void 0:se.zone})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold text-gray-900",children:"Ward :"})}),e.jsx("div",{className:"text-xs  text-gray-900",children:e.jsx("h1",{className:"text-xs  text-gray-900",children:(te=s==null?void 0:s.data)==null?void 0:te.new_ward_no})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold text-gray-900",children:"Property Type :"})}),e.jsx("div",{className:"text-xs  text-gray-900",children:e.jsx("h1",{className:"text-xs  text-gray-900",children:(ae=s==null?void 0:s.data)==null?void 0:ae.property_type})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold text-gray-900",children:"Address :"})}),e.jsx("div",{className:"text-xs  text-gray-900",children:e.jsx("h1",{className:"text-xs  text-gray-900",children:(re=s==null?void 0:s.data)==null?void 0:re.prop_address})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold text-gray-900",children:"Assessment Type :"})}),e.jsx("div",{className:"text-xs  text-gray-900",children:e.jsx("h1",{className:"text-xs  text-gray-900",children:(ie=s==null?void 0:s.data)==null?void 0:ie.assessment_type})}),e.jsx("div",{children:e.jsx("h1",{className:"text-xs font-semibold text-gray-900",children:"Application Date :"})}),e.jsx("div",{className:"text-xs  text-gray-900",children:e.jsx("h1",{className:"text-xs  text-gray-900",children:(ne=s==null?void 0:s.data)==null?void 0:ne.application_date})}),e.jsx("div",{className:"col-span-2 flex justify-center items-center mt-3",children:e.jsx(o.Button,{size:"sm",variant:"outlined",onClick:()=>w("/amc-app/property/saf-property-details/".concat(d)),children:e.jsx("span",{children:"View Saf Details"})})})]})})]}),e.jsx("div",{className:"border-b-2 border-gray-300 mt-3 mb-3"}),e.jsxs(o.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsxs("h1",{className:"text-xs font-semibold text-gray-100",children:["Measurement Sheet"," "]})}),(le=s==null?void 0:s.data)!=null&&le.measurement_sheet||(ce=j())!=null&&ce.doc_path?e.jsxs("div",{className:"grid grid-cols-1 gap-2 items-center",children:[((de=(oe=s==null?void 0:s.data)==null?void 0:oe.measurement_sheet)==null?void 0:de.ext)=="jpg"||((me=(xe=s==null?void 0:s.data)==null?void 0:xe.measurement_sheet)==null?void 0:me.ext)=="jpeg"||((ue=(he=s==null?void 0:s.data)==null?void 0:he.measurement_sheet)==null?void 0:ue.ext)=="png"||v=="jpg"||v=="jpeg"||v=="png"?e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("img",{src:((je=(pe=s==null?void 0:s.data)==null?void 0:pe.measurement_sheet)==null?void 0:je.doc_path)||((ge=j())==null?void 0:ge.doc_path),alt:"measurement_sheet",loading:"lazy",width:500,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"w-full",children:e.jsx(A,{fileUrl:((ye=(fe=s==null?void 0:s.data)==null?void 0:fe.measurement_sheet)==null?void 0:ye.doc_path)||((Ne=j())==null?void 0:Ne.doc_path),toolbar:!1})}),e.jsx("div",{className:"flex justify-center items-center mb-5 mt-4",children:e.jsx(o.Button,{type:"button",size:"sm",color:"blue",className:"text-[11px]  h-8 justify-center items-center text-center flex",onClick:()=>P(!0),variant:"outlined",children:e.jsx("span",{children:"View Measurement"})})})]}):e.jsx("div",{className:"text-center py-5",children:e.jsx("h1",{className:"text-red-900 font-semibold text-xs",children:"Measurement Sheet not found!"})})]}),e.jsx("div",{className:"border-b-2 border-gray-300 mt-3 mb-3"}),e.jsxs(o.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-xs font-semibold text-gray-100",children:"Sanction Plan"})}),e.jsx(o.CardBody,{children:(ve=s==null?void 0:s.data)!=null&&ve.naksha?e.jsxs("div",{className:"grid grid-cols-1 gap-2 items-center",children:[((we=(be=s==null?void 0:s.data)==null?void 0:be.naksha)==null?void 0:we.ext)=="jpg"||((ke=(_e=s==null?void 0:s.data)==null?void 0:_e.naksha)==null?void 0:ke.ext)=="jpeg"||((Se=(Be=s==null?void 0:s.data)==null?void 0:Be.naksha)==null?void 0:Se.ext)=="png"?e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("img",{src:(Ce=(Ae=s==null?void 0:s.data)==null?void 0:Ae.naksha)==null?void 0:Ce.doc_path,alt:"naksha",loading:"lazy",width:500,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"w-full",children:e.jsx(A,{fileUrl:(Ie=(Pe=s==null?void 0:s.data)==null?void 0:Pe.naksha)==null?void 0:Ie.doc_path})}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(o.Button,{type:"button",size:"sm",color:"blue",className:"text-[11px]  h-8 justify-center items-center text-center flex",onClick:()=>N(!0),variant:"outlined",children:e.jsx("span",{children:"View Sanction"})})})]}):e.jsx("div",{className:"text-center",children:e.jsx("h1",{className:"text-red-900 font-semibold text-xs",children:"Sanction Plan not found!"})})})]}),e.jsx("div",{className:"border-b-2 border-gray-300 mt-3 mb-4"}),((Me=t==null?void 0:t.values)==null?void 0:Me.isNaksha)=="no"&&e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("h1",{className:"text-xs font-semibold text-red-900 text-center mb-3 w-52",children:"Double taxation will be applied for this property !"})}),e.jsxs(ts,{formik:t,children:[((Fe=s==null?void 0:s.data)==null?void 0:Fe.naksha)&&e.jsx("div",{className:"flex justify-center gap-4 items-center px-5 ",children:cs.map(r=>e.jsx(rs,{formik:t,name:"isNaksha",label:r.label,value:r.value},r.value))}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 items-center mt-4",children:[t.values.isNaksha==="yes"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xs font-semibold text-gray-900"}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("h1",{className:"text-xs font-semibold text-red-900 text-center mb-3 w-52",children:(Oe=t==null?void 0:t.values)==null?void 0:Oe.message})})]}),e.jsx("div",{children:e.jsx(as,{label:"Constructed Area(In Sqft) :",type:"number",formik:t,name:"areaOfPlot",placeholder:"Constructed Area (In Sqft)",onBlur:()=>{var r,a;((r=t==null?void 0:t.values)==null?void 0:r.areaOfPlot)<I()?t.setFieldValue("message","100% Taxation will be applied on ".concat(I()-((a=t==null?void 0:t.values)==null?void 0:a.areaOfPlot)," sqft constructed area !")):t.setFieldValue("message","")}})})]}),e.jsx("div",{children:e.jsx(is,{label:"comment",formik:t,name:"comment",placeholder:"Comment"})})]}),e.jsxs("div",{className:"flex justify-center mt-4 gap-5",children:[e.jsx(o.Button,{onClick:He,size:"sm",className:"bg-red-500 text-white",children:e.jsx("small",{children:"Back To Agency Engineer"})}),((qe=(ze=(Ve=k==null?void 0:k.data)==null?void 0:Ve.data)==null?void 0:ze.permissions)==null?void 0:qe.can_forward)&&e.jsx(o.Button,{type:"submit",size:"sm",className:"bg-blue-500 text-white",children:e.jsx("small",{children:"Forward"})})]})]})]})]})]})}export{Fs as default};
