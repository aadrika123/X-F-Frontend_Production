import{a as D,j as i,u as $,d as y,v as j,Q as b}from"./index-tJbU7ayB.js";import{d as q,e as z}from"./router-vSHQYlWC.js";import{u as S}from"./formik.esm-feHG9Gj_.js";import{c as N,a as P,g as A}from"./index.esm-YegZWto1.js";import{F as T}from"./FormProvider-fBqmJEVl.js";import{T as R}from"./TextField-QPeamiX3.js";import{L as O}from"./LoaderButton-OBeIHsxX.js";import"./TranslateField-wCz68bV9.js";import{u as k}from"./useCountDown-4IQq9N8X.js";import{P as C}from"./PasswordField-2i7n2_wp.js";import"./reactQuery-xwoMMF6K.js";import"./axios-lPgvryBG.js";import"./tailwind-nPCoKmcy.js";import"./reactIcons-jqXmw8S_.js";import"./headlessui-kWR29u24.js";import"./customInputValidation-jhKsg103.js";const E=[{id:0,label:"Mobile"},{id:1,label:"Email"}];function M(){const{state:c,actions:a}=D({updateAction:$});return i.jsx("div",{className:"w-full",children:i.jsx("div",{className:"relative right-0",children:i.jsx("ul",{className:"relative flex flex-wrap p-1 list-none rounded-lg bg-blue-gray-50/60","data-tabs":"tabs",role:"list",children:E==null?void 0:E.map(s=>i.jsx("li",{className:"z-30 flex-auto text-center",onClick:()=>a==null?void 0:a.updateAction({loginTabs:s==null?void 0:s.id}),children:i.jsx("a",{className:"z-30 flex items-center justify-center w-full px-0 py-1 mb-0 transition-all ease-in-out border-0 rounded-lg cursor-pointer text-slate-700 bg-inherit ".concat(c.loginTabs===(s==null?void 0:s.id)?"border-b-2 border-blue-500 text-blue-500":""),"data-tab-target":"",role:"tab","aria-selected":"true",children:i.jsx("span",{className:"ml-1",children:s==null?void 0:s.label})})},s==null?void 0:s.id))})})})}const L=N().shape({mobile:P().required("Mobile is required").min(10).max(10)});function B({next:c,data:a,setData:s}){const{mutateAsync:h}=y({}),t=S({enableReinitialize:!0,initialValues:{mobile:a.mobile||""},validationSchema:L,onSubmit:async(r,{})=>{var x,o,d;try{const e=await h({api:j.forgotPassword,data:{mobile:r.mobile}});(x=e==null?void 0:e.data)!=null&&x.status?(c({...a,mobile:r.mobile}),b.success((o=e==null?void 0:e.data)==null?void 0:o.message)):b.error((d=e==null?void 0:e.data)==null?void 0:d.message)}catch(e){b.error(e==null?void 0:e.message)}}});return i.jsxs(T,{formik:t,children:[i.jsx("h2",{className:" font-semibold mt-8 mb-4",children:"Send OTP"}),i.jsx(R,{label:"Mobile",name:"mobile",type:"number",formik:t,placeholder:"Enter your register mobile no"}),i.jsx(O,{type:t.isSubmitting?"button":"submit",disabled:t.isSubmitting,loading:t.isSubmitting,children:"SEND OTP"})]})}const Q=N().shape({otp:P().required("OTP is required")});function W({next:c,data:a,setData:s,prev:h,state:t}){const{minutes:r,seconds:x,togglerTimer:o,runTimer:d}=k(.5),{mutateAsync:e,isLoading:p}=y({}),n=S({enableReinitialize:!0,initialValues:{mobile:a.mobile||"",email:a.email||"",otp:a.otp||""},validationSchema:Q,onSubmit:async(g,{})=>{var f,w,l,F,V;try{const m=await e({api:j.otpVerify,data:(t==null?void 0:t.loginTabs)==0?{mobile:g.mobile,Otp:g==null?void 0:g.otp}:{email:g.email,Otp:g==null?void 0:g.otp}});(f=m==null?void 0:m.data)!=null&&f.status?(c({...a,otp:g.otp,token:(l=(w=m==null?void 0:m.data)==null?void 0:w.data)==null?void 0:l.token}),b.success((F=m==null?void 0:m.data)==null?void 0:F.message)):b.error((V=m==null?void 0:m.data)==null?void 0:V.message)}catch(m){b.error(m==null?void 0:m.message)}}});q.useEffect(()=>(o(),()=>{o()}),[]);const u=async()=>{var g,f,w;try{const l=await e({api:j.forgotPassword,data:(t==null?void 0:t.loginTabs)==0?{mobile:a.mobile}:{email:a.email}});(g=l==null?void 0:l.data)!=null&&g.status?(b.success((f=l==null?void 0:l.data)==null?void 0:f.message),s({...a,otp:""}),n.setFieldValue("otp",""),o()):b.error((w=l==null?void 0:l.data)==null?void 0:w.message)}catch(l){b.error(l==null?void 0:l.message)}};return i.jsxs(T,{formik:n,children:[i.jsxs("h1",{className:"text-sm mt-8 mb-4",children:["Please enter the 6-digit verification code sent to"," ",t.loginTabs==0?" your phone number":"your email-:  ",t.loginTabs==0?"+"+(n==null?void 0:n.values.mobile):n==null?void 0:n.values.email," ",i.jsx("span",{className:"text-sm text-blue-700",onClick:()=>h(t.loginTabs==0?{mobile:n==null?void 0:n.values.mobile,otp:""}:{email:n==null?void 0:n.values.email,otp:""}),children:"Edit"})]}),i.jsx(R,{label:"Verify OTP",name:"otp",type:"text",formik:n}),i.jsx(O,{type:n.isSubmitting?"button":"submit",disabled:n.isSubmitting,loading:n.isSubmitting,children:"Verify OTP"}),i.jsxs("div",{className:"text-center mt-12 text-sm",children:["Didn't receive the code?"," ",p?i.jsx("small",{className:"text-gray-700 text-sm",children:"Please wait..."}):i.jsx(i.Fragment,{children:d?i.jsxs("span",{className:"text-gray-700 cursor-pointer",children:["Resend in ",r,":",x]}):i.jsx("span",{className:"text-blue-700 cursor-pointer",onClick:u,children:"Resend OTP"})})]})]})}const v=N().shape({newPassword:P().required("New Password is required"),confirmPassword:P().required("Confirm Password is required").oneOf([A("newPassword"),null],"Passwords must match")});function G({next:c,data:a,setData:s,prev:h,state:t}){k(5);const r=z(),{mutateAsync:x}=y({}),o=S({enableReinitialize:!0,initialValues:{newPassword:"",confirmPassword:""},validationSchema:v,onSubmit:async(d,{})=>{var e,p,n;try{const u=await x({api:j.resetPassword,data:{token:a==null?void 0:a.token,password:d==null?void 0:d.newPassword}});(e=u==null?void 0:u.data)!=null&&e.status?(c(d,!0),b.success((p=u==null?void 0:u.data)==null?void 0:p.message),r("/auth/login")):b.error((n=u==null?void 0:u.data)==null?void 0:n.message)}catch(u){b.error(u==null?void 0:u.message)}}});return i.jsxs(T,{formik:o,children:[i.jsx("h1",{className:"text-lg mt-5 mb-4 font-semibold",children:"Create New Password"}),i.jsx(C,{label:"New Password",name:"newPassword",formik:o}),i.jsx(C,{label:"Confirm Password",name:"confirmPassword",formik:o}),i.jsx(O,{type:o.isSubmitting?"button":"submit",disabled:o.isSubmitting,loading:o.isSubmitting,children:"RESET PASSWORD"})]})}const H=N().shape({email:P().required("Email is required").email()});function I({next:c,data:a,setData:s}){const{mutateAsync:h}=y({}),t=S({enableReinitialize:!0,initialValues:{email:a.email||""},validationSchema:H,onSubmit:async(r,{})=>{var x,o,d;try{const e=await h({api:j.forgotPassword,data:{email:r==null?void 0:r.email}});(x=e==null?void 0:e.data)!=null&&x.status?(c({...a,email:r==null?void 0:r.email}),b.success((o=e==null?void 0:e.data)==null?void 0:o.message)):b.error((d=e==null?void 0:e.data)==null?void 0:d.message)}catch(e){b.error(e==null?void 0:e.message)}}});return i.jsxs(T,{formik:t,children:[i.jsx("h2",{className:" font-semibold mt-8 mb-4",children:"Send OTP"}),i.jsx(R,{label:"Email *",name:"email",type:"email",formik:t,placeholder:"Enter your register email id"}),i.jsx(O,{type:t.isSubmitting?"button":"submit",disabled:t.isSubmitting,loading:t.isSubmitting,children:"SEND OTP"})]})}function me(){const{state:c,actions:a}=D({updateAction:$}),[s,h]=q.useState(0),[t,r]=q.useState({mobile:"",email:"",otp:"",newPassword:"",confirmPassword:"",token:""}),x=e=>{console.log(e)},o=(e,p=!1)=>{if(r({...t,...e}),p){x(e);return}h(s+1)},d=e=>{r({...t,...e}),h(s-1)};return i.jsxs(i.Fragment,{children:[s===0&&i.jsx(M,{}),i.jsx("div",{children:{0:c.loginTabs==0?i.jsx(B,{state:c,next:o,data:t,setData:r}):i.jsx(I,{state:c,next:o,data:t,setData:r}),1:i.jsx(W,{state:c,next:o,prev:d,data:t,setData:r}),2:i.jsx(G,{state:c,next:o,prev:d,data:t,setData:r})}[s]})]})}export{me as default};
