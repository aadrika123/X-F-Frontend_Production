import{d as Je,c as F,p as w,w as Ve,S as Ke,Q as x,j as e,I as Xe}from"./index-kwyYuGuR.js";import{d as A,u as Ze,e as De}from"./router-5yjtezO8.js";import{u as et}from"./formik.esm-BnzrXcQN.js";import{c as tt,d as ke,a as at}from"./index.esm-uHa2PMRf.js";import{F as st}from"./FormProvider-E8aVPPYG.js";import{T as nt}from"./TextAreaField-qxkYCnYB.js";import"./index-iFVn5AxS.js";import{r as g}from"./tailwind-6U-kYQAu.js";import{P as rt}from"./index-tU9B2LIK.js";import{r as Oe}from"./resizeImage-2eNOczEw.js";import{O as it}from"./OverLayLoader-69Ia_cBz.js";import{M as qe}from"./MyPDFViewer-FdKbrf1G.js";import"./reactQuery-QTVGT_ni.js";import"./axios-lPgvryBG.js";import"./reactIcons-ElHvrKTF.js";import"./headlessui-iZReL1Rn.js";import"./customInputValidation-jhKsg103.js";import"./module-9-PvGTXA.js";/* empty css              */import"./reactPdfViewerCore-_DhfwgKt.js";import"./reactPdfViewerDefaultLayout-2IVdmRVg.js";function St(){var U,z,E,K,k,O,q,Y,$,G,W,Q,H,J,V,X,Z,D,ee,te,ae,se,ne,re,ie,de,oe,ce,le,me,pe,xe,ue,ge,he,ye,je,we,Ne,be,Ae,fe,Re,Ce,Te,ve,Fe,Se,_e,Ie,Me;const[b,f]=A.useState(""),R=Ze(),N=Je({}),[C,S]=A.useState(""),[_,I]=A.useState(""),[T,M]=A.useState(""),[dt,B]=A.useState(""),{id:h}=De(),t=F({api:w.staticSafDetail,config:{applicationId:h},value:[h],options:{enabled:!!h}}),l=F({api:w.staticSafDetailForVerification,config:{applicationId:h},value:[h],options:{enabled:!!h}}),v=F({api:(U=Ve)==null?void 0:U.workFlowInfo,config:{workflowId:(E=(z=t==null?void 0:t.data)==null?void 0:z.data)==null?void 0:E.workflow_id},value:[(k=(K=t==null?void 0:t.data)==null?void 0:K.data)==null?void 0:k.workflow_id],options:{enabled:!!((q=(O=t==null?void 0:t.data)==null?void 0:O.data)!=null&&q.workflow_id)}}),P=()=>{var s,i,d;return(d=(i=(s=l==null?void 0:l.data)==null?void 0:s.data)==null?void 0:i.lastTcFloorVerificationData)==null?void 0:d.reduce((p,o)=>p+(o==null?void 0:o.rent_amount),0)},n=et({initialValues:{uploadMeasurement:"",comment:"",rentDocCode:"RENT AGREEMENT",rentAgreementDocument:null,rentDocCategory:"Rent Agreement"},validationSchema:tt({uploadMeasurement:(($=(Y=t==null?void 0:t.data)==null?void 0:Y.data)==null?void 0:$.applied_by)=="TC"||((W=(G=t==null?void 0:t.data)==null?void 0:G.data)==null?void 0:W.applied_by)=="TC Reassesment"?ke().notRequired():ke().required("Measurement Sheet is required").test("fileSize","Max 10 mb file size",a=>(a==null?void 0:a.size)<=1e7),comment:at().label("Comment").min(2).max(500)}),onSubmit:async a=>{Ke.fire({title:"Are you sure?",text:"\n       You are going to forward the application to the ".concat($e()),icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(s=>{s.isConfirmed&&Ge(a)}).catch(s=>{var i,d;console.log(s),x.error((d=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:d.message)})}}),Ye=()=>{var a,s;return((s=(a=l==null?void 0:l.data)==null?void 0:a.data)==null?void 0:s.assessment_type)=="New Assessment1"?b==="ATS"?"9":"7":b==="LIPIK"?"6":"7"},$e=()=>{var a,s;return((s=(a=l==null?void 0:l.data)==null?void 0:a.data)==null?void 0:s.assessment_type)=="New Assessment1"?b==="ATS"?"ATS":"Nagar Rachna":b==="LIPIK"?"Lipik":"Nagar Rachna"},Ge=async a=>{var s,i,d,p,o,r,u,c,Be,Pe,Le,Ue,ze,Ee;if(await He(),((i=(s=t==null?void 0:t.data)==null?void 0:s.data)==null?void 0:i.applied_by)=="TC"||((p=(d=t==null?void 0:t.data)==null?void 0:d.data)==null?void 0:p.applied_by)=="TC Reassesment")try{const m=await N.mutateAsync({api:w.safLevelV2,data:{applicationId:h,receiverRoleId:Ye(),action:"forward",comment:(a==null?void 0:a.comment)||"OK"}});(o=m==null?void 0:m.data)!=null&&o.status?(x.success((r=m==null?void 0:m.data)==null?void 0:r.message),R("/amc-app/property/saf-verification-list",{replace:!0})):x.error((u=m==null?void 0:m.data)==null?void 0:u.message)}catch(m){x.error((c=m==null?void 0:m.data)==null?void 0:c.message)}else{const m=new FormData;m.append("applicationId",h),m.append("document",a==null?void 0:a.uploadMeasurement);try{const y=await N.mutateAsync({api:w.uploadMeasurementSheetApi,data:m});if((Be=y==null?void 0:y.data)!=null&&Be.status){const j=await N.mutateAsync({api:w.safLevelV2,data:{applicationId:h,receiverRoleId:b==="ATS"?"9":"7",action:"forward",comment:(a==null?void 0:a.comment)||"OK"}});(Pe=j==null?void 0:j.data)!=null&&Pe.status?(x.success((Le=j==null?void 0:j.data)==null?void 0:Le.message),R("/amc-app/property/saf-verification-list",{replace:!0})):x.error((Ue=j==null?void 0:j.data)==null?void 0:Ue.message)}else x.error((ze=y==null?void 0:y.data)==null?void 0:ze.message)}catch(y){x.error((Ee=y==null?void 0:y.data)==null?void 0:Ee.message)}}},L=async()=>{var a;if(((a=n==null?void 0:n.values)==null?void 0:a.comment)=="")return x.error("Comment is required !");Ke.fire({title:"Are you sure?",text:"You are going to backward of this application",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(async s=>{var i,d,p,o;if(s.isConfirmed)try{const r=await N.mutateAsync({api:w.safLevel,data:{applicationId:h,receiverRoleId1:"",action:"backward",comment:((i=n==null?void 0:n.values)==null?void 0:i.comment)||"No Comment"}});(d=r==null?void 0:r.data)!=null&&d.status?(x.success((p=r==null?void 0:r.data)==null?void 0:p.message),R("/amc-app/property/saf-verification-list",{replace:!0})):x.error(((o=r==null?void 0:r.data)==null?void 0:o.message)||"Something went wrong, Please try again")}catch(r){x.error(r==null?void 0:r.message),console.log(r)}}).catch(s=>{var i,d;x.error((d=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:d.message)})},We=async a=>{var i,d,p;const s=a.target.files[0];if((s==null?void 0:s.type)==="application/pdf"){const o=new FileReader;o.onload=r=>{S(r.target.result),I(s.name.split(".").pop())},o.readAsDataURL(s),n.setFieldValue("uploadMeasurement",s)}else{const o=await Oe((i=a==null?void 0:a.target)==null?void 0:i.files[0]),r=new File([o],(p=(d=a==null?void 0:a.target)==null?void 0:d.files[0])==null?void 0:p.name,{type:"image/*"}),u=new FileReader;u.onload=c=>{S(c.target.result),I(r.name.split(".").pop())},u.readAsDataURL(r),n.setFieldValue("uploadMeasurement",r)}},Qe=async a=>{var i,d,p;const s=a.target.files[0];if((s==null?void 0:s.type)==="application/pdf"){const o=new FileReader;o.onload=r=>{M(r.target.result),B(s.name.split(".").pop())},o.readAsDataURL(s),n.setFieldValue("rentAgreementDocument",s)}else{const o=await Oe((i=a==null?void 0:a.target)==null?void 0:i.files[0]),r=new File([o],(p=(d=a==null?void 0:a.target)==null?void 0:d.files[0])==null?void 0:p.name,{type:"image/*"}),u=new FileReader;u.onload=c=>{M(c.target.result),B(r.name.split(".").pop())},u.readAsDataURL(r),n.setFieldValue("rentAgreementDocument",r)}},He=async a=>{var s,i,d,p,o,r;if(P()>0&&((s=n==null?void 0:n.values)!=null&&s.rentAgreementDocument)){const u=new FormData;u.append("applicationId",h),u.append("docCode","RENT AGREEMENT"),u.append("docCategory","Rent Agreement"),u.append("document",(i=n==null?void 0:n.values)==null?void 0:i.rentAgreementDocument);try{const c=await N.mutateAsync({api:w.documentUpload,data:u});(d=c==null?void 0:c.data)!=null&&d.status?x.success((p=c==null?void 0:c.data)==null?void 0:p.message):x.error((o=c==null?void 0:c.data)==null?void 0:o.message)}catch(c){x.error((r=c==null?void 0:c.data)==null?void 0:r.message)}}};return t!=null&&t.isLoading?e.jsx(Xe,{}):e.jsxs(rt,{title:"Measurement",children:[N.isLoading&&e.jsx(it,{}),e.jsx(st,{formik:n,children:e.jsxs("div",{className:"p-4 ",children:[e.jsx(g.Card,{className:"w-full",children:e.jsxs(g.CardBody,{children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h1",{className:"font-semibold text-sm",children:"Application Details"})}),e.jsx("div",{className:"border-b-2 border-gray-300 w-full py-1"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[e.jsx("h1",{className:"font-semibold text-xs",children:"Application No : "}),e.jsx("h1",{className:"text-xs",children:(H=(Q=t==null?void 0:t.data)==null?void 0:Q.data)==null?void 0:H.saf_no}),e.jsx("h1",{className:"font-semibold text-xs",children:"Application Type : "}),e.jsx("h1",{className:"text-xs",children:(V=(J=t==null?void 0:t.data)==null?void 0:J.data)==null?void 0:V.assessment_type}),e.jsx("h1",{className:"font-semibold text-xs",children:"Apply Date : "}),e.jsx("h1",{className:"text-xs",children:(Z=(X=t==null?void 0:t.data)==null?void 0:X.data)==null?void 0:Z.application_date}),e.jsx("h1",{className:"font-semibold text-xs",children:"Owner Name : "}),e.jsx("h1",{className:"text-xs",children:(ee=(D=t==null?void 0:t.data)==null?void 0:D.data)==null?void 0:ee.applicant_name}),e.jsx("h1",{className:"font-semibold text-xs",children:"Mobile No : "}),e.jsx("h1",{className:"text-xs w-40 truncate",children:(ne=(se=(ae=(te=t==null?void 0:t.data)==null?void 0:te.data)==null?void 0:ae.owners)==null?void 0:se.map(a=>a==null?void 0:a.mobile_no))==null?void 0:ne.join(", ")})]})]})}),P()>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs(g.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-xs font-semibold text-gray-100",children:"Rent Agreement"})}),T&&(_==="pdf"?e.jsx(qe,{fileUrl:T}):e.jsx("div",{className:"flex justify-center px-4 py-2",children:e.jsx("img",{src:T,alt:"preview",loading:"lazy"})})),e.jsx(g.CardBody,{children:e.jsx("div",{className:"grid grid-cols-1 justify-center gap-5",children:((ie=(re=t==null?void 0:t.data)==null?void 0:re.data)==null?void 0:ie.applied_by)!="TC"&&((oe=(de=t==null?void 0:t.data)==null?void 0:de.data)==null?void 0:oe.applied_by)!="TC Reassesment"&&e.jsxs("div",{children:[e.jsx("div",{className:"mb-1",children:e.jsx("h1",{className:"font-semibold text-xs",children:"Upload Rent Agreement"})}),e.jsx("input",{type:"file",accept:"application/pdf, image/*",name:"rentAgreementDocument",onChange:Qe,className:"border border-gray-300 p-2 w-full rounded-lg"}),e.jsx("small",{className:"text-red-500",children:((ce=n==null?void 0:n.errors)==null?void 0:ce.rentAgreementDocument)&&((le=n==null?void 0:n.touched)==null?void 0:le.rentAgreementDocument)&&((me=n==null?void 0:n.errors)==null?void 0:me.rentAgreementDocument)})]})})})]}),e.jsx("div",{className:"my-4 border-b-2"})]}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs(g.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-xs font-semibold text-gray-100",children:((xe=(pe=t==null?void 0:t.data)==null?void 0:pe.data)==null?void 0:xe.applied_by)=="TC"||((ge=(ue=t==null?void 0:t.data)==null?void 0:ue.data)==null?void 0:ge.applied_by)=="TC Reassesment"?"Comment":"Upload Measurement Sheet"})}),C&&(_==="pdf"?e.jsx(qe,{fileUrl:C}):e.jsx("div",{className:"flex justify-center px-4 py-2",children:e.jsx("img",{src:C,alt:"preview",loading:"lazy"})})),e.jsx(g.CardBody,{children:e.jsxs("div",{className:"grid grid-cols-1 justify-center gap-5",children:[((ye=(he=t==null?void 0:t.data)==null?void 0:he.data)==null?void 0:ye.applied_by)!="TC"&&((we=(je=t==null?void 0:t.data)==null?void 0:je.data)==null?void 0:we.applied_by)!="TC Reassesment"&&e.jsxs("div",{children:[e.jsx("div",{className:"mb-1",children:e.jsx("h1",{className:"font-semibold text-xs",children:"Upload Measurement Sheet"})}),e.jsx("input",{type:"file",accept:"application/pdf, image/*",name:"uploadMeasurement",onChange:We,className:"border border-gray-300 p-2 w-full rounded-lg"}),e.jsx("small",{className:"text-red-500",children:((Ne=n==null?void 0:n.errors)==null?void 0:Ne.uploadMeasurement)&&((be=n==null?void 0:n.touched)==null?void 0:be.uploadMeasurement)&&((Ae=n==null?void 0:n.errors)==null?void 0:Ae.uploadMeasurement)})]}),e.jsx("div",{children:e.jsx(nt,{label:"Comment",name:"comment",formik:n,placeholder:"Comment"})})]})})]}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"justify-center items-center mt-4 gap-3",children:[((Re=(fe=l==null?void 0:l.data)==null?void 0:fe.data)==null?void 0:Re.assessment_type)=="New Assessment1"?e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(g.Button,{onClick:L,size:"sm",className:"bg-red-500 text-white",children:e.jsx("small",{children:"Back To Lipik"})})}):e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(g.Button,{onClick:L,size:"sm",className:"bg-red-500 text-white",children:e.jsx("small",{children:"Back To Back Office"})})}),((ve=(Te=(Ce=v==null?void 0:v.data)==null?void 0:Ce.data)==null?void 0:Te.permissions)==null?void 0:ve.can_forward)&&(((Se=(Fe=l==null?void 0:l.data)==null?void 0:Fe.data)==null?void 0:Se.assessment_type)=="New Assessment1"?e.jsxs("div",{className:"flex justify-center items-center gap-2 mt-4",children:[((Me=(Ie=(_e=l==null?void 0:l.data)==null?void 0:_e.data)==null?void 0:Ie.lastTcVerificationData)==null?void 0:Me.prop_type_id)=="4"&&e.jsx(g.Button,{type:"submit",onClick:()=>f("ATS"),size:"sm",className:"bg-blue-500 text-white",children:e.jsx("small",{children:"Send To ATS"})}),e.jsx(g.Button,{type:"submit",size:"sm",onClick:()=>f("SR_LIPIK"),className:"bg-green-500 text-white",children:e.jsx("small",{children:"Send To Nagar Rachna"})})]}):e.jsxs("div",{className:"flex justify-center items-center gap-2 mt-4",children:[e.jsx(g.Button,{type:"submit",onClick:()=>f("LIPIK"),size:"sm",className:"bg-blue-500 text-white",children:e.jsx("small",{children:"Send To Lipik"})}),e.jsx(g.Button,{type:"submit",size:"sm",onClick:()=>f("SR_LIPIK"),className:"bg-green-500 text-white",children:e.jsx("small",{children:"Send To Nagar Rachna"})})]}))]})})]})})]})}export{St as default};
