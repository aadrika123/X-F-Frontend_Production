import{d as Ce,c as ge,f,Q as b,j as e,I as ve}from"./index-3ck_aEIh.js";import{u as _e,e as Te}from"./router-5yjtezO8.js";import{r as d}from"./tailwind-6U-kYQAu.js";import{u as Fe}from"./formik.esm-BnzrXcQN.js";import{c as Pe,a as h,d as ue}from"./index.esm-uHa2PMRf.js";import{F as Ae}from"./FormProvider-0_zv-s35.js";import{T as p}from"./TextField-5uvvZ5_3.js";import"./index-iFVn5AxS.js";import{P as Me}from"./index-n7n4ULIF.js";import{r as Re}from"./resizeImage--5WTzS_k.js";import"./reactQuery-QTVGT_ni.js";import"./axios-lPgvryBG.js";import"./reactIcons-ElHvrKTF.js";import"./headlessui-iZReL1Rn.js";import"./customInputValidation-jhKsg103.js";function We(){var y,g,u,w,C,v,_,T,F,P,A,M,R,I,B,L,S,U,E,O,q,z,$,G,Y,k,V,Q,W,H,J,K,X,Z,D,ee,se,ae,te,de,le,re,ne,xe,ie,ce,oe,me,he,je,fe,be;const N=_e(),j=Ce({}),{id:l}=Te(),s=ge({api:f.waterGetDetails,config:{applicationId:l},value:[l],options:{enabled:!!l}}),t=ge({api:f.waterListDemand,config:{ConsumerId:l},value:[l],options:{enabled:!!l}}),x=Fe({enableReinitialize:!0,initialValues:{consumerId:l,demandUpto:new Date().toISOString().split("T")[0]||"",finalRading:"",document:"",connectionType:(g=(y=s==null?void 0:s.data)==null?void 0:y.data)==null?void 0:g.connection_type},validationSchema:Pe().shape({demandUpto:h().required("Demand Upto is required"),connectionType:h().optional(),finalRading:h().when("connectionType",{is:a=>a==1,then:()=>h().required("Final Meter Reading is required")}),document:ue().when("connectionType",{is:a=>a==1,then:()=>ue().required("Document is required")})}),onSubmit:async(a,{resetForm:i})=>{var m,c,o,pe,Ne,ye;try{const r=new FormData;r.append("consumerId",a==null?void 0:a.consumerId),r.append("demandUpto",a==null?void 0:a.demandUpto),r.append("finalRading",a==null?void 0:a.finalRading),r.append("document",a==null?void 0:a.document);const n=await j.mutateAsync({api:(m=f)==null?void 0:m.generateDemandWater,data:r});(c=n==null?void 0:n.data)!=null&&c.status?(b.success((o=n==null?void 0:n.data)==null?void 0:o.message),t.refetch()):b.error((pe=n==null?void 0:n.data)==null?void 0:pe.message)}catch(r){b.error((ye=(Ne=r==null?void 0:r.response)==null?void 0:Ne.data)==null?void 0:ye.message)}i()}}),we=async a=>{var c,o;const i=await Re(a.target.files[0]),m=new File([i],(o=(c=a==null?void 0:a.target)==null?void 0:c.files[0])==null?void 0:o.name,{type:"image/*"});x.setFieldValue("document",m)};return s!=null&&s.isLoading||t!=null&&t.isLoading?e.jsx(ve,{}):e.jsx(Me,{title:"Consumer Details",children:e.jsxs("div",{className:"p-4",children:[e.jsx(d.Card,{children:e.jsxs(d.CardBody,{children:[e.jsx("div",{className:"flex flex-row justify-between mb-3",children:e.jsx("h1",{className:"text-sm font-semibold",children:"# Basic Details"})}),e.jsx("div",{className:"my-3 border-b-2"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Applicant name:"}),e.jsx("h1",{className:"text-xs",children:(w=(u=s==null?void 0:s.data)==null?void 0:u.data)==null?void 0:w.applicant_name})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Property No:"}),e.jsx("h1",{className:"text-xs",children:((v=(C=s==null?void 0:s.data)==null?void 0:C.data)==null?void 0:v.folio_no)||"--"})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Consumer No:"}),e.jsx("h1",{className:"text-xs",children:(T=(_=s==null?void 0:s.data)==null?void 0:_.data)==null?void 0:T.consumer_no})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Address:"}),e.jsx("h1",{className:"text-xs w-36 truncate",children:((P=(F=s==null?void 0:s.data)==null?void 0:F.data)==null?void 0:P.address)||"--"})]})]})]})}),e.jsxs(d.Card,{className:"w-full mt-5",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-sm font-semibold text-gray-100",children:"# Meter/Fixed Connection Details"})}),e.jsx(d.CardBody,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Connection Type:"}),e.jsx("h1",{className:"text-xs",children:((R=(M=(A=s==null?void 0:s.data)==null?void 0:A.data)==null?void 0:M.meterDetails)==null?void 0:R.ConnectionTypeName)||"--"})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Meter No:"}),e.jsx("h1",{className:"text-xs",children:(L=(B=(I=s==null?void 0:s.data)==null?void 0:I.data)==null?void 0:B.meterDetails)==null?void 0:L.meter_no})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Last Meter Reading:"}),e.jsx("h1",{className:"text-xs",children:(U=(S=s==null?void 0:s.data)==null?void 0:S.data)==null?void 0:U.finalReading})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Reading Date:"}),e.jsx("h1",{className:"text-xs",children:((O=(E=s==null?void 0:s.data)==null?void 0:E.data)==null?void 0:O.reading_date)||"--"})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Connection Date:"}),e.jsx("h1",{className:"text-xs",children:(($=(z=(q=s==null?void 0:s.data)==null?void 0:q.data)==null?void 0:z.meterDetails)==null?void 0:$.connection_date)||"--"})]})]})})]}),e.jsxs(d.Card,{className:"mt-4 w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-sm font-semibold text-gray-100",children:"Demand List"})}),e.jsx(d.CardBody,{children:e.jsx("div",{className:"relative overflow-x-auto  sm:rounded-lg",children:e.jsxs("table",{className:"w-full text-xs text-left  border-slate-400 border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"# Sno."}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"DEMAND FROM"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"DEMAND UPTO"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"DEMAND AMOUNT"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"PENALTY"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"CONNECTION TYPE"}),e.jsx("th",{className:"text-xs font-semibold p-4 border border-slate-300",children:"PAYABLE AMOUNT"})]})}),e.jsx("tbody",{children:(k=(Y=(G=t==null?void 0:t.data)==null?void 0:G.data)==null?void 0:Y.consumerDemands)==null?void 0:k.map((a,i)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:i+1}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:a==null?void 0:a.demand_from}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:a==null?void 0:a.demand_upto}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:a==null?void 0:a.balance_amount}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:a==null?void 0:a.penalty}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:a==null?void 0:a.connection_type}),e.jsx("td",{className:"text-xs p-4 border border-slate-300",children:(a==null?void 0:a.due_balance_amount)||0})]},i))})]})})})]}),e.jsx(Ae,{formik:x,children:e.jsxs(d.Card,{className:"mt-4 w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-sm font-semibold text-gray-100",children:"Generate Demand"})}),e.jsx(d.CardBody,{children:e.jsxs("div",{className:"my-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[((Q=(V=s==null?void 0:s.data)==null?void 0:V.data)==null?void 0:Q.connection_type)==1&&e.jsxs(e.Fragment,{children:[e.jsx(p,{formik:x,name:"finalRading",type:"number",placeholder:"Final Meter Reading"}),e.jsxs("div",{children:[e.jsx(p,{accept:"image/*",name:"document",type:"file",onChange:a=>we(a)}),e.jsx("small",{className:"text-red-500 -mt-6",children:(W=x==null?void 0:x.errors)==null?void 0:W.document})]})]}),e.jsx(p,{disabled:!0,name:"demandUpto",type:"text",formik:x})]}),e.jsx("div",{className:"flex flex-row justify-center mt-2 gap-5",children:e.jsx(d.Button,{type:"submit",color:"blue",size:"sm",loading:j.isLoading,disabled:j.isLoading,children:e.jsx("small",{children:"Generate Demand"})})})]})})]})}),e.jsxs(d.Card,{className:"w-full mt-4",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-sm font-semibold text-gray-100",children:"Payment Details"})}),e.jsx(d.CardBody,{children:e.jsxs("div",{className:"flex flex-col",children:[((J=(H=t==null?void 0:t.data)==null?void 0:H.data)==null?void 0:J.totalSumDemand)>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Total Dues:"}),e.jsxs("h1",{className:"text-xs",children:["â‚¹"," ",((X=(K=t==null?void 0:t.data)==null?void 0:K.data)==null?void 0:X.totalSumDemand)||"0"]})]}),((D=(Z=s==null?void 0:s.data)==null?void 0:Z.data)==null?void 0:D.demand_from)!=null&&((se=(ee=s==null?void 0:s.data)==null?void 0:ee.data)==null?void 0:se.demand_upto)!=""&&e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Due From:"}),e.jsx("h1",{className:"text-xs",children:(te=(ae=s==null?void 0:s.data)==null?void 0:ae.data)==null?void 0:te.demand_from})]}),((le=(de=s==null?void 0:s.data)==null?void 0:de.data)==null?void 0:le.demand_upto)!=null&&((ne=(re=s==null?void 0:s.data)==null?void 0:re.data)==null?void 0:ne.demand_upto)!=""&&e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Due Upto:"}),e.jsx("h1",{className:"text-xs",children:(ie=(xe=s==null?void 0:s.data)==null?void 0:xe.data)==null?void 0:ie.demand_upto})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsxs("h1",{className:"text-xs font-semibold",children:["Total Due Demand ",e.jsx("small",{children:"(Month)"}),":"," "]}),e.jsx("h1",{className:"text-xs",children:((me=(oe=(ce=t==null?void 0:t.data)==null?void 0:ce.data)==null?void 0:oe.consumerDemands)==null?void 0:me.length)||"--"})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-xs font-semibold",children:"Total Payable Amount:"}),e.jsxs("h1",{className:"text-xs ",children:["â‚¹ ",((je=(he=t==null?void 0:t.data)==null?void 0:he.data)==null?void 0:je.totalSumDemand)||"0"]})]})]}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex flex-row justify-center items-center mb-2",children:e.jsx("h1",{className:"font-bold text-red-900",children:"No Dues "})})}),e.jsx("div",{className:"my-3 border-b-2"}),e.jsx("div",{className:"flex flex-row justify-center gap-5",children:((be=(fe=t==null?void 0:t.data)==null?void 0:fe.data)==null?void 0:be.totalSumDemand)>0&&e.jsxs(e.Fragment,{children:[e.jsx(d.Button,{color:"blue",size:"sm",onClick:()=>N("/amc-app/water/water-payment/".concat(l)),children:e.jsx("small",{children:"Pay Demand"})}),e.jsx(d.Button,{color:"red",size:"sm",onClick:()=>N("/amc-app/water/demand-receipt/".concat(l)),children:e.jsx("small",{children:"Print Demand"})})]})})]})})]})]})})}export{We as default};
