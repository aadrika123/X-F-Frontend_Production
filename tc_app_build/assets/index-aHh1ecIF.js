import{j as e,b as re,a as X,p as w,g as ne,S as Z,Q as m,f as oe}from"./index-KGM8Jklw.js";import{u as le,d as D,h as ce}from"./router-g9NwwHut.js";import{u as de}from"./formik.esm-MEJnthxH.js";import{c as me,f as pe,a as ue}from"./index.esm-lGQm42K_.js";import{F as xe}from"./FormProvider-Cjebd6nJ.js";import{T as he}from"./TextAreaField-6WeKYMLJ.js";import"./index-KJUlVKah.js";import{r as g}from"./tailwind-xMhOhnt0.js";import{P as fe}from"./index-EmwJpn9b.js";import{r as ge}from"./resizeImage-cEbWqQgk.js";import{O as je}from"./OverLayLoader-LEb2mP1-.js";import{l as ee}from"./reactPdfViewerCore-9ACLRJuU.js";import{l as be}from"./reactPdfViewerDefaultLayout-kL0TZy5g.js";import"./reactQuery-Q7rJjNxq.js";import"./reactQueryDevtools-6dm9iask.js";import"./axios-hq-Xw8mW.js";import"./reactIcons-TqjzQo_g.js";import"./headlessui-QgKi6LbN.js";import"./module-mvP-vUpq.js";function we(l){const x=be.defaultLayoutPlugin({sidebarTabs:j=>[],...!(l!=null&&l.toolbar)&&{renderToolbar:j=>[]}});return e.jsx("div",{className:"".concat(l==null?void 0:l.height),children:e.jsx(ee.Worker,{workerUrl:"https://unpkg.com/pdfjs-dist@3.4.120/build/pdf.worker.min.js",children:e.jsx(ee.Viewer,{fileUrl:l==null?void 0:l.fileUrl,plugins:[x]})})})}function Ve(){var v,M,C,B,S,A,F,P,I,L,T,_,U,R,z,k,O,V,$,E,Y,q,K,Q,W,G,H,J;const l=le(),x=re({}),[j,y]=D.useState(""),[ae,N]=D.useState(""),{id:h}=ce(),a=X({api:w.staticSafDetail,config:{applicationId:h},value:[h],options:{enabled:!!h}}),f=X({api:(v=ne)==null?void 0:v.workFlowInfo,config:{workflowId:(C=(M=a==null?void 0:a.data)==null?void 0:M.data)==null?void 0:C.workflow_id},value:[(S=(B=a==null?void 0:a.data)==null?void 0:B.data)==null?void 0:S.workflow_id],options:{enabled:!!((F=(A=a==null?void 0:a.data)==null?void 0:A.data)!=null&&F.workflow_id)}}),r=de({initialValues:{uploadMeasurement:"",comment:""},validationSchema:me({uploadMeasurement:pe().required("Measurement Sheet is required").test("fileSize","Max 10 mb file size",t=>(t==null?void 0:t.size)<=1e7),comment:ue().label("Comment").min(2).max(500)}),onSubmit:async t=>{Z.fire({title:"Are you sure?",text:"\n       You are going to forward the application to the next level.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(s=>{s.isConfirmed&&te(t)}).catch(s=>{var n,o;m.error((o=(n=s==null?void 0:s.response)==null?void 0:n.data)==null?void 0:o.message)})}}),te=async t=>{var n,o,u,d,i,b;const s=new FormData;s.append("applicationId",h),s.append("document",t==null?void 0:t.uploadMeasurement);try{const c=await x.mutateAsync({api:w.uploadMeasurementSheetApi,data:s});if((n=c==null?void 0:c.data)!=null&&n.status){const p=await x.mutateAsync({api:w.safLevel,data:{applicationId:h,receiverRoleId1:"",action:"forward",comment:(t==null?void 0:t.comment)||"OK"}});(o=p==null?void 0:p.data)!=null&&o.status?(m.success((u=p==null?void 0:p.data)==null?void 0:u.message),l("/amc-app/property/saf-verification-list",{replace:!0})):m.error((d=p==null?void 0:p.data)==null?void 0:d.message)}else m.error((i=c==null?void 0:c.data)==null?void 0:i.message)}catch(c){m.error((b=c==null?void 0:c.data)==null?void 0:b.message)}},se=async()=>{var t;if(((t=r==null?void 0:r.values)==null?void 0:t.comment)=="")return m.error("Comment is required !");Z.fire({title:"Are you sure?",text:"You are going to backward of this application",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(async s=>{var n,o,u,d;if(s.isConfirmed)try{const i=await x.mutateAsync({api:w.safLevel,data:{applicationId:h,receiverRoleId1:"",action:"backward",comment:((n=r==null?void 0:r.values)==null?void 0:n.comment)||"No Comment"}});(o=i==null?void 0:i.data)!=null&&o.status?(m.success((u=i==null?void 0:i.data)==null?void 0:u.message),l("/amc-app/property/saf-verification-list",{replace:!0})):m.error(((d=i==null?void 0:i.data)==null?void 0:d.message)||"Something went wrong, Please try again")}catch(i){m.error(i==null?void 0:i.message)}}).catch(s=>{var n,o;m.error((o=(n=s==null?void 0:s.response)==null?void 0:n.data)==null?void 0:o.message)})},ie=async t=>{var n,o,u;const s=t.target.files[0];if((s==null?void 0:s.type)==="application/pdf"){const d=new FileReader;d.onload=i=>{y(i.target.result),N(s.name.split(".").pop())},d.readAsDataURL(s),r.setFieldValue("uploadMeasurement",s)}else{const d=await ge((n=t==null?void 0:t.target)==null?void 0:n.files[0]),i=new File([d],(u=(o=t==null?void 0:t.target)==null?void 0:o.files[0])==null?void 0:u.name,{type:"image/*"}),b=new FileReader;b.onload=c=>{y(c.target.result),N(i.name.split(".").pop())},b.readAsDataURL(i),r.setFieldValue("uploadMeasurement",i)}};return a!=null&&a.isLoading?e.jsx(oe,{}):e.jsxs(fe,{title:"Measurement",children:[x.isLoading&&e.jsx(je,{}),e.jsx(xe,{formik:r,children:e.jsxs("div",{className:"p-4 ",children:[e.jsx(g.Card,{className:"w-full",children:e.jsxs(g.CardBody,{children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h1",{className:"font-semibold",children:"Measurement Sheet"})}),e.jsx("div",{className:"border-b-2 border-gray-300 w-full py-1"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[e.jsx("h1",{className:"font-semibold text-sm",children:"Application No : "}),e.jsx("h1",{className:"text-sm",children:(I=(P=a==null?void 0:a.data)==null?void 0:P.data)==null?void 0:I.saf_no}),e.jsx("h1",{className:"font-semibold text-sm",children:"Application Type : "}),e.jsx("h1",{className:"text-sm",children:(T=(L=a==null?void 0:a.data)==null?void 0:L.data)==null?void 0:T.assessment_type}),e.jsx("h1",{className:"font-semibold text-sm",children:"Apply Date : "}),e.jsx("h1",{className:"text-sm",children:(U=(_=a==null?void 0:a.data)==null?void 0:_.data)==null?void 0:U.application_date}),e.jsx("h1",{className:"font-semibold text-sm",children:"Owner Name : "}),e.jsx("h1",{className:"text-sm",children:(z=(R=a==null?void 0:a.data)==null?void 0:R.data)==null?void 0:z.applicant_name}),e.jsx("h1",{className:"font-semibold text-sm",children:"Mobile No : "}),e.jsx("h1",{className:"text-sm w-40 truncate",children:($=(V=(O=(k=a==null?void 0:a.data)==null?void 0:k.data)==null?void 0:O.owners)==null?void 0:V.map(t=>t==null?void 0:t.mobile_no))==null?void 0:$.join(", ")})]})]})}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs(g.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-base font-semibold text-gray-100",children:"Upload Measurement Sheet"})}),j&&(ae==="pdf"?e.jsx(we,{fileUrl:j}):e.jsx("div",{className:"flex justify-center px-4 py-2",children:e.jsx("img",{src:j,alt:"preview",loading:"lazy"})})),e.jsx(g.CardBody,{children:e.jsxs("div",{className:"grid grid-cols-1 justify-center gap-5",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1",children:e.jsx("h1",{className:"font-semibold text-xs",children:"Upload Measurement Sheet"})}),e.jsx("input",{type:"file",accept:"application/pdf, image/*",name:"uploadMeasurement",onChange:ie,className:"border border-gray-300 p-2 w-full rounded-lg"}),e.jsx("small",{className:"text-red-500",children:((E=r==null?void 0:r.errors)==null?void 0:E.uploadMeasurement)&&((Y=r==null?void 0:r.touched)==null?void 0:Y.uploadMeasurement)&&((q=r==null?void 0:r.errors)==null?void 0:q.uploadMeasurement)})]}),e.jsx("div",{children:e.jsx(he,{label:"Comment",name:"comment",formik:r,placeholder:"Comment"})})]})})]}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"flex justify-center items-center mt-4 gap-3",children:[((W=(Q=(K=f==null?void 0:f.data)==null?void 0:K.data)==null?void 0:Q.permissions)==null?void 0:W.can_backward)&&e.jsx(g.Button,{onClick:se,size:"sm",className:"bg-red-500 text-white",children:e.jsx("small",{children:"Back To Back Office"})}),((J=(H=(G=f==null?void 0:f.data)==null?void 0:G.data)==null?void 0:H.permissions)==null?void 0:J.can_forward)&&e.jsx(g.Button,{type:"submit",size:"sm",className:"bg-blue-500 text-white",children:e.jsx("small",{children:"Forward"})})]})})]})})]})}export{Ve as default};
