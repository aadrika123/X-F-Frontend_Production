import{b as re,a as ee,p as j,g as oe,S as ae,Q as d,j as e,f as ce}from"./index-oMCNvfzY.js";import{d as w,u as le,h as de}from"./router-Gz5zDwiC.js";import{u as me}from"./formik.esm--kcEIyis.js";import{c as pe,f as ue,a as xe}from"./index.esm-R3GYZtbq.js";import{F as he}from"./FormProvider-Z7kESPTC.js";import{T as fe}from"./TextAreaField-jw-_khpP.js";import"./index-iyheVW_q.js";import{r as u}from"./tailwind-I_6OOYa1.js";import{P as ge}from"./index-gpvjJkSB.js";import{r as je}from"./resizeImage-nk6vCBqQ.js";import{O as ye}from"./OverLayLoader-fww_W-DF.js";import{M as we}from"./MyPDFViewer-u53N0xaW.js";import"./reactQuery-jbZnqRwH.js";import"./reactQueryDevtools-6dm9iask.js";import"./axios-lPgvryBG.js";import"./reactIcons-3AhG4mX-.js";import"./headlessui-KvrvKpJj.js";import"./customInputValidation-8tSUGdUh.js";import"./module-PgHPULbe.js";import"./reactPdfViewerCore-HxTK9eZg.js";import"./reactPdfViewerDefaultLayout-967xp4WC.js";function Ye(){var I,S,P,B,A,F,L,R,_,T,k,z,U,K,O,V,Y,$,q,E,W,Q,G,H,J,X,Z,D;const[N,b]=w.useState(""),v=le(),g=re({}),[y,M]=w.useState(""),[te,C]=w.useState(""),{id:x}=de(),a=ee({api:j.staticSafDetail,config:{applicationId:x},value:[x],options:{enabled:!!x}}),h=ee({api:(I=oe)==null?void 0:I.workFlowInfo,config:{workflowId:(P=(S=a==null?void 0:a.data)==null?void 0:S.data)==null?void 0:P.workflow_id},value:[(A=(B=a==null?void 0:a.data)==null?void 0:B.data)==null?void 0:A.workflow_id],options:{enabled:!!((L=(F=a==null?void 0:a.data)==null?void 0:F.data)!=null&&L.workflow_id)}}),n=me({initialValues:{uploadMeasurement:"",comment:""},validationSchema:pe({uploadMeasurement:ue().required("Measurement Sheet is required").test("fileSize","Max 10 mb file size",t=>(t==null?void 0:t.size)<=1e7),comment:xe().label("Comment").min(2).max(500)}),onSubmit:async t=>{ae.fire({title:"Are you sure?",text:"\n       You are going to forward the application to the ".concat(N==="LIPIK"?"Lipik":"Nagar Rachna"),icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(s=>{s.isConfirmed&&se(t)}).catch(s=>{var r,o;console.log(s),d.error((o=(r=s==null?void 0:s.response)==null?void 0:r.data)==null?void 0:o.message)})}}),se=async t=>{var r,o,p,l,i,f;const s=new FormData;s.append("applicationId",x),s.append("document",t==null?void 0:t.uploadMeasurement);try{const c=await g.mutateAsync({api:j.uploadMeasurementSheetApi,data:s});if((r=c==null?void 0:c.data)!=null&&r.status){const m=await g.mutateAsync({api:j.safLevelV2,data:{applicationId:x,receiverRoleId:N==="LIPIK"?"6":"7",action:"forward",comment:(t==null?void 0:t.comment)||"OK"}});(o=m==null?void 0:m.data)!=null&&o.status?(d.success((p=m==null?void 0:m.data)==null?void 0:p.message),v("/amc-app/property/saf-verification-list",{replace:!0})):d.error((l=m==null?void 0:m.data)==null?void 0:l.message)}else d.error((i=c==null?void 0:c.data)==null?void 0:i.message)}catch(c){d.error((f=c==null?void 0:c.data)==null?void 0:f.message)}},ie=async()=>{var t;if(((t=n==null?void 0:n.values)==null?void 0:t.comment)=="")return d.error("Comment is required !");ae.fire({title:"Are you sure?",text:"You are going to backward of this application",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(async s=>{var r,o,p,l;if(s.isConfirmed)try{const i=await g.mutateAsync({api:j.safLevel,data:{applicationId:x,receiverRoleId1:"",action:"backward",comment:((r=n==null?void 0:n.values)==null?void 0:r.comment)||"No Comment"}});(o=i==null?void 0:i.data)!=null&&o.status?(d.success((p=i==null?void 0:i.data)==null?void 0:p.message),v("/amc-app/property/saf-verification-list",{replace:!0})):d.error(((l=i==null?void 0:i.data)==null?void 0:l.message)||"Something went wrong, Please try again")}catch(i){d.error(i==null?void 0:i.message),console.log(i)}}).catch(s=>{var r,o;d.error((o=(r=s==null?void 0:s.response)==null?void 0:r.data)==null?void 0:o.message)})},ne=async t=>{var r,o,p;const s=t.target.files[0];if((s==null?void 0:s.type)==="application/pdf"){const l=new FileReader;l.onload=i=>{M(i.target.result),C(s.name.split(".").pop())},l.readAsDataURL(s),n.setFieldValue("uploadMeasurement",s)}else{const l=await je((r=t==null?void 0:t.target)==null?void 0:r.files[0]),i=new File([l],(p=(o=t==null?void 0:t.target)==null?void 0:o.files[0])==null?void 0:p.name,{type:"image/*"}),f=new FileReader;f.onload=c=>{M(c.target.result),C(i.name.split(".").pop())},f.readAsDataURL(i),n.setFieldValue("uploadMeasurement",i)}};return a!=null&&a.isLoading?e.jsx(ce,{}):e.jsxs(ge,{title:"Measurement",children:[g.isLoading&&e.jsx(ye,{}),e.jsx(he,{formik:n,children:e.jsxs("div",{className:"p-4 ",children:[e.jsx(u.Card,{className:"w-full",children:e.jsxs(u.CardBody,{children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h1",{className:"font-semibold",children:"Measurement Sheet"})}),e.jsx("div",{className:"border-b-2 border-gray-300 w-full py-1"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[e.jsx("h1",{className:"font-semibold text-sm",children:"Application No : "}),e.jsx("h1",{className:"text-sm",children:(_=(R=a==null?void 0:a.data)==null?void 0:R.data)==null?void 0:_.saf_no}),e.jsx("h1",{className:"font-semibold text-sm",children:"Application Type : "}),e.jsx("h1",{className:"text-sm",children:(k=(T=a==null?void 0:a.data)==null?void 0:T.data)==null?void 0:k.assessment_type}),e.jsx("h1",{className:"font-semibold text-sm",children:"Apply Date : "}),e.jsx("h1",{className:"text-sm",children:(U=(z=a==null?void 0:a.data)==null?void 0:z.data)==null?void 0:U.application_date}),e.jsx("h1",{className:"font-semibold text-sm",children:"Owner Name : "}),e.jsx("h1",{className:"text-sm",children:(O=(K=a==null?void 0:a.data)==null?void 0:K.data)==null?void 0:O.applicant_name}),e.jsx("h1",{className:"font-semibold text-sm",children:"Mobile No : "}),e.jsx("h1",{className:"text-sm w-40 truncate",children:(q=($=(Y=(V=a==null?void 0:a.data)==null?void 0:V.data)==null?void 0:Y.owners)==null?void 0:$.map(t=>t==null?void 0:t.mobile_no))==null?void 0:q.join(", ")})]})]})}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs(u.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-base font-semibold text-gray-100",children:"Upload Measurement Sheet"})}),y&&(te==="pdf"?e.jsx(we,{fileUrl:y}):e.jsx("div",{className:"flex justify-center px-4 py-2",children:e.jsx("img",{src:y,alt:"preview",loading:"lazy"})})),e.jsx(u.CardBody,{children:e.jsxs("div",{className:"grid grid-cols-1 justify-center gap-5",children:[e.jsxs("div",{children:[e.jsx("div",{className:"mb-1",children:e.jsx("h1",{className:"font-semibold text-xs",children:"Upload Measurement Sheet"})}),e.jsx("input",{type:"file",accept:"application/pdf, image/*",name:"uploadMeasurement",onChange:ne,className:"border border-gray-300 p-2 w-full rounded-lg"}),e.jsx("small",{className:"text-red-500",children:((E=n==null?void 0:n.errors)==null?void 0:E.uploadMeasurement)&&((W=n==null?void 0:n.touched)==null?void 0:W.uploadMeasurement)&&((Q=n==null?void 0:n.errors)==null?void 0:Q.uploadMeasurement)})]}),e.jsx("div",{children:e.jsx(fe,{label:"Comment",name:"comment",formik:n,placeholder:"Comment"})})]})})]}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"justify-center items-center mt-4 gap-3",children:[((J=(H=(G=h==null?void 0:h.data)==null?void 0:G.data)==null?void 0:H.permissions)==null?void 0:J.can_backward)&&e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(u.Button,{onClick:ie,size:"sm",className:"bg-red-500 text-white",children:e.jsx("small",{children:"Back To Back Office"})})}),((D=(Z=(X=h==null?void 0:h.data)==null?void 0:X.data)==null?void 0:Z.permissions)==null?void 0:D.can_forward)&&e.jsxs("div",{className:"flex justify-center items-center gap-2 mt-4",children:[e.jsx(u.Button,{type:"submit",onClick:()=>b("LIPIK"),size:"sm",className:"bg-blue-500 text-white",children:e.jsx("small",{children:"Send To Lipik "})}),e.jsx(u.Button,{type:"submit",size:"sm",onClick:()=>b("SR_LIPIK"),className:"bg-green-500 text-white",children:e.jsx("small",{children:"Send To Nagar Rachna"})})]})]})})]})})]})}export{Ye as default};
