import{j as o,d as B,v as q,Q as T,c as k}from"./index-tJbU7ayB.js";import{d as P}from"./router-vSHQYlWC.js";import{u as $}from"./formik.esm-feHG9Gj_.js";import{c as z,a as _}from"./index.esm-YegZWto1.js";import{F as K}from"./FormProvider-fBqmJEVl.js";import{T as ee}from"./TextField-QPeamiX3.js";import{L as Q}from"./LoaderButton-OBeIHsxX.js";import"./TranslateField-wCz68bV9.js";import{u as te}from"./useCountDown-4IQq9N8X.js";var M=function(n){return typeof n=="object"&&n!==null},ae=function(n){var a=n.value,r=a===void 0?"":a,p=n.numInputs,s=p===void 0?4:p,g=n.onChange,S=n.onPaste,N=n.renderInput,D=n.shouldAutoFocus,v=D===void 0?!1:D,l=n.inputType,i=l===void 0?"text":l,O=n.renderSeparator,h=n.placeholder,b=n.containerStyle,y=n.inputStyle,j=n.skipDefaultStyles,u=j===void 0?!1:j,c=P.useState(0),f=c[0],C=c[1],I=P.useRef([]),F=function(){return r?r.toString().split(""):[]},V=i==="number"||i==="tel";P.useEffect(function(){I.current=I.current.slice(0,s)},[s]),P.useEffect(function(){var e;v&&((e=I.current[0])===null||e===void 0||e.focus())},[v]);var U=function(){if(typeof h=="string"){if(h.length===s)return h;h.length>0&&console.error("Length of the placeholder should be equal to the number of inputs.")}},R=function(e){var t=V?!isNaN(Number(e)):typeof e=="string";return t&&e.trim().length===1},G=function(e){var t=e.target.value;R(t)&&(w(t),A(f+1))},H=function(e){var t=e.nativeEvent,d=e.target.value;if(!R(d)){if(d.length===s){var m=d.split("").some(function(x){return!R(x)});m||(L(d.split("")),A(s-1))}t.data===null&&t.inputType==="deleteContentBackward"&&(e.preventDefault(),w(""),A(f-1)),e.target.value=""}},J=function(e){return function(t){C(t),e.target.select()}},W=function(){C(f-1)},X=function(e){var t=F();[e.code,e.key].includes("Backspace")?(e.preventDefault(),w(""),A(f-1)):e.code==="Delete"?(e.preventDefault(),w("")):e.code==="ArrowLeft"?(e.preventDefault(),A(f-1)):e.code==="ArrowRight"||e.key===t[f]?(e.preventDefault(),A(f+1)):(e.code==="Spacebar"||e.code==="Space"||e.code==="ArrowUp"||e.code==="ArrowDown")&&e.preventDefault()},A=function(e){var t,d,m=Math.max(Math.min(s-1,e),0);I.current[m]&&((t=I.current[m])===null||t===void 0||t.focus(),(d=I.current[m])===null||d===void 0||d.select(),C(m))},w=function(e){var t=F();t[f]=e[0],L(t)},L=function(e){var t=e.join("");g(t)},Y=function(e){var t;e.preventDefault();var d=F(),m=f,x=e.clipboardData.getData("text/plain").slice(0,s-f).split("");if(!(V&&x.some(function(Z){return isNaN(Number(Z))}))){for(var E=0;E<s;++E)E>=f&&x.length>0&&(d[E]=(t=x.shift())!==null&&t!==void 0?t:"",m++);A(m),L(d)}};return P.createElement("div",{style:Object.assign({display:"flex",alignItems:"center"},M(b)&&b),className:typeof b=="string"?b:void 0,onPaste:S},Array.from({length:s},function(e,t){return t}).map(function(e){var t,d,m;return P.createElement(P.Fragment,{key:e},N({value:(t=F()[e])!==null&&t!==void 0?t:"",placeholder:(m=(d=U())===null||d===void 0?void 0:d[e])!==null&&m!==void 0?m:void 0,ref:function(x){return I.current[e]=x},onChange:G,onFocus:function(x){return J(x)(e)},onBlur:W,onKeyDown:X,onPaste:Y,autoComplete:"off","aria-label":"Please enter OTP character ".concat(e+1),style:Object.assign(u?{}:{width:"1em",textAlign:"center"},M(y)?y:{}),className:typeof y=="string"?y:void 0,type:i,inputMode:V?"numeric":"text",onInput:H},e),e<s-1&&(typeof O=="function"?O(e):O))}))};function ne({label:n,name:a,formik:r}){return o.jsxs("div",{className:"mb-4",children:[o.jsx("label",{htmlFor:a,className:"block text-gray-600 text-sm mb-1",children:n}),o.jsx(ae,{inputStyle:{width:"100%",height:"2.5rem",margin:"0.2rem",fontSize:"1rem",borderRadius:"0.375rem",border:"1px solid #E5E7EB",backgroundColor:"#F3F4F6",color:"#111827",textAlign:"center"},numInputs:6,inputType:"number",renderSeparator:o.jsx("span",{children:"-"}),shouldAutoFocus:!0,value:(r==null?void 0:r.values[a])||"",onChange:p=>{r==null||r.setFieldValue(a,p)},renderInput:p=>o.jsx("input",{...p})}),o.jsx("span",{className:"text-red-600  text-xs",children:(r==null?void 0:r.touched[a])&&(r==null?void 0:r.errors[a])})]})}const re=z().shape({email:_().required("Email is required").email("Invalid email")});function he({next:n,data:a,setData:r}){const p=B({}),s=$({enableReinitialize:!0,initialValues:{email:a.email||""},validationSchema:re,onSubmit:async(g,{})=>{var S,N,D,v;try{const l=await p.mutateAsync({api:q.SendOtpApi,data:{email:g.email}});(S=l==null?void 0:l.data)!=null&&S.status?(n({...a,email:g==null?void 0:g.email,mobile:(N=l.data)==null?void 0:N.data},!1),T.success((D=l==null?void 0:l.data)==null?void 0:D.message)):T.error((v=l==null?void 0:l.data)==null?void 0:v.message)}catch(l){T.error(l.message)}}});return o.jsxs(K,{formik:s,children:[o.jsx("h2",{className:" font-semibold mt-8 mb-4",children:"Login with OTP"}),o.jsx(ee,{label:"Email",name:"email",type:"email",formik:s,placeholder:"Enter your email address"}),o.jsx(Q,{className:"w-full mt-4 ".concat(p.isLoading?"bg-gray-400":"bg-blue-500"),type:"submit",disabled:p.isLoading||!s.isValid,loading:p.isLoading,children:"Send OTP"})]})}const ie=z().shape({otp:_().required("OTP is required")});function ge({next:n,data:a,setData:r,prev:p}){const s=k(),g=B({}),S=B({}),{minutes:N,seconds:D,togglerTimer:v,runTimer:l}=te(1),i=$({enableReinitialize:!0,initialValues:{email:(a==null?void 0:a.email)||"",otp:(a==null?void 0:a.otp)||"",mobile:(a==null?void 0:a.mobile)||"",type:"mobile"},validationSchema:ie,onSubmit:async(h,{resetForm:b})=>{var y,j,u;try{const c=await g.mutateAsync({api:q.VerifyOtpApi,data:{email:h.email,otp:h.otp,type:h.type}});((y=c==null?void 0:c.data)==null?void 0:y.status)===!0?(s==null||s.login(c),T.success((j=c==null?void 0:c.data)==null?void 0:j.message)):(T.error((u=c==null?void 0:c.data)==null?void 0:u.message),b({values:{otp:""}}),r({...a,otp:""}),v())}catch(c){console.log(c)}}});P.useEffect(()=>(v(),()=>{v()}),[]);const O=async()=>{var h,b,y,j;try{const u=await S.mutateAsync({api:q.SendOtpApi,data:{email:i==null?void 0:i.values.email}});(h=u==null?void 0:u.data)!=null&&h.status?(v(),r({email:i==null?void 0:i.values.email,mobile:(b=u.data)==null?void 0:b.data,otp:""}),i.setFieldValue("otp",""),T.success((y=u==null?void 0:u.data)==null?void 0:y.message)):T.error((j=u==null?void 0:u.data)==null?void 0:j.message)}catch(u){T.error(u.message)}};return o.jsxs(K,{formik:i,children:[o.jsxs("h1",{className:"text-sm mt-8 mb-4",children:["Please enter the 6-digit verification code sent to your phone number +91"," ",i==null?void 0:i.values.mobile," ",o.jsx("span",{className:"text-sm text-blue-700",onClick:()=>p({email:i==null?void 0:i.values.email,otp:"",mobile:""}),children:"Edit"})]}),o.jsx(ne,{label:"Verify OTP",name:"otp",formik:i}),o.jsx(Q,{loading:g.isLoading,type:"submit",disabled:g.isLoading,children:"Verify"})," ",o.jsxs("div",{className:"text-center mt-8 text-sm",children:["Didn't receive the code?"," ",l?o.jsxs("span",{className:"text-gray-700 cursor-pointer",children:["Resend in ",N,":",D]}):o.jsx("span",{className:"text-blue-700 cursor-pointer",onClick:O,children:S.isLoading?"Resending...":S.isError?"Retry":"Resend OTP"})]})]})}export{he as S,ge as V};
