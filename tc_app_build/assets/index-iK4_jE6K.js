import{d as C,S as F,f as N,Q as m,b as v,j as e}from"./index-69AkISz-.js";import{e as D,u as I,d as S}from"./router-vSHQYlWC.js";import{u as P}from"./formik.esm-feHG9Gj_.js";import{c as q,a as p}from"./index.esm-YegZWto1.js";import{F as A}from"./FormProvider-c1CkDdBU.js";import{T as d}from"./TextField-2uzPwNdM.js";import{L as B}from"./LoaderButton-JrI1TC0v.js";import{S as k}from"./SelectField-842fHI13.js";import{T as E}from"./TextAreaField-OugU6bqr.js";import"./TranslateField-WhUfGY_x.js";import{r as O}from"./resizeImage-fH17lsYX.js";import{r as x}from"./tailwind-nPCoKmcy.js";import{P as U}from"./index-HMiWKIbn.js";import"./reactQuery-xwoMMF6K.js";import"./axios-lPgvryBG.js";import"./reactIcons-jqXmw8S_.js";import"./headlessui-kWR29u24.js";import"./customInputValidation-jhKsg103.js";const z=[{id:1,label:"Meter"},{id:3,label:"Fixed"}];function se(){var f,y;const w=D(),{id:l}=I(),g=C({}),[L,M]=S.useState(null),a=P({enableReinitialize:!0,initialValues:{connectionType:"",newMeterInitialReading:"",connectionDate:"",meterNo:"",oldMeterFinalReading:"",document:"",remarks:""},validationSchema:q().shape({connectionType:p().required("Connection type is required"),connectionDate:p().required("Connection date is required"),document:p().required("Document is required"),remarks:p().required("Remarks")}),onSubmit:async(t,{resetForm:c})=>{const n=new FormData;n.append("consumerId",l),n.append("remarks",t.remarks),n.append("connectionType",t.connectionType),n.append("connectionDate",t.connectionDate),n.append("meterNo",t.meterNo),n.append("oldMeterFinalReading",t.oldMeterFinalReading),n.append("newMeterInitialReading",t.newMeterInitialReading),n.append("document",t.document),F.fire({title:"Are you sure?",text:"\n          Update connection type",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(async o=>{var s,r,j,h,b;if(o.isConfirmed)try{const i=await g.mutateAsync({api:N.updateMeterDetails,data:n});(s=i==null?void 0:i.data)!=null&&s.status?(m.success((r=i==null?void 0:i.data)==null?void 0:r.message),c(),w("/amc-app/water/consumer-details/".concat(l),{replace:!0})):m.error((j=i==null?void 0:i.data)==null?void 0:j.message)}catch(i){m.error((b=(h=i==null?void 0:i.response)==null?void 0:h.data)==null?void 0:b.message)}}).catch(o=>{var s,r;console.log(o),m.error((r=(s=o==null?void 0:o.response)==null?void 0:s.data)==null?void 0:r.message)})}}),{values:R}=a,u=v({api:N.waterGetDetails,config:{applicationId:l},options:{enabled:!!l}}),T=async t=>{var o,s,r;if(!((o=t.target)!=null&&o.files[0]))return;await((s=window==null?void 0:window.ReactNativeWebView)==null?void 0:s.postMessage(JSON.stringify({Key:"OPEN_CAMERA"})));const c=await O(t.target.files[0]),n=new File([c],(r=t.target.files[0])==null?void 0:r.name,{type:"image/*"});a.setFieldValue("document",n),M(n)};return e.jsx(U,{title:"Update Connection Type",children:e.jsxs("div",{className:"p-2 mt-4",children:[e.jsx(x.Card,{className:"w-full",children:e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("div",{className:"text-sm font-semibold text-gray-100",children:"Update Connection Type"})})}),e.jsx(x.Card,{children:e.jsx(x.CardBody,{color:"blue",children:e.jsxs(A,{formik:a,children:[e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-md-6",children:[e.jsxs(k,{name:"connectionType",label:"Connection Type",formik:a,children:[e.jsx("option",{value:"",children:"Select connection type"}),z.filter(t=>{var c,n;return t.id!==((n=(c=u==null?void 0:u.data)==null?void 0:c.data)==null?void 0:n.connection_type)}).map(t=>e.jsx("option",{value:t.id,children:t.label},t.id))]}),R.connectionType==="1"&&e.jsx(d,{name:"newMeterInitialReading",label:"New Meter Reading",formik:a}),e.jsx(d,{type:"date",name:"connectionDate",label:"Connection Date",formik:a}),e.jsx(d,{name:"meterNo",label:"Meter No",formik:a}),e.jsx(d,{name:"oldMeterFinalReading",label:"Old Meter Reading",formik:a}),e.jsxs("div",{children:[e.jsx(d,{name:"document",label:"Document",type:"file",onChange:T}),((f=a==null?void 0:a.errors)==null?void 0:f.document)&&e.jsx("div",{className:"text-red-500 text-xs",children:(y=a==null?void 0:a.errors)==null?void 0:y.document})]}),e.jsx(E,{name:"remarks",label:"Remarks",formik:a})]})}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(B,{loading:g.isLoading,size:"sm",type:"submit",className:"btn btn-primary w-full",children:"Submit"})})]})})})]})})}export{se as default};
