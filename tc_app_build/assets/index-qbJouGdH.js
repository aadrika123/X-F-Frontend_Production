import{s as ee,R as b,a as te,i as ae,m as se,t as ie,l as re,p as T,Q as W,e as ne,j as e,r as f}from"./index-nj1Gdu0D.js";import{c as J,d as oe,a as N,e as de}from"./index.esm-0Oov44Az.js";import{u as le,F as ce}from"./formik.esm-Z1ktrTJu.js";import{F as ge}from"./FormProvider-vaCiOGXh.js";import{T as K}from"./TextField-_EARJRdS.js";import{T as me}from"./TextAreaField-9Vh1mk27.js";import{P as ue}from"./index-2hnj_Y0U.js";import{u as pe}from"./useErrorFocusFields-ELxwRhJT.js";import{O as he}from"./OverLayLoader-Kal6FfLb.js";import"./module-qsQV84Yv.js";const xe=h=>{const c=h.split(","),o=c[0].indexOf("base64")>=0?atob(c[1]):decodeURI(c[1]),x=c[0].split(":")[1].split(";")[0],u=new Uint8Array(o.length);for(let y=0;y<o.length;y++)u[y]=o.charCodeAt(y);return new Blob([u],{type:x})},ye=async h=>new Promise(o=>{ee.imageFileResizer(h,500,500,"JPEG",60,0,x=>{o(x)},"base64")}).then(o=>xe(o));function Ie(){var P,R,I,A,L,$,E,G,C,S,_,q;const{AutoFocusErrorField:h}=pe(),[c,o]=b.useState([]),x=te(),u=ae({}),[y,Q]=b.useState(null),{id:j}=se();b.useState(null);const{coords:p,isGeolocationAvailable:Y,isGeolocationEnabled:X}=ie({positionOptions:{enableHighAccuracy:!0,timeout:1/0},userDecisionTimeout:5e3,watchPosition:!0}),t=re({api:T.staticSafDetail,config:{applicationId:j},value:[j],options:{enabled:!!j}}),a=le({enableReinitialize:!0,initialValues:{comment:"",geoTagged:c.map(d=>({latitude:"",longitude:"",altitude:"",accuracy:"",imagePath:"",directionType:"",rainWaterHarvesting:""}))},validationSchema:J().shape({geoTagged:oe().of(J().shape({latitude:N().required("Latitude is required"),longitude:N().required("Longitude is required"),directionType:N().required("Direction is required"),imagePath:de().required("Image is required")}))}),onSubmit:async d=>{var i,m,l,g;const s=new FormData;s.append("safId",j),d.geoTagged.forEach((r,n)=>{s.append("latitude[".concat(n,"]"),r.latitude),s.append("longitude[".concat(n,"]"),r.longitude),s.append("directionType[".concat(n,"]"),r.directionType),s.append("imagePath[".concat(n,"]"),r.imagePath)});try{const r=await u.mutateAsync({api:T.geoTagging,data:s});if((i=r==null?void 0:r.data)!=null&&i.status){const n=await u.mutateAsync({api:T.safLevel,data:{applicationId:j,receiverRoleId1:"",action:"forward",comment:d.comment}});W.success((m=n==null?void 0:n.data)==null?void 0:m.message),x("/amc-app/property/saf-verification-list",{replace:!0})}}catch(r){W.error((g=(l=r==null?void 0:r.response)==null?void 0:l.data)==null?void 0:g.message)}}}),{submitCount:v,isSubmitting:w,errors:F,isValid:Z}=a,D=async(d,s,i)=>{var g;await((g=window==null?void 0:window.ReactNativeWebView)==null?void 0:g.postMessage(JSON.stringify({Key:"OPEN_CAMERA"})));const m=await ye(d.target.files[0]),l=new File([m],"image.jpg",{type:"image/jpeg"});console.log(Math.round(l.size/1024/1024*100)/100+"MB"),a.setFieldValue("geoTagged.".concat(s,".latitude"),p==null?void 0:p.latitude),a.setFieldValue("geoTagged.".concat(s,".longitude"),p==null?void 0:p.longitude),a.setFieldValue("geoTagged.".concat(s,".directionType"),i==null?void 0:i.directionType),a.setFieldValue("geoTagged.".concat(s,".imagePath"),l),Q(l)};return ne.useEffect(()=>{var d,s,i;(d=t==null?void 0:t.data)!=null&&d.data&&o((i=(s=t==null?void 0:t.data)==null?void 0:s.data)!=null&&i.is_water_harvesting?[{id:1,title:"Front Image",directionType:"Front"},{id:2,title:"Left Image",directionType:"Left"},{id:3,title:"Right Image",directionType:"Right"},{id:4,title:"Rain Water Harvesting Image",directionType:"waterHarvesting",isRainWaterHarvesting:!0}]:[{id:1,title:"Front Image",directionType:"Front"},{id:2,title:"Left Image",directionType:"Left"},{id:3,title:"Right Image",directionType:"Right"}])},[(R=(P=t==null?void 0:t.data)==null?void 0:P.data)==null?void 0:R.saf_no]),b.useEffect(()=>{h({submitCount:v,isSubmitting:w,errors:F,isValid:Z})},[F,v,w]),Y?X?e.jsxs(ue,{title:"Geo Tagging",children:[u.isLoading&&e.jsx(he,{}),e.jsxs("div",{className:"p-4 ",children:[e.jsx(f.Card,{className:"w-full",children:e.jsxs(f.CardBody,{children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h1",{className:"font-semibold",children:"Geo Tagging"})}),e.jsx("div",{className:"border-b-2 border-gray-300 w-full py-1"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[e.jsx("h1",{className:"font-semibold text-sm",children:"Application No : "}),e.jsx("h1",{className:"text-sm",children:(A=(I=t==null?void 0:t.data)==null?void 0:I.data)==null?void 0:A.saf_no}),e.jsx("h1",{className:"font-semibold text-sm",children:"Application Type : "}),e.jsx("h1",{className:"text-sm",children:($=(L=t==null?void 0:t.data)==null?void 0:L.data)==null?void 0:$.assessment_type}),e.jsx("h1",{className:"font-semibold text-sm",children:"Apply Date : "}),e.jsx("h1",{className:"text-sm",children:(G=(E=t==null?void 0:t.data)==null?void 0:E.data)==null?void 0:G.application_date}),e.jsx("h1",{className:"font-semibold text-sm",children:"Owner Name : "}),e.jsx("h1",{className:"text-sm",children:(S=(C=t==null?void 0:t.data)==null?void 0:C.data)==null?void 0:S.applicant_name}),e.jsx("h1",{className:"font-semibold text-sm",children:"Mobile No : "}),e.jsx("h1",{className:"text-sm",children:(q=(_=t==null?void 0:t.data)==null?void 0:_.data)==null?void 0:q.mobile_no})]})]})}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs(ge,{formik:a,children:[e.jsx(ce,{name:"geoTagged",children:d=>c.map((s,i)=>{var m,l,g,r,n,O,V,M,U,z,B,H;return e.jsxs(b.Fragment,{children:[e.jsxs(f.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-base font-semibold text-gray-100",children:s==null?void 0:s.title})}),e.jsxs(f.CardBody,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 items-center",children:[e.jsx("h1",{className:"font-semibold text-sm",children:"Latitude : "}),e.jsx(K,{disabled:!0,type:"text",isDynamic:!0,name:"geoTagged.".concat(i,".latitude"),formik:a}),e.jsxs("h1",{className:"font-semibold text-sm",children:["Longitude :"," "]}),e.jsx(K,{disabled:!0,type:"text",isDynamic:!0,name:"geoTagged.".concat(i,".longitude"),formik:a})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 mt-4",children:[e.jsx("div",{children:((l=(m=a==null?void 0:a.values)==null?void 0:m.geoTagged[i])==null?void 0:l.imagePath)&&e.jsx("img",{className:"w-full h-64",src:(r=(g=a==null?void 0:a.values)==null?void 0:g.geoTagged[i])!=null&&r.imagePath?URL.createObjectURL((O=(n=a==null?void 0:a.values)==null?void 0:n.geoTagged[i])==null?void 0:O.imagePath):null,alt:(U=(M=(V=a==null?void 0:a.values)==null?void 0:V.geoTagged[i])==null?void 0:M.imagePath)==null?void 0:U.name})}),e.jsxs("div",{children:[e.jsx("input",{type:"file",name:"imagePath",accept:"image/*",onChange:k=>D(k,i,s)}),e.jsx("span",{className:"text-sm text-red-500",children:(H=(B=(z=a==null?void 0:a.errors)==null?void 0:z.geoTagged)==null?void 0:B[i])==null?void 0:H.imagePath})]})]})]})]}),e.jsx("div",{className:"my-4 border-b-2"})]},i)})}),e.jsx("div",{className:"grid grid-cols-1 gap-3 mt-4",children:e.jsx(me,{name:"comment",formik:a,label:"Comment: "})}),e.jsx("div",{className:"flex justify-center items-center mt-4",children:e.jsx("button",{type:"submit",className:"bg-blue-600 px-4 py-2 rounded-lg text-white",children:"Forward"})})]})]})]}):e.jsx("div",{className:" p-16 flex text-center text-red-500 font-semibold h-screen justify-center items-center",children:"Geolocation is not enabled! Please enable to use this app"}):e.jsx("div",{className:"p-16 flex text-center text-red-500 font-semibold h-screen justify-center items-center",children:"Your browser does not support Geolocation"})}export{Ie as default};
