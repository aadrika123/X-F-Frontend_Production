import{d as fe,c as me,p as f,w as ye,S as pe,Q as d,j as e,I as we}from"./index-nTD-ItDx.js";import{d as I,u as be,e as Ne}from"./router-vn-0iGwJ.js";import{u as Ce}from"./formik.esm-ilDmhU_v.js";import{c as Ie,d as xe,a as Me}from"./index.esm-19LW8OGO.js";import{F as ve}from"./FormProvider-22m3QvO4.js";import{T as Pe}from"./TextAreaField-W_3fAECp.js";import"./index-9INnh4Fj.js";import{r as h}from"./tailwind-umh7vczy.js";import{P as Se}from"./index-fOi6iZgB.js";import{r as Fe}from"./resizeImage-r9m895oW.js";import{O as Le}from"./OverLayLoader-9zRfM8R-.js";import{M as Ae}from"./MyPDFViewer-BBt-sAHT.js";import"./reactQuery-VYMV1vFj.js";import"./axios-lPgvryBG.js";import"./reactIcons-lANGEfNm.js";import"./headlessui-pLs_kC1m.js";import"./customInputValidation-8tSUGdUh.js";import"./module-VoyHJF_3.js";/* empty css              */import"./reactPdfViewerCore-t_0I17fT.js";import"./reactPdfViewerDefaultLayout-S9Yj6FAR.js";function De(){var S,F,L,A,B,R,T,_,k,z,K,O,U,V,q,Y,$,E,W,Q,G,H,J,X,Z,D,ee,ae,te,se,ie,oe,re;const[w,M]=I.useState(""),b=be(),g=fe({}),[N,v]=I.useState(""),[ue,P]=I.useState(""),{id:u}=Ne(),a=me({api:f.staticSafDetail,config:{applicationId:u},value:[u],options:{enabled:!!u}}),C=me({api:(S=ye)==null?void 0:S.workFlowInfo,config:{workflowId:(L=(F=a==null?void 0:a.data)==null?void 0:F.data)==null?void 0:L.workflow_id},value:[(B=(A=a==null?void 0:a.data)==null?void 0:A.data)==null?void 0:B.workflow_id],options:{enabled:!!((T=(R=a==null?void 0:a.data)==null?void 0:R.data)!=null&&T.workflow_id)}}),o=Ce({initialValues:{uploadMeasurement:"",comment:""},validationSchema:Ie({uploadMeasurement:((k=(_=a==null?void 0:a.data)==null?void 0:_.data)==null?void 0:k.applied_by)=="TC"||((K=(z=a==null?void 0:a.data)==null?void 0:z.data)==null?void 0:K.applied_by)=="TC Reassesment"?xe().notRequired():xe().required("Measurement Sheet is required").test("fileSize","Max 10 mb file size",t=>(t==null?void 0:t.size)<=1e7),comment:Me().label("Comment").min(2).max(500)}),onSubmit:async t=>{pe.fire({title:"Are you sure?",text:"\n       You are going to forward the application to the ".concat(w==="LIPIK"?"Lipik":"Nagar Rachna"),icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(i=>{i.isConfirmed&&he(t)}).catch(i=>{var n,c;console.log(i),d.error((c=(n=i==null?void 0:i.response)==null?void 0:n.data)==null?void 0:c.message)})}}),he=async t=>{var i,n,c,x,l,s,j,y,ne,ce,de,le;if(((n=(i=a==null?void 0:a.data)==null?void 0:i.data)==null?void 0:n.applied_by)=="TC")try{const r=await g.mutateAsync({api:f.safLevelV2,data:{applicationId:u,receiverRoleId:w==="LIPIK"?"6":"7",action:"forward",comment:(t==null?void 0:t.comment)||"OK"}});(c=r==null?void 0:r.data)!=null&&c.status?(d.success((x=r==null?void 0:r.data)==null?void 0:x.message),b("/amc-app/property/saf-verification-list",{replace:!0})):d.error((l=r==null?void 0:r.data)==null?void 0:l.message)}catch(r){d.error((s=r==null?void 0:r.data)==null?void 0:s.message)}else{const r=new FormData;r.append("applicationId",u),r.append("document",t==null?void 0:t.uploadMeasurement);try{const m=await g.mutateAsync({api:f.uploadMeasurementSheetApi,data:r});if((j=m==null?void 0:m.data)!=null&&j.status){const p=await g.mutateAsync({api:f.safLevelV2,data:{applicationId:u,receiverRoleId:w==="LIPIK"?"6":"7",action:"forward",comment:(t==null?void 0:t.comment)||"OK"}});(y=p==null?void 0:p.data)!=null&&y.status?(d.success((ne=p==null?void 0:p.data)==null?void 0:ne.message),b("/amc-app/property/saf-verification-list",{replace:!0})):d.error((ce=p==null?void 0:p.data)==null?void 0:ce.message)}else d.error((de=m==null?void 0:m.data)==null?void 0:de.message)}catch(m){d.error((le=m==null?void 0:m.data)==null?void 0:le.message)}}},ge=async()=>{var t;if(((t=o==null?void 0:o.values)==null?void 0:t.comment)=="")return d.error("Comment is required !");pe.fire({title:"Are you sure?",text:"You are going to backward of this application",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(async i=>{var n,c,x,l;if(i.isConfirmed)try{const s=await g.mutateAsync({api:f.safLevel,data:{applicationId:u,receiverRoleId1:"",action:"backward",comment:((n=o==null?void 0:o.values)==null?void 0:n.comment)||"No Comment"}});(c=s==null?void 0:s.data)!=null&&c.status?(d.success((x=s==null?void 0:s.data)==null?void 0:x.message),b("/amc-app/property/saf-verification-list",{replace:!0})):d.error(((l=s==null?void 0:s.data)==null?void 0:l.message)||"Something went wrong, Please try again")}catch(s){d.error(s==null?void 0:s.message),console.log(s)}}).catch(i=>{var n,c;d.error((c=(n=i==null?void 0:i.response)==null?void 0:n.data)==null?void 0:c.message)})},je=async t=>{var n,c,x;const i=t.target.files[0];if((i==null?void 0:i.type)==="application/pdf"){const l=new FileReader;l.onload=s=>{v(s.target.result),P(i.name.split(".").pop())},l.readAsDataURL(i),o.setFieldValue("uploadMeasurement",i)}else{const l=await Fe((n=t==null?void 0:t.target)==null?void 0:n.files[0]),s=new File([l],(x=(c=t==null?void 0:t.target)==null?void 0:c.files[0])==null?void 0:x.name,{type:"image/*"}),j=new FileReader;j.onload=y=>{v(y.target.result),P(s.name.split(".").pop())},j.readAsDataURL(s),o.setFieldValue("uploadMeasurement",s)}};return a!=null&&a.isLoading?e.jsx(we,{}):e.jsxs(Se,{title:"Measurement",children:[g.isLoading&&e.jsx(Le,{}),e.jsx(ve,{formik:o,children:e.jsxs("div",{className:"p-4 ",children:[e.jsx(h.Card,{className:"w-full",children:e.jsxs(h.CardBody,{children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h1",{className:"font-semibold",children:"Measurement Sheet"})}),e.jsx("div",{className:"border-b-2 border-gray-300 w-full py-1"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[e.jsx("h1",{className:"font-semibold text-sm",children:"Application No : "}),e.jsx("h1",{className:"text-sm",children:(U=(O=a==null?void 0:a.data)==null?void 0:O.data)==null?void 0:U.saf_no}),e.jsx("h1",{className:"font-semibold text-sm",children:"Application Type : "}),e.jsx("h1",{className:"text-sm",children:(q=(V=a==null?void 0:a.data)==null?void 0:V.data)==null?void 0:q.assessment_type}),e.jsx("h1",{className:"font-semibold text-sm",children:"Apply Date : "}),e.jsx("h1",{className:"text-sm",children:($=(Y=a==null?void 0:a.data)==null?void 0:Y.data)==null?void 0:$.application_date}),e.jsx("h1",{className:"font-semibold text-sm",children:"Owner Name : "}),e.jsx("h1",{className:"text-sm",children:(W=(E=a==null?void 0:a.data)==null?void 0:E.data)==null?void 0:W.applicant_name}),e.jsx("h1",{className:"font-semibold text-sm",children:"Mobile No : "}),e.jsx("h1",{className:"text-sm w-40 truncate",children:(J=(H=(G=(Q=a==null?void 0:a.data)==null?void 0:Q.data)==null?void 0:G.owners)==null?void 0:H.map(t=>t==null?void 0:t.mobile_no))==null?void 0:J.join(", ")})]})]})}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs(h.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-base font-semibold text-gray-100",children:"Upload Measurement Sheet"})}),N&&(ue==="pdf"?e.jsx(Ae,{fileUrl:N}):e.jsx("div",{className:"flex justify-center px-4 py-2",children:e.jsx("img",{src:N,alt:"preview",loading:"lazy"})})),e.jsx(h.CardBody,{children:e.jsxs("div",{className:"grid grid-cols-1 justify-center gap-5",children:[((Z=(X=a==null?void 0:a.data)==null?void 0:X.data)==null?void 0:Z.applied_by)!="TC"&&((ee=(D=a==null?void 0:a.data)==null?void 0:D.data)==null?void 0:ee.applied_by)!="TC Reassesment"&&e.jsxs("div",{children:[e.jsx("div",{className:"mb-1",children:e.jsx("h1",{className:"font-semibold text-xs",children:"Upload Measurement Sheet"})}),e.jsx("input",{type:"file",accept:"application/pdf, image/*",name:"uploadMeasurement",onChange:je,className:"border border-gray-300 p-2 w-full rounded-lg"}),e.jsx("small",{className:"text-red-500",children:((ae=o==null?void 0:o.errors)==null?void 0:ae.uploadMeasurement)&&((te=o==null?void 0:o.touched)==null?void 0:te.uploadMeasurement)&&((se=o==null?void 0:o.errors)==null?void 0:se.uploadMeasurement)})]}),e.jsx("div",{children:e.jsx(Pe,{label:"Comment",name:"comment",formik:o,placeholder:"Comment"})})]})})]}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"justify-center items-center mt-4 gap-3",children:[e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(h.Button,{onClick:ge,size:"sm",className:"bg-red-500 text-white",children:e.jsx("small",{children:"Back To Back Office"})})}),((re=(oe=(ie=C==null?void 0:C.data)==null?void 0:ie.data)==null?void 0:oe.permissions)==null?void 0:re.can_forward)&&e.jsxs("div",{className:"flex justify-center items-center gap-2 mt-4",children:[e.jsx(h.Button,{type:"submit",onClick:()=>M("LIPIK"),size:"sm",className:"bg-blue-500 text-white",children:e.jsx("small",{children:"Send To Lipik "})}),e.jsx(h.Button,{type:"submit",size:"sm",onClick:()=>M("SR_LIPIK"),className:"bg-green-500 text-white",children:e.jsx("small",{children:"Send To Nagar Rachna"})})]})]})})]})})]})}export{De as default};
