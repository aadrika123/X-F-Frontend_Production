import{b as be,a as he,w as j,Q as b,j as e,f as Ne}from"./index-iuZ-7lxl.js";import{u as pe,h as ye,e as d}from"./react-rKuUt_as.js";import{u as ue}from"./formik.esm-GYaH6P80.js";import{c as ge,a as h,f as fe}from"./index.esm-ZNAGMSQQ.js";import{F as we}from"./FormProvider-EwYetELv.js";import{T as N}from"./TextField-FhwntCNA.js";import"./index-7JGA4NxA.js";import{P as Ce}from"./index-T4RTB032.js";import{r as ve}from"./resizeImage--9ExokEl.js";function Le(){var y,u,g,w,C,v,T,P,A,F,R,_,M,B,I,L,U,S,E,O,q,z,$,G,Y,k,D,V,Q,W,H,J,K,X,Z,ee,se,ae,te,de,le,re,ne,ie,ce;const p=pe(),f=be({}),{id:l}=ye(),a=he({api:j.waterGetDetails,config:{applicationId:l},value:[l],options:{enabled:!!l}}),t=he({api:j.waterListDemand,config:{ConsumerId:l},value:[l],options:{enabled:!!l}}),i=ue({enableReinitialize:!0,initialValues:{consumerId:l,demandUpto:new Date().toISOString().split("T")[0]||"",finalRading:"",document:"",connectionType:(g=(u=(y=t==null?void 0:t.data)==null?void 0:y.data)==null?void 0:u.meterDetails)==null?void 0:g.connection_type},validationSchema:ge().shape({demandUpto:h().required("Demand Upto is required"),connectionType:h().optional(),finalRading:h().when("connectionType",{is:s=>s==1,then:()=>h().required("Final Meter Reading is required")}),document:fe().when("connectionType",{is:s=>s==1,then:()=>fe().required("Document is required")})}),onSubmit:async(s,{resetForm:c})=>{var x,o,m,oe,me,xe;console.log(s);try{const r=new FormData;r.append("consumerId",s==null?void 0:s.consumerId),r.append("demandUpto",s==null?void 0:s.demandUpto),r.append("finalRading",s==null?void 0:s.finalRading),r.append("document",s==null?void 0:s.document);const n=await f.mutateAsync({api:(x=j)==null?void 0:x.generateDemandWater,data:r});(o=n==null?void 0:n.data)!=null&&o.status?(b.success((m=n==null?void 0:n.data)==null?void 0:m.message),t.refetch()):b.error((oe=n==null?void 0:n.data)==null?void 0:oe.message)}catch(r){b.error((xe=(me=r==null?void 0:r.response)==null?void 0:me.data)==null?void 0:xe.message)}c()}}),je=async s=>{var o,m;const c=await ve(s.target.files[0]),x=new File([c],(m=(o=s==null?void 0:s.target)==null?void 0:o.files[0])==null?void 0:m.name,{type:"image/*"});i.setFieldValue("document",x)};return a!=null&&a.isLoading||t!=null&&t.isLoading?e.jsx(Ne,{}):e.jsx(Ce,{title:"Consumer Details",children:e.jsxs("div",{className:"p-4",children:[e.jsx(d.Card,{children:e.jsxs(d.CardBody,{children:[e.jsx("div",{className:"flex flex-row justify-between mb-3",children:e.jsx("h1",{className:"text-base font-semibold",children:"# Basic Details"})}),e.jsx("div",{className:"my-3 border-b-2"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Applicant name:"}),e.jsx("h1",{className:"text-sm",children:(C=(w=a==null?void 0:a.data)==null?void 0:w.data)==null?void 0:C.applicant_name})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Property No:"}),e.jsx("h1",{className:"text-sm",children:(T=(v=a==null?void 0:a.data)==null?void 0:v.data)==null?void 0:T.folio_no})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Consumer No:"}),e.jsx("h1",{className:"text-sm",children:(A=(P=a==null?void 0:a.data)==null?void 0:P.data)==null?void 0:A.consumer_no})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Reading Date:"}),e.jsx("h1",{className:"text-sm",children:((R=(F=a==null?void 0:a.data)==null?void 0:F.data)==null?void 0:R.reading_date)||"--"})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Address:"}),e.jsx("h1",{className:"text-sm w-36 truncate",children:((M=(_=a==null?void 0:a.data)==null?void 0:_.data)==null?void 0:M.address)||"--"})]})]})]})}),e.jsxs(d.Card,{className:"w-full mt-5",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-base font-semibold text-gray-100",children:"# Meter/Fixed Connection Details"})}),e.jsx(d.CardBody,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Connection Type:"}),e.jsx("h1",{className:"text-sm",children:((L=(I=(B=t==null?void 0:t.data)==null?void 0:B.data)==null?void 0:I.meterDetails)==null?void 0:L.ConnectionTypeName)||"--"})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Meter No:"}),e.jsx("h1",{className:"text-sm",children:(E=(S=(U=a==null?void 0:a.data)==null?void 0:U.data)==null?void 0:S.meterDetails)==null?void 0:E.meter_no})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Last Meter Reading:"}),e.jsx("h1",{className:"text-sm",children:(q=(O=a==null?void 0:a.data)==null?void 0:O.data)==null?void 0:q.finalReading})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Reading Date:"}),e.jsx("h1",{className:"text-sm",children:(($=(z=a==null?void 0:a.data)==null?void 0:z.data)==null?void 0:$.readingdate)||"--"})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Connection Date:"}),e.jsx("h1",{className:"text-sm",children:((k=(Y=(G=a==null?void 0:a.data)==null?void 0:G.data)==null?void 0:Y.meterDetails)==null?void 0:k.connection_date)||"--"})]})]})})]}),e.jsxs(d.Card,{className:"mt-4 w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-base font-semibold text-gray-100",children:"Demand List"})}),e.jsx(d.CardBody,{children:e.jsx("div",{className:"relative overflow-x-auto  sm:rounded-lg",children:e.jsxs("table",{className:"w-full text-sm text-left  border-slate-400 border",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"# Sno."}),e.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"DEMAND FROM"}),e.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"DEMAND UPTO"}),e.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"DEMAND AMOUNT"}),e.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"PENALTY"}),e.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"CONNECTION TYPE"}),e.jsx("th",{className:"text-sm font-semibold p-4 border border-slate-300",children:"PAYABLE AMOUNT"})]})}),e.jsx("tbody",{children:(Q=(V=(D=t==null?void 0:t.data)==null?void 0:D.data)==null?void 0:V.consumerDemands)==null?void 0:Q.map((s,c)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-sm p-4 border border-slate-300",children:c+1}),e.jsx("td",{className:"text-sm p-4 border border-slate-300",children:s==null?void 0:s.demand_from}),e.jsx("td",{className:"text-sm p-4 border border-slate-300",children:s==null?void 0:s.demand_upto}),e.jsx("td",{className:"text-sm p-4 border border-slate-300",children:s==null?void 0:s.balance_amount}),e.jsx("td",{className:"text-sm p-4 border border-slate-300",children:s==null?void 0:s.penalty}),e.jsx("td",{className:"text-sm p-4 border border-slate-300",children:s==null?void 0:s.connection_type}),e.jsx("td",{className:"text-sm p-4 border border-slate-300",children:s==null?void 0:s.amount})]},c))})]})})})]}),e.jsx(we,{formik:i,children:e.jsxs(d.Card,{className:"mt-4 w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-base font-semibold text-gray-100",children:"Generate Demand"})}),e.jsx(d.CardBody,{children:e.jsxs("div",{className:"my-3",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[((J=(H=(W=t==null?void 0:t.data)==null?void 0:W.data)==null?void 0:H.meterDetails)==null?void 0:J.connection_type)==1&&e.jsxs(e.Fragment,{children:[e.jsx(N,{formik:i,name:"finalRading",type:"number",placeholder:"Final Meter Reading"}),e.jsxs("div",{children:[e.jsx(N,{accept:"image/*",name:"document",type:"file",onChange:s=>je(s)}),e.jsx("small",{className:"text-red-500 -mt-6",children:(K=i==null?void 0:i.errors)==null?void 0:K.document})]})]}),e.jsx(N,{disabled:!0,name:"demandUpto",type:"text",formik:i})]}),e.jsx("div",{className:"flex flex-row justify-center mt-2 gap-5",children:e.jsx(d.Button,{type:"submit",color:"blue",size:"sm",loading:f.isLoading,disabled:f.isLoading,children:e.jsx("small",{children:"Generate Demand"})})})]})})]})}),e.jsxs(d.Card,{className:"w-full mt-4",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-base font-semibold text-gray-100",children:"Payment Details"})}),e.jsx(d.CardBody,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Total Dues:"}),e.jsxs("h1",{className:"text-sm",children:["â‚¹"," ",(Z=(X=t==null?void 0:t.data)==null?void 0:X.data)==null?void 0:Z.totalSumDemand]})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Due From:"}),e.jsx("h1",{className:"text-sm",children:(se=(ee=a==null?void 0:a.data)==null?void 0:ee.data)==null?void 0:se.demand_from})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Due Upto:"}),e.jsx("h1",{className:"text-sm",children:(te=(ae=a==null?void 0:a.data)==null?void 0:ae.data)==null?void 0:te.demand_upto})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Total Due Demand:"}),e.jsx("h1",{className:"text-sm",children:((le=(de=a==null?void 0:a.data)==null?void 0:de.data)==null?void 0:le.cycle)||"--"})]}),e.jsxs("div",{className:"flex flex-row justify-between mb-3",children:[e.jsx("h1",{className:"text-sm font-semibold",children:"Total Payable Amount:"}),e.jsxs("h1",{className:"text-sm ",children:["â‚¹ ",((ne=(re=t==null?void 0:t.data)==null?void 0:re.data)==null?void 0:ne.totalSumDemand)||"0"]})]}),e.jsx("div",{className:"my-3 border-b-2"}),e.jsxs("div",{className:"flex flex-row justify-center gap-5",children:[((ce=(ie=t==null?void 0:t.data)==null?void 0:ie.data)==null?void 0:ce.totalSumDemand)>0&&e.jsx(d.Button,{color:"blue",size:"sm",onClick:()=>p("/amc-app/water/water-payment/".concat(l)),children:e.jsx("small",{children:"Pay Demand"})}),e.jsx(d.Button,{color:"red",size:"sm",onClick:()=>p("/amc-app/water/demand-receipt/".concat(l)),children:e.jsx("small",{children:"Print Demand"})})]})]})})]})]})})}export{Le as default};
