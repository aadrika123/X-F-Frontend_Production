import{g as F,j as t,h as V,e as S,f as P,Q as d,R as E,a as D}from"./index-26-p7w-4.js";import{u as y}from"./formik.esm-gFKTrVOh.js";import{c as T,a as j,b as $}from"./index.esm-n36fjmXy.js";import{F as N}from"./FormProvider-GwJgoio4.js";import{T as R}from"./TextField-zZnWSXtK.js";import{L as O}from"./LoaderButton-2dw08xaf.js";import"./index-Z8Y5rR5v.js";import{u as C,P as A}from"./useCountDown-QO_IN_o2.js";const k=[{id:0,label:"Mobile"},{id:1,label:"Email"}];function z(){const{state:m,actions:n}=F({updateAction:V});return t.jsx("div",{className:"w-full",children:t.jsx("div",{className:"relative right-0",children:t.jsx("ul",{className:"relative flex flex-wrap p-1 list-none rounded-lg bg-blue-gray-50/60","data-tabs":"tabs",role:"list",children:k.map(u=>t.jsx("li",{className:"z-30 flex-auto text-center",onClick:()=>n.updateAction({loginTabs:u.id}),children:t.jsx("a",{className:"z-30 flex items-center justify-center w-full px-0 py-1 mb-0 transition-all ease-in-out border-0 rounded-lg cursor-pointer text-slate-700 bg-inherit ".concat(m.loginTabs===u.id?"border-b-2 border-blue-500 text-blue-500":""),"data-tab-target":"",role:"tab","aria-selected":"true",children:t.jsx("span",{className:"ml-1",children:u.label})})},u.id))})})})}const M=T().shape({mobile:j().required("Mobile is required").min(10).max(10)});function B({next:m,data:n,setData:u}){const{mutateAsync:h}=S({}),i=y({enableReinitialize:!0,initialValues:{mobile:n.mobile||""},validationSchema:M,onSubmit:async(l,{})=>{var x,a,b;try{const e=await h({api:P.forgotPassword,data:{mobile:l.mobile}});(x=e==null?void 0:e.data)!=null&&x.status?(m({...n,mobile:l.mobile}),d.success((a=e==null?void 0:e.data)==null?void 0:a.message)):d.error((b=e==null?void 0:e.data)==null?void 0:b.message)}catch(e){d.error(e==null?void 0:e.message)}}});return t.jsxs(N,{formik:i,children:[t.jsx("h2",{className:" font-semibold mt-8 mb-4",children:"Send OTP"}),t.jsx(R,{label:"Mobile",name:"mobile",type:"number",formik:i,placeholder:"Enter your register mobile no"}),t.jsx(O,{type:i.isSubmitting?"button":"submit",disabled:i.isSubmitting,loading:i.isSubmitting,children:"SEND OTP"})]})}const L=T().shape({otp:j().required("OTP is required")});function Q({next:m,data:n,setData:u,prev:h,state:i}){const{minutes:l,seconds:x,togglerTimer:a,runTimer:b}=C(.5),{mutateAsync:e,isLoading:f}=S({}),s=y({enableReinitialize:!0,initialValues:{mobile:n.mobile||"",email:n.email||"",otp:n.otp||""},validationSchema:L,onSubmit:async(g,{})=>{var p,w,o,q,v;try{const r=await e({api:P.otpVerify,data:(i==null?void 0:i.loginTabs)==0?{mobile:g.mobile,Otp:g==null?void 0:g.otp}:{email:g.email,Otp:g==null?void 0:g.otp}});(p=r==null?void 0:r.data)!=null&&p.status?(m({...n,otp:g.otp,token:(o=(w=r==null?void 0:r.data)==null?void 0:w.data)==null?void 0:o.token}),d.success((q=r==null?void 0:r.data)==null?void 0:q.message)):d.error((v=r==null?void 0:r.data)==null?void 0:v.message)}catch(r){d.error(r==null?void 0:r.message)}}});E.useEffect(()=>(a(),()=>{a()}),[]);const c=async()=>{var g,p,w;try{const o=await e({api:P.forgotPassword,data:(i==null?void 0:i.loginTabs)==0?{mobile:n.mobile}:{email:n.email}});(g=o==null?void 0:o.data)!=null&&g.status?(d.success((p=o==null?void 0:o.data)==null?void 0:p.message),u({...n,otp:""}),s.setFieldValue("otp",""),a()):d.error((w=o==null?void 0:o.data)==null?void 0:w.message)}catch(o){d.error(o==null?void 0:o.message)}};return t.jsxs(N,{formik:s,children:[t.jsxs("h1",{className:"text-sm mt-8 mb-4",children:["Please enter the 6-digit verification code sent to"," ",i.loginTabs==0?" your phone number":"your email-:  ",i.loginTabs==0?"+"+(s==null?void 0:s.values.mobile):s==null?void 0:s.values.email," ",t.jsx("span",{className:"text-sm text-blue-700",onClick:()=>h(i.loginTabs==0?{mobile:s==null?void 0:s.values.mobile,otp:""}:{email:s==null?void 0:s.values.email,otp:""}),children:"Edit"})]}),t.jsx(R,{label:"Verify OTP",name:"otp",type:"text",formik:s}),t.jsx(O,{type:s.isSubmitting?"button":"submit",disabled:s.isSubmitting,loading:s.isSubmitting,children:"Verify OTP"}),t.jsxs("div",{className:"text-center mt-12 text-sm",children:["Didn't receive the code?"," ",f?t.jsx("small",{className:"text-gray-700 text-sm",children:"Please wait..."}):t.jsx(t.Fragment,{children:b?t.jsxs("span",{className:"text-gray-700 cursor-pointer",children:["Resend in ",l,":",x]}):t.jsx("span",{className:"text-blue-700 cursor-pointer",onClick:c,children:"Resend OTP"})})]})]})}const W=T().shape({newPassword:j().required("New Password is required"),confirmPassword:j().required("Confirm Password is required").oneOf([$("newPassword"),null],"Passwords must match")});function _({next:m,data:n,setData:u,prev:h,state:i}){C(5);const l=D(),{mutateAsync:x}=S({}),a=y({enableReinitialize:!0,initialValues:{newPassword:"",confirmPassword:""},validationSchema:W,onSubmit:async(b,{})=>{var e,f,s;try{const c=await x({api:P.resetPassword,data:{token:n==null?void 0:n.token,password:b.newPassword}});(e=c==null?void 0:c.data)!=null&&e.status?(m(b,!0),d.success((f=c==null?void 0:c.data)==null?void 0:f.message),l("/auth/login")):d.error((s=c==null?void 0:c.data)==null?void 0:s.message)}catch(c){d.error(c==null?void 0:c.message)}}});return t.jsxs(N,{formik:a,children:[t.jsx("h1",{className:"text-lg mt-5 mb-4 font-semibold",children:"Create New Password"}),t.jsx(A,{label:"New Password",name:"newPassword",formik:a}),t.jsx(A,{label:"Confirm Password",name:"confirmPassword",formik:a}),t.jsx(O,{type:a.isSubmitting?"button":"submit",disabled:a.isSubmitting,loading:a.isSubmitting,children:"RESET PASSWORD"})]})}const G=T().shape({email:j().required("Email is required").email()});function H({next:m,data:n,setData:u}){const{mutateAsync:h}=S({}),i=y({enableReinitialize:!0,initialValues:{email:n.email||""},validationSchema:G,onSubmit:async(l,{})=>{var x,a,b;try{const e=await h({api:P.forgotPassword,data:{email:l.email}});(x=e==null?void 0:e.data)!=null&&x.status?(m({...n,email:l.email}),d.success((a=e==null?void 0:e.data)==null?void 0:a.message)):d.error((b=e==null?void 0:e.data)==null?void 0:b.message)}catch(e){d.error(e==null?void 0:e.message)}}});return t.jsxs(N,{formik:i,children:[t.jsx("h2",{className:" font-semibold mt-8 mb-4",children:"Send OTP"}),t.jsx(R,{label:"Email *",name:"email",type:"email",formik:i,placeholder:"Enter your register email id"}),t.jsx(O,{type:i.isSubmitting?"button":"submit",disabled:i.isSubmitting,loading:i.isSubmitting,children:"SEND OTP"})]})}function te(){const{state:m,actions:n}=F({updateAction:V}),[u,h]=E.useState(0),[i,l]=E.useState({mobile:"",email:"",otp:"",newPassword:"",confirmPassword:"",token:""}),x=e=>{console.log(e)},a=(e,f=!1)=>{if(l({...i,...e}),f){x(e);return}h(u+1)},b=e=>{l({...i,...e}),h(u-1)};return t.jsxs(t.Fragment,{children:[u===0&&t.jsx(z,{}),t.jsx("div",{children:{0:m.loginTabs==0?t.jsx(B,{state:m,next:a,data:i,setData:l}):t.jsx(H,{state:m,next:a,data:i,setData:l}),1:t.jsx(Q,{state:m,next:a,prev:b,data:i,setData:l}),2:t.jsx(_,{state:m,next:a,prev:b,data:i,setData:l})}[u]})]})}export{te as default};
