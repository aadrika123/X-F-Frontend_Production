import{j as e,b as Te,a as Ae,p as N,g as qe,S as Se,Q as d,f as Le}from"./index--OGVRpB5.js";import{d as w,h as Re,u as Ee,r as $e}from"./router-g9NwwHut.js";import{r as o}from"./tailwind-xMhOhnt0.js";import{u as De}from"./formik.esm-MEJnthxH.js";import{c as Ye,a as Oe,g as Ie}from"./index.esm-lGQm42K_.js";import{F as Ue}from"./FormProvider-c2SyZ-sg.js";import{T as We}from"./TextField-54OclycZ.js";import{R as He}from"./RadioButton-qrZPgMLb.js";import{T as Ke}from"./TextAreaField-DzQGAb-D.js";import"./index-KJUlVKah.js";import{P as Qe}from"./index-WG2BbsAP.js";import{O as Ze}from"./OverLayLoader-_3Ux0HCl.js";import{M as k}from"./MyPDFViewer-uIVhWGmj.js";import"./reactQuery-Q7rJjNxq.js";import"./reactQueryDevtools-6dm9iask.js";import"./axios-hq-Xw8mW.js";import"./reactIcons-TqjzQo_g.js";import"./headlessui-QgKi6LbN.js";import"./customInputValidation-8tSUGdUh.js";import"./module-zKBWpAy4.js";import"./reactPdfViewerCore-9ACLRJuU.js";import"./reactPdfViewerDefaultLayout-kL0TZy5g.js";function Me({open:x,setOpen:_,url:f,ext:b,title:y}){const p=()=>_(!x);return e.jsxs(e.Fragment,{children:[x&&e.jsx("div",{onClick:p,className:"bg-gray-900/50 dark:bg-gray-900/80 fixed inset-0 z-40"}),e.jsx("div",{id:"authentication-modal",tabIndex:-1,"aria-hidden":"true",className:"".concat(x?"flex":"hidden"," overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full"),children:e.jsx("div",{className:"relative p-4 w-full max-w-md max-h-full ",children:e.jsxs("div",{className:"relative bg-white rounded-lg shadow dark:bg-gray-700 h-[500px]",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 md:p-5 border-b rounded-t dark:border-gray-600",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 dark:text-white",children:y}),e.jsxs("button",{onClick:p,type:"button",className:"end-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white","data-modal-hide":"authentication-modal",children:[e.jsx("svg",{className:"w-3 h-3","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 14 14",children:e.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"})}),e.jsx("span",{className:"sr-only",children:"Close modal"})]})]}),b==="pdf"?e.jsx(k,{fileUrl:f}):e.jsx("img",{src:f,alt:"Naksha",className:"w-full h-full",loading:"lazy"}),e.jsx("div",{className:"p-4 md:p-5",children:e.jsx("div",{className:"flex items-center justify-end mt-4 gap-5",children:e.jsx(o.Button,{type:"button",size:"sm",variant:"text",color:"red",onClick:p,className:"mr-1 bg-gray-300",children:e.jsx("span",{children:"Ok"})})})})]})})})]})}const Ge=[{label:"Yes",value:"yes"},{label:"No",value:"no"}];function vs(){var C,P,A,S,O,I,M,V,z,F,T,q,L,R,E,$,D,Y,U,W,H,K,Q,Z,G,J,X,ee,se,te,ae,re,ie,ne,le,ce,oe,de,me,xe,he,ue,pe,je,ge,fe,ye,Ne,be,ve,we,ke,_e,Be;const x=Te({}),[_,f]=w.useState(""),[b,y]=w.useState(!1),[p,B]=w.useState(!1),{id:h}=Re(),v=Ee(),{data:s,refetch:Je,error:Xe,isLoading:Ve}=Ae({api:N.getUploadDocNaksha,config:{applicationId:h},value:[h],options:{enabled:!!h}}),u=Ae({api:(C=qe)==null?void 0:C.workFlowInfo,config:{workflowId:(P=s==null?void 0:s.data)==null?void 0:P.workflow_id},value:[(A=s==null?void 0:s.data)==null?void 0:A.workflow_id],options:{enabled:!!((S=s==null?void 0:s.data)!=null&&S.workflow_id)}}),t=De({enableReinitialize:!0,initialValues:{areaOfPlot:"",isNaksha:(O=s==null?void 0:s.data)!=null&&O.naksha?"":"no",comment:"",message:""},validationSchema:Ye({isNaksha:Oe().required("Required"),comment:Oe().required("Required").max(500,"Max 500 characters"),areaOfPlot:Ie().when("isNaksha",{is:"yes",then:()=>Ie().required("Required")})}),onSubmit:async a=>{Se.fire({title:"Are you sure?",text:"You are going to verify naksha of this property ",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(r=>{r.isConfirmed&&ze(a)}).catch(r=>{var n,l;d.error((l=(n=r==null?void 0:r.response)==null?void 0:n.data)==null?void 0:l.message)})}}),ze=async a=>{var n,l,j,g,i,Ce,Pe;const r={applicationId:h,IsDouble:a.isNaksha==="no",areaOfPlot:a.areaOfPlot};try{const c=await x.mutateAsync({api:N.nakshaVerify,data:r});if((n=c==null?void 0:c.data)!=null&&n.status){f((l=c==null?void 0:c.data)==null?void 0:l.message);const m=await x.mutateAsync({api:N.safLevel,data:{applicationId:h,action:"forward",comment:"Ok"}});(j=m==null?void 0:m.data)!=null&&j.status?(v("/amc-app/property/saf-verification-list",{replace:!0}),d.success((g=m==null?void 0:m.data)==null?void 0:g.message)):d.error((i=m==null?void 0:m.data)==null?void 0:i.message)}else d.error((Ce=c==null?void 0:c.data)==null?void 0:Ce.message)}catch(c){d.error(((Pe=c==null?void 0:c.data)==null?void 0:Pe.message)||"Something went wrong !")}},Fe=async()=>{var a;if(((a=t==null?void 0:t.values)==null?void 0:a.comment)=="")return d.error("Comment is required !");Se.fire({title:"Are you sure?",text:"You are going to back this application to Agency Engineer",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, Proceed!",cancelButtonText:"No, cancel!",reverseButtons:!0}).then(async r=>{var n,l,j,g;if(r.isConfirmed)try{const i=await x.mutateAsync({api:N.safLevel,data:{applicationId:h,receiverRoleId1:"",action:"backward",comment:((n=t==null?void 0:t.values)==null?void 0:n.comment)||"No Comment"}});(l=i==null?void 0:i.data)!=null&&l.status?(d.success((j=i==null?void 0:i.data)==null?void 0:j.message),v("/amc-app/property/saf-verification-list",{replace:!0})):d.error(((g=i==null?void 0:i.data)==null?void 0:g.message)||"Something went wrong, Please try again")}catch(i){d.error(i==null?void 0:i.message)}}).catch(r=>{var n,l;d.error((l=(n=r==null?void 0:r.response)==null?void 0:n.data)==null?void 0:l.message)})};return $e.useEffect(()=>{var a;((a=t==null?void 0:t.values)==null?void 0:a.isNaksha)=="no"&&(t.setFieldValue("areaOfPlot",""),t.setFieldValue("message",""))},[(I=t==null?void 0:t.values)==null?void 0:I.isNaksha]),Ve?e.jsx(Le,{}):e.jsxs(e.Fragment,{children:[x.isLoading&&e.jsx(Ze,{}),e.jsxs(Qe,{title:"Naksha Verification",children:[e.jsx(Me,{open:b,setOpen:y,url:(V=(M=s==null?void 0:s.data)==null?void 0:M.naksha)==null?void 0:V.doc_path,ext:(F=(z=s==null?void 0:s.data)==null?void 0:z.naksha)==null?void 0:F.ext,title:"Sanction Plan"}),e.jsx(Me,{open:p,setOpen:B,url:(q=(T=s==null?void 0:s.data)==null?void 0:T.measurement_sheet)==null?void 0:q.doc_path,ext:(R=(L=s==null?void 0:s.data)==null?void 0:L.measurement_sheet)==null?void 0:R.ext,title:"Measurement Sheet"}),e.jsxs("div",{className:"p-4",children:[e.jsxs(o.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-base font-semibold text-gray-100",children:"Basic Details"})}),e.jsx(o.CardBody,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 items-center",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-sm font-semibold text-gray-900",children:"Application No :"})}),e.jsx("div",{children:e.jsx("h1",{className:"text-sm  text-gray-900",children:(E=s==null?void 0:s.data)==null?void 0:E.saf_no})}),e.jsx("div",{children:e.jsx("h1",{className:"text-sm font-semibold text-gray-900",children:"Owner Name :"})}),e.jsx("div",{className:"text-sm  text-gray-900",children:($=s==null?void 0:s.data)==null?void 0:$.applicant_name}),e.jsx("div",{children:e.jsxs("h1",{className:"text-sm font-semibold text-gray-900",children:["Buildup Area (",e.jsx("small",{children:"In Sqft"}),") :"]})}),e.jsx("div",{className:"text-sm  text-gray-900",children:(D=s==null?void 0:s.data)==null?void 0:D.builtup_area}),e.jsx("div",{children:e.jsx("h1",{className:"text-sm font-semibold text-gray-900",children:"Zone :"})}),e.jsx("div",{className:"text-sm  text-gray-900",children:e.jsx("h1",{className:"text-sm  text-gray-900",children:(Y=s==null?void 0:s.data)==null?void 0:Y.zone})}),e.jsx("div",{children:e.jsx("h1",{className:"text-sm font-semibold text-gray-900",children:"Ward :"})}),e.jsx("div",{className:"text-sm  text-gray-900",children:e.jsx("h1",{className:"text-sm  text-gray-900",children:(U=s==null?void 0:s.data)==null?void 0:U.new_ward_no})}),e.jsx("div",{children:e.jsx("h1",{className:"text-sm font-semibold text-gray-900",children:"Property Type :"})}),e.jsx("div",{className:"text-sm  text-gray-900",children:e.jsx("h1",{className:"text-sm  text-gray-900",children:(W=s==null?void 0:s.data)==null?void 0:W.property_type})}),e.jsx("div",{children:e.jsx("h1",{className:"text-sm font-semibold text-gray-900",children:"Address :"})}),e.jsx("div",{className:"text-sm  text-gray-900",children:e.jsx("h1",{className:"text-sm  text-gray-900",children:(H=s==null?void 0:s.data)==null?void 0:H.prop_address})}),e.jsx("div",{children:e.jsx("h1",{className:"text-sm font-semibold text-gray-900",children:"Assessment Type :"})}),e.jsx("div",{className:"text-sm  text-gray-900",children:e.jsx("h1",{className:"text-sm  text-gray-900",children:(K=s==null?void 0:s.data)==null?void 0:K.assessment_type})}),e.jsx("div",{children:e.jsx("h1",{className:"text-sm font-semibold text-gray-900",children:"Application Date :"})}),e.jsx("div",{className:"text-sm  text-gray-900",children:e.jsx("h1",{className:"text-sm  text-gray-900",children:(Q=s==null?void 0:s.data)==null?void 0:Q.application_date})}),e.jsx("div",{className:"col-span-2 flex justify-center items-center mt-3",children:e.jsx(o.Button,{size:"sm",variant:"outlined",onClick:()=>v("/amc-app/property/saf-property-details/".concat(h)),children:e.jsx("span",{children:"View Saf Details"})})})]})})]}),e.jsx("div",{className:"border-b-2 border-gray-300 mt-3 mb-3"}),e.jsxs(o.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsxs("h1",{className:"text-base font-semibold text-gray-100",children:["Measurement Sheet"," "]})}),(Z=s==null?void 0:s.data)!=null&&Z.measurement_sheet?e.jsxs("div",{className:"grid grid-cols-1 gap-2 items-center",children:[((J=(G=s==null?void 0:s.data)==null?void 0:G.measurement_sheet)==null?void 0:J.ext)=="jpg"||((ee=(X=s==null?void 0:s.data)==null?void 0:X.measurement_sheet)==null?void 0:ee.ext)=="jpeg"||((te=(se=s==null?void 0:s.data)==null?void 0:se.measurement_sheet)==null?void 0:te.ext)=="png"?e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("img",{src:(re=(ae=s==null?void 0:s.data)==null?void 0:ae.measurement_sheet)==null?void 0:re.doc_path,alt:"measurement_sheet",loading:"lazy",width:500,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"w-full",children:e.jsx(k,{fileUrl:(ne=(ie=s==null?void 0:s.data)==null?void 0:ie.measurement_sheet)==null?void 0:ne.doc_path,toolbar:!1})}),e.jsx("div",{className:"flex justify-center items-center mb-5 mt-4",children:e.jsx(o.Button,{type:"button",size:"sm",color:"blue",className:"text-[11px]  h-8 justify-center items-center text-center flex",onClick:()=>B(!0),variant:"outlined",children:e.jsx("span",{children:"View Measurement"})})})]}):e.jsx("div",{className:"text-center py-5",children:e.jsx("h1",{className:"text-red-900 font-semibold text-sm",children:"Measurement Sheet not found!"})})]}),e.jsx("div",{className:"border-b-2 border-gray-300 mt-3 mb-3"}),e.jsxs(o.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-base font-semibold text-gray-100",children:"Sanction Plan"})}),e.jsx(o.CardBody,{children:(le=s==null?void 0:s.data)!=null&&le.naksha?e.jsxs("div",{className:"grid grid-cols-1 gap-2 items-center",children:[((oe=(ce=s==null?void 0:s.data)==null?void 0:ce.naksha)==null?void 0:oe.ext)=="jpg"||((me=(de=s==null?void 0:s.data)==null?void 0:de.naksha)==null?void 0:me.ext)=="jpeg"||((he=(xe=s==null?void 0:s.data)==null?void 0:xe.naksha)==null?void 0:he.ext)=="png"?e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("img",{src:(pe=(ue=s==null?void 0:s.data)==null?void 0:ue.naksha)==null?void 0:pe.doc_path,alt:"naksha",loading:"lazy",width:500,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"w-full",children:e.jsx(k,{fileUrl:(ge=(je=s==null?void 0:s.data)==null?void 0:je.naksha)==null?void 0:ge.doc_path})}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(o.Button,{type:"button",size:"sm",color:"blue",className:"text-[11px]  h-8 justify-center items-center text-center flex",onClick:()=>y(!0),variant:"outlined",children:e.jsx("span",{children:"View Sanction"})})})]}):e.jsx("div",{className:"text-center",children:e.jsx("h1",{className:"text-red-900 font-semibold text-sm",children:"Sanction Plan not found!"})})})]}),e.jsx("div",{className:"border-b-2 border-gray-300 mt-3 mb-4"}),((fe=t==null?void 0:t.values)==null?void 0:fe.isNaksha)=="no"&&e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("h1",{className:"text-sm font-semibold text-red-900 text-center mb-3 w-52",children:"Double taxation will be applied for this property !"})}),e.jsxs(Ue,{formik:t,children:[((ye=s==null?void 0:s.data)==null?void 0:ye.naksha)&&e.jsx("div",{className:"flex justify-center gap-4 items-center px-5 ",children:Ge.map(a=>e.jsx(He,{formik:t,name:"isNaksha",label:a.label,value:a.value},a.value))}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 items-center mt-4",children:[t.values.isNaksha==="yes"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-sm font-semibold text-gray-900"}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("h1",{className:"text-sm font-semibold text-red-900 text-center mb-3 w-52",children:(Ne=t==null?void 0:t.values)==null?void 0:Ne.message})})]}),e.jsx("div",{children:e.jsx(We,{label:"Constructed Area(In Sqft) :",type:"number",formik:t,name:"areaOfPlot",placeholder:"Constructed Area (In Sqft)",onBlur:()=>{var a,r,n,l;((a=t==null?void 0:t.values)==null?void 0:a.areaOfPlot)<((r=s==null?void 0:s.data)==null?void 0:r.builtup_area)?t.setFieldValue("message","100% Taxation will be applied on ".concat(((n=s==null?void 0:s.data)==null?void 0:n.builtup_area)-((l=t==null?void 0:t.values)==null?void 0:l.areaOfPlot)," sqft constructed area !")):t.setFieldValue("message","")}})})]}),e.jsx("div",{children:e.jsx(Ke,{label:"comment",formik:t,name:"comment",placeholder:"Comment"})})]}),e.jsxs("div",{className:"flex justify-center mt-4 gap-5",children:[((we=(ve=(be=u==null?void 0:u.data)==null?void 0:be.data)==null?void 0:ve.permissions)==null?void 0:we.can_backward)&&e.jsx(o.Button,{onClick:Fe,size:"sm",className:"bg-red-500 text-white",children:e.jsx("small",{children:"Back To Agency Engineer"})}),((Be=(_e=(ke=u==null?void 0:u.data)==null?void 0:ke.data)==null?void 0:_e.permissions)==null?void 0:Be.can_forward)&&e.jsx(o.Button,{type:"submit",size:"sm",className:"bg-blue-500 text-white",children:e.jsx("small",{children:"Forward"})})]})]})]})]})]})}export{vs as default};
