import{b as re,g as de,a as le,p as y,Q,j as e}from"./index-BmzyyeIl.js";import{R as u,u as oe,h as ne,r as ce,e as h}from"./react-kJeE4wWB.js";import{c as X,e as ge,a as x,f as me}from"./index.esm-APWbThjM.js";import{u as pe,F as ue}from"./formik.esm-u2hvNN2G.js";import{F as he}from"./FormProvider-tnvqnzZG.js";import{T as Y}from"./TextField-CYO3Rrh-.js";import{T as xe}from"./TextAreaField-Wg-ItzN0.js";import"./index-FYp6KAEl.js";import{P as je}from"./index-hx76H7S1.js";import{r as ye}from"./resizeImage-GKEmVBw3.js";import{u as be}from"./useErrorFocusFields-_FEl8je8.js";import{O as Te}from"./OverLayLoader-aCHSt9FP.js";import"./module-lhJH5toF.js";function _e(){var f,v,F,w,P,I,L,R,$,A,C,E,q,_;const{AutoFocusErrorField:Z}=be(),[p,D]=u.useState([]),k=oe(),j=re({}),[Ne,ee]=u.useState(null),{id:m}=ne(),{coords:g,isGeolocationEnabled:ae}=de(),s=le({api:y.staticSafDetail,config:{applicationId:m},value:[m],options:{enabled:!!m}}),a=pe({enableReinitialize:!0,initialValues:{comment:"",geoTagged:p==null?void 0:p.map(d=>({latitude:"",longitude:"",altitude:"",accuracy:"",imagePath:"",directionType:"",rainWaterHarvesting:""}))},validationSchema:X().shape({geoTagged:ge().of(X().shape({latitude:x().required("Latitude is required"),longitude:x().required("Longitude is required"),directionType:x().required("Direction is required"),imagePath:me().required("Image is required")})),comment:x().required().min(2).max(1e3).label("Comment")}),onSubmit:async d=>{var i,c,o,n;const r=new FormData;r.append("safId",m),d==null||d.geoTagged.forEach((t,l)=>{r.append("latitude[".concat(l,"]"),t==null?void 0:t.latitude),r.append("longitude[".concat(l,"]"),t==null?void 0:t.longitude),r.append("directionType[".concat(l,"]"),t==null?void 0:t.directionType),r.append("imagePath[".concat(l,"]"),t==null?void 0:t.imagePath)});try{const t=await j.mutateAsync({api:y.geoTagging,data:r});if((i=t==null?void 0:t.data)!=null&&i.status){const l=await j.mutateAsync({api:y.safLevel,data:{applicationId:m,receiverRoleId1:"",action:"forward",comment:d==null?void 0:d.comment}});Q.success((c=l==null?void 0:l.data)==null?void 0:c.message),k("/amc-app/property/saf-verification-list",{replace:!0})}}catch(t){Q.error((n=(o=t==null?void 0:t.response)==null?void 0:o.data)==null?void 0:n.message)}}}),{submitCount:b,isSubmitting:T,errors:N,isValid:te}=a,se=async(d,r,i)=>{var n,t;await((n=window==null?void 0:window.ReactNativeWebView)==null?void 0:n.postMessage(JSON.stringify({Key:"OPEN_CAMERA"})));const c=await ye(d.target.files[0]),o=new File([c],(t=d.target.files[0])==null?void 0:t.name,{type:"image/*"});a.setFieldValue("geoTagged.".concat(r,".latitude"),g==null?void 0:g.latitude),a.setFieldValue("geoTagged.".concat(r,".longitude"),g==null?void 0:g.longitude),a.setFieldValue("geoTagged.".concat(r,".directionType"),i==null?void 0:i.directionType),a.setFieldValue("geoTagged.".concat(r,".imagePath"),o),ee(o)};return ce.useEffect(()=>{var d,r,i;(d=s==null?void 0:s.data)!=null&&d.data&&D((i=(r=s==null?void 0:s.data)==null?void 0:r.data)!=null&&i.is_water_harvesting?[{id:1,title:"Front Image",directionType:"Front"},{id:2,title:"Left Image",directionType:"Left"},{id:3,title:"Right Image",directionType:"Right"},{id:4,title:"Rain Water Harvesting Image",directionType:"waterHarvesting",isRainWaterHarvesting:!0}]:[{id:1,title:"Front Image",directionType:"Front"},{id:2,title:"Left Image",directionType:"Left"},{id:3,title:"Right Image",directionType:"Right"}])},[(v=(f=s==null?void 0:s.data)==null?void 0:f.data)==null?void 0:v.saf_no]),u.useEffect(()=>{Z({submitCount:b,isSubmitting:T,errors:N,isValid:te})},[N,b,T]),ae||alert("Geolocation is not enabled! Please enable to use this app"),e.jsxs(je,{title:"Geo Tagging",children:[j.isLoading&&e.jsx(Te,{}),e.jsxs("div",{className:"p-4 ",children:[e.jsx(h.Card,{className:"w-full",children:e.jsxs(h.CardBody,{children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h1",{className:"font-semibold",children:"Geo Tagging"})}),e.jsx("div",{className:"border-b-2 border-gray-300 w-full py-1"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[e.jsx("h1",{className:"font-semibold text-sm",children:"Application No : "}),e.jsx("h1",{className:"text-sm",children:(w=(F=s==null?void 0:s.data)==null?void 0:F.data)==null?void 0:w.saf_no}),e.jsx("h1",{className:"font-semibold text-sm",children:"Application Type : "}),e.jsx("h1",{className:"text-sm",children:(I=(P=s==null?void 0:s.data)==null?void 0:P.data)==null?void 0:I.assessment_type}),e.jsx("h1",{className:"font-semibold text-sm",children:"Apply Date : "}),e.jsx("h1",{className:"text-sm",children:(R=(L=s==null?void 0:s.data)==null?void 0:L.data)==null?void 0:R.application_date}),e.jsx("h1",{className:"font-semibold text-sm",children:"Owner Name : "}),e.jsx("h1",{className:"text-sm",children:(A=($=s==null?void 0:s.data)==null?void 0:$.data)==null?void 0:A.applicant_name}),e.jsx("h1",{className:"font-semibold text-sm",children:"Mobile No : "}),e.jsx("h1",{className:"text-sm w-40 truncate",children:(_=(q=(E=(C=s==null?void 0:s.data)==null?void 0:C.data)==null?void 0:E.owners)==null?void 0:q.map(d=>d==null?void 0:d.mobile_no))==null?void 0:_.join(", ")})]})]})}),e.jsx("div",{className:"my-4 border-b-2"}),e.jsxs(he,{formik:a,children:[e.jsx(ue,{name:"geoTagged",children:d=>p.map((r,i)=>{var c,o,n,t,l,S,V,G,M,O,H,W,z,B,U,J,K;return e.jsxs(u.Fragment,{children:[e.jsxs(h.Card,{className:"w-full",children:[e.jsx("div",{className:"flex justify-between items-center px-5 bg-blue-gray-400 py-2 rounded-tl-lg rounded-tr-lg",children:e.jsx("h1",{className:"text-base font-semibold text-gray-100",children:r==null?void 0:r.title})}),e.jsxs(h.CardBody,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 items-center",children:[e.jsx("h1",{className:"font-semibold text-sm",children:"Latitude : "}),e.jsx(Y,{disabled:!0,type:"text",isDynamic:!0,name:"geoTagged.".concat(i,".latitude"),formik:a}),e.jsxs("h1",{className:"font-semibold text-sm",children:["Longitude :"," "]}),e.jsx(Y,{disabled:!0,type:"text",isDynamic:!0,name:"geoTagged.".concat(i,".longitude"),formik:a})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 mt-4",children:[e.jsx("div",{children:((o=(c=a==null?void 0:a.values)==null?void 0:c.geoTagged[i])==null?void 0:o.imagePath)&&e.jsx("img",{className:"w-full h-64",src:(t=(n=a==null?void 0:a.values)==null?void 0:n.geoTagged[i])!=null&&t.imagePath?URL.createObjectURL((S=(l=a==null?void 0:a.values)==null?void 0:l.geoTagged[i])==null?void 0:S.imagePath):null,alt:(M=(G=(V=a==null?void 0:a.values)==null?void 0:V.geoTagged[i])==null?void 0:G.imagePath)==null?void 0:M.name})}),e.jsxs("div",{children:[e.jsx("input",{type:"file",name:"imagePath",accept:"image/*",onChange:ie=>se(ie,i,r)}),e.jsx("span",{className:"text-sm text-red-500",children:(W=(H=(O=a==null?void 0:a.errors)==null?void 0:O.geoTagged)==null?void 0:H[i])==null?void 0:W.imagePath})]}),e.jsx("div",{children:e.jsx("h1",{className:"text-sm text-red-900",children:((B=(z=a==null?void 0:a.values)==null?void 0:z.geoTagged[i])==null?void 0:B.imagePath)&&Math.round(((K=(J=(U=a==null?void 0:a.values)==null?void 0:U.geoTagged[i])==null?void 0:J.imagePath)==null?void 0:K.size)/1024/1024*100)/100+"MB"})})]})]})]}),e.jsx("div",{className:"my-4 border-b-2"})]},i)})}),e.jsx("div",{className:"grid grid-cols-1 gap-3 mt-4",children:e.jsx(xe,{name:"comment",formik:a,label:"Comment: "})}),e.jsx("div",{className:"flex justify-center items-center mt-4",children:e.jsx("button",{type:"submit",className:"bg-blue-600 px-4 py-2 rounded-lg text-white",children:"Forward"})})]})]})]})}export{_e as default};
