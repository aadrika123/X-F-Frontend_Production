import{r as i,k as U,d as k,o as E,f as b,g as S,j as a,F as C,b as e,E as f}from"./index-aa793834.js";import{C as P}from"./ConsumerButtons-4d0b43b9.js";import{h as W}from"./moment-fbc5633a.js";import{W as L}from"./WaterApiList-5aa50fab.js";const q=()=>{var m,c,g,p,x,u,h;const[t,N]=i.useState(),[y,v]=i.useState(),{id:n}=U(),{api_waterListDemand:w,api_waterGenerateDemand:R,header:d}=L(),D=()=>{f.post(w,{ConsumerId:n},d).then(l=>{console.log("Fetched Water Demand List",l.data.data),N(l.data.data)}).catch(l=>{console.log("Exception while fetching Water Demand",l)})};i.useEffect(()=>{D()},[n]);const M=l=>{const s={consumerId:n,demandUpto:l.demandUpto,finalRading:l.meterReading,meterImage:l.meterImage};console.log("Final Payload of Meter Reading",s),f.post(R,s,d).then(o=>{o.data.status?(setRefetchData(_=>_+1),console.log("Demand Generate Date Saved",o)):console.log("Error Demand Generate",o)}).catch(o=>{console.log("Exception While going to generate Demand",o)})},I=k({meterReading:E().required("Enter Meter Reading").min(((m=t==null?void 0:t.meterDetails)==null?void 0:m.final_meter_reading)+1,`Reading must be greater previous ${(c=t==null?void 0:t.meterDetails)==null?void 0:c.final_meter_reading}`),demandUpto:b().required("Select Upto Data"),meterImage:b().required("Select Image")}),r=S({enableReinitialize:!0,initialValues:{demandUpto:"",meterReading:"",meterImage:y},onSubmit:(l,{resetForm:s})=>{s(),M(l)},validationSchema:I}),F=l=>{let s=l.target.name,o=l.target.value;s=="meterReading"&&r.setFieldValue("meterReading",allowFloatInput(o,r.values.meterReading,20)),s=="meterImage"&&v(l.currentTarget.files[0])};return a(C,{children:[e(P,{active:"meter"}),e("h1",{className:"px-1 mt-3 text-center font-semibold text-gray-700",children:" Meter/Fixed Connection Details"}),e("p",{className:"border-b border-gray-700 mx-5"}),a("div",{className:"py-6 mt-2 m-2 bg-white rounded-lg shadow-xl p-4 space-y-5",children:[a("div",{className:"flex space-x-5 pl-4 ",children:[a("div",{className:"flex-1",children:[e("div",{className:"font-semibold text-sm",children:(g=t==null?void 0:t.meterDetails)==null?void 0:g.connectionName}),e("div",{className:"text-gray-500 text-xs",children:"Connection Type"})]}),a("div",{className:"flex-1",children:[e("div",{className:"font-bold text-sm",children:(p=t==null?void 0:t.meterDetails)==null?void 0:p.meter_no}),e("div",{className:"text-gray-500 text-xs",children:"Meter No."})]})]}),a("div",{className:"flex space-x-5 pl-4 ",children:[a("div",{className:"flex-1",children:[e("div",{className:"font-bold text-sm",children:(x=t==null?void 0:t.meterDetails)!=null&&x.final_meter_reading?(u=t==null?void 0:t.meterDetails)==null?void 0:u.final_meter_reading:"N/A"}),e("div",{className:"text-gray-500 text-xs",children:"Last Meter Reading"})]}),a("div",{className:"flex-1",children:[a("div",{className:"font-semibold text-md",children:[W((h=t==null?void 0:t.meterDetails)==null?void 0:h.connection_date,"YYYY-MM-DD").format("DD-MMM-yy")," "]}),e("div",{className:"text-gray-500 text-xs",children:"Meter Connection Date"})]})]})]}),e("p",{className:"border-b"}),e("div",{className:"py-2 bg-white rounded-lg shadow-xl p-4",children:a("form",{onSubmit:r.handleSubmit,onChange:F,className:"p-4 relative",children:[a("div",{className:"space-y-5 ",children:[e("div",{className:"flex-1",children:a("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[a("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold",children:["Upload Meter Image ",e("small",{className:" mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),e("input",{...r.getFieldProps("meterImage"),name:"meterImage",type:"file",className:"form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",placeholder:"Enter Meter Reading"}),e("span",{className:"text-red-600 absolute text-xs",children:r.touched.meterImage&&r.errors.meterImage?r.errors.meterImage:null})]})}),e("div",{className:"flex-1",children:a("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[a("label",{className:"form-label inline-block mb-1 text-gray-600 text-sm font-semibold",children:["Final Meter Reading ",e("small",{className:" mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),e("input",{...r.getFieldProps("meterReading"),type:"text",className:"form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer",placeholder:"Enter Meter Reading"}),e("span",{className:"text-red-600 absolute text-xs",children:r.touched.meterReading&&r.errors.meterReading?r.errors.meterReading:null})]})}),e("div",{className:"flex-1",children:a("div",{className:"form-group mb-6 col-span-12 md:col-span-6 md:px-4",children:[a("label",{className:"form-label inline-block mb-1 text-gray-900 text-sm font-semibold",children:["Demand Upto Date ",e("small",{className:" mt-1 text-sm font-semibold text-red-600 inline ",children:"*"})]}),e("input",{...r.getFieldProps("demandUpto"),type:"date",className:"form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none placeholder-gray-300 shadow-md cursor-pointer"}),e("span",{className:"text-red-600 absolute text-xs",children:r.touched.demandUpto&&r.errors.demandUpto?r.errors.demandUpto:null})]})})]}),e("div",{className:"flex justify-center",children:e("button",{type:"submit",className:"bg-indigo-700 px-6 py-2 text-sm text-white rounded",children:"Generate Demand"})})]})})]})};export{q as default};
